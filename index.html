<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#667eea">
    <meta name="msapplication-TileColor" content="#667eea">
    <title>üéÅ Video Rewards App - Earn Points & Win Prizes!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* Custom gradient backgrounds */
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%, #4facfe 100%);
            background-size: 400% 400%;
            animation: gradientShift 15s ease infinite;
        }
        
        .gradient-bg-alt {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 25%, #fecfef 50%, #ffc3a0 75%, #ff9a9e 100%);
            background-size: 400% 400%;
            animation: gradientShift 20s ease infinite;
        }
        
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Mobile-friendly animations */
        .bounce-reward {
            animation: bounceReward 2s infinite;
        }
        
        @keyframes bounceReward {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        /* Enhanced mobile touch targets */
        .touch-target {
            min-height: 44px;
            min-width: 44px;
        }
        
        /* Mobile navigation improvements */
        .mobile-nav {
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .mobile-nav-container {
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        .mobile-nav-container::-webkit-scrollbar {
            display: none;
        }
        
        /* Enhanced tab button for mobile */
        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .tab-btn:active {
            transform: scale(0.95);
            background-color: rgba(147, 51, 234, 0.1);
        }
        
        .tab-btn.active {
            background: linear-gradient(135deg, rgba(147, 51, 234, 0.1), rgba(236, 72, 153, 0.1));
            box-shadow: 0 2px 8px rgba(147, 51, 234, 0.2);
        }
        
        /* Mobile-specific tab styling */
        @media (max-width: 640px) {
            .tab-btn {
                min-width: 70px;
                flex-shrink: 0;
                padding: 12px 8px;
                margin: 0 2px;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2px;
            }
            
            .tab-btn span:first-child {
                font-size: 1.125rem;
                margin: 0;
            }
            
            .tab-btn span:last-of-type {
                font-size: 0.625rem;
                line-height: 1;
                font-weight: 600;
            }
            
            .mobile-nav-container {
                gap: 2px;
                padding: 8px 12px;
            }
            
            /* Mobile navigation indicators */
            .nav-indicator {
                display: block;
                position: absolute;
                bottom: -2px;
                left: 50%;
                transform: translateX(-50%);
                width: 4px;
                height: 4px;
                background: currentColor;
                border-radius: 50%;
                opacity: 0;
                transition: opacity 0.3s ease;
            }
            
            .tab-btn.active .nav-indicator {
                opacity: 1;
            }
        }
        
        /* Responsive card scaling */
        .mobile-card {
            transform: scale(1);
            transition: transform 0.2s ease;
        }
        
        .mobile-card:active {
            transform: scale(0.98);
        }
        
        /* Tab content transitions */
        .tab-content { 
            display: none;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
        }
        
        .tab-content.active { 
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Video overlay transitions */
        .video-overlay {
            transition: opacity 0.3s ease-in-out;
        }
        
        /* Progress bar animation */
        .progress-fill {
            transition: width 0.3s ease-in-out;
        }
        
        /* Hover effects for video cards */
        .video-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        /* Mobile responsive improvements */
        @media (max-width: 768px) {
            .mobile-padding {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            .mobile-text {
                font-size: 0.875rem;
            }
            
            .mobile-grid {
                grid-template-columns: 1fr;
            }
            
            .mobile-hidden {
                display: none;
            }
            
            /* Enhanced mobile navigation */
            .mobile-nav {
                margin-bottom: 1rem;
            }
            
            .mobile-nav-container {
                padding: 8px 12px;
                background: rgba(255, 255, 255, 0.98);
                border: 1px solid rgba(147, 51, 234, 0.1);
            }
            
            /* Mobile content spacing */
            .tab-content {
                padding-top: 1rem;
            }
            
            /* Better touch targets for mobile */
            .touch-target {
                min-height: 48px;
                min-width: 48px;
                position: relative;
            }
            
            /* Mobile scroll enhancement */
            .mobile-nav-container {
                scroll-behavior: smooth;
                scroll-snap-type: x proximity;
            }
            
            .tab-btn {
                scroll-snap-align: center;
            }
        }
        
        /* Enhanced responsive design for all devices */
        @media (max-width: 320px) {
            /* Ultra-small devices (Galaxy Fold, etc.) */
            .tab-btn {
                min-width: 60px;
                padding: 8px 4px;
                font-size: 0.75rem;
            }
            
            .tab-btn span:first-child {
                font-size: 1rem;
            }
            
            .tab-btn span:last-of-type {
                font-size: 0.5rem;
            }
            
            .mobile-padding {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            
            .touch-target {
                min-height: 40px;
                min-width: 40px;
            }
        }
        
        /* Improved mobile viewport settings */
        @media (max-width: 480px) {
            .mobile-nav-container {
                padding: 6px 8px;
            }
            
            .tab-btn {
                min-width: 56px;
                padding: 10px 6px;
                font-size: 0.875rem;
            }
            
            .tab-btn span:first-child {
                font-size: 1.125rem;
            }
            
            /* Better grid layouts for small screens */
            .grid-mobile-1 {
                grid-template-columns: 1fr;
            }
            
            .grid-mobile-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            /* Enhanced card spacing */
            .card-mobile {
                margin-bottom: 1rem;
                padding: 1rem;
            }
            
            /* Better text scaling */
            .text-mobile-xs {
                font-size: 0.75rem;
            }
            
            .text-mobile-sm {
                font-size: 0.875rem;
            }
            
            .text-mobile-base {
                font-size: 1rem;
            }
        }
        
        /* Tablet optimizations */
        @media (min-width: 481px) and (max-width: 768px) {
            .tablet-grid-2 {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .tablet-grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .tablet-padding {
                padding: 1.5rem;
            }
            
            /* Better button sizing for tablets */
            .touch-target {
                min-height: 46px;
                min-width: 46px;
            }
        }
        
        /* Large tablet and small desktop */
        @media (min-width: 769px) and (max-width: 1024px) {
            .desktop-sm-grid-3 {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .desktop-sm-grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        /* High DPI displays */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .high-dpi-text {
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
        
        /* Landscape orientation optimizations */
        @media (orientation: landscape) and (max-height: 500px) {
            .landscape-compact {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .landscape-header {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
        }
        
        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            .print-friendly {
                background: white !important;
                color: black !important;
            }
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .dark-mode-bg {
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 25%, #0f3460 50%, #533483 75%, #e94560 100%);
            }
        }
        
        /* Reduced motion for accessibility */
        @media (prefers-reduced-motion: reduce) {
            .respect-motion-preference {
                animation: none !important;
                transition: none !important;
            }
        }
        
        /* High contrast mode */
        @media (prefers-contrast: high) {
            .high-contrast {
                border: 2px solid;
                background: white;
                color: black;
            }
        }
        
        /* Container query support for modern browsers */
        @supports (container-type: inline-size) {
            .container-responsive {
                container-type: inline-size;
            }
            
            @container (max-width: 400px) {
                .container-mobile {
                    padding: 0.5rem;
                    font-size: 0.875rem;
                }
            }
        }
        
        /* Enhanced flexible grid system */
        .responsive-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 480px) {
            .responsive-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
        }
        
        /* Advanced responsive grid patterns */
        .grid-auto-fit {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        @media (max-width: 768px) {
            .grid-auto-fit {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 0.75rem;
            }
        }
        
        @media (max-width: 480px) {
            .grid-auto-fit {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
        }
        
        /* Responsive typography scaling */
        .text-responsive {
            font-size: clamp(0.875rem, 2.5vw, 1.125rem);
            line-height: 1.5;
        }
        
        .heading-responsive {
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            line-height: 1.2;
        }
        
        .subheading-responsive {
            font-size: clamp(1.125rem, 3vw, 1.5rem);
            line-height: 1.3;
        }
        
        /* Enhanced touch targets for all interactive elements */
        .enhanced-touch {
            position: relative;
            min-height: 44px;
            min-width: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .enhanced-touch::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            z-index: -1;
        }
        
        /* Improved mobile interaction feedback */
        .touch-feedback {
            transition: all 0.2s ease;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        .touch-feedback:active {
            transform: scale(0.96);
            opacity: 0.8;
        }
        
        /* Better button styles for mobile */
        .btn-mobile {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 600;
            border-radius: 0.75rem;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            transition: all 0.2s ease;
        }
        
        @media (max-width: 480px) {
            .btn-mobile {
                padding: 0.875rem 1rem;
                font-size: 0.9rem;
                min-height: 44px;
            }
        }
        
        /* Smooth scrolling for all devices */
        html {
            scroll-behavior: smooth;
        }
        
        /* Better focus indicators */
        .focus-visible {
            outline: 2px solid #3b82f6;
            outline-offset: 2px;
        }
        
        /* Optimized images for different screen densities */
        .responsive-image {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        
        /* Additional responsive improvements */
        .xs\:hidden {
            display: none;
        }
        
        @media (min-width: 360px) {
            .xs\:inline {
                display: inline;
            }
            
            .xs\:hidden {
                display: initial;
            }
        }
        
        /* Better mobile modal handling */
        @media (max-width: 480px) {
            .modal-content {
                margin: 0.5rem !important;
                max-height: calc(100vh - 1rem) !important;
                overflow-y: auto;
            }
            
            .profile-modal {
                max-width: calc(100vw - 1rem);
            }
        }
        
        /* Enhanced form elements for mobile */
        @media (max-width: 640px) {
            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px 16px;
                border-radius: 12px;
            }
            
            .btn-mobile {
                min-height: 48px;
                font-size: 1rem;
                padding: 0.875rem 1.5rem;
            }
        }
        
        /* Landscape mode optimizations for mobile */
        @media (orientation: landscape) and (max-height: 600px) and (max-width: 1024px) {
            .landscape-compact {
                padding-top: 0.25rem;
                padding-bottom: 0.25rem;
            }
            
            .header-mobile {
                padding-top: 0.5rem;
                padding-bottom: 0.5rem;
            }
            
            .tab-content {
                padding-top: 0.5rem;
            }
        }
        
        /* Enhanced mobile viewport settings and comprehensive responsive design */
        @media (max-width: 480px) {
            .mobile-nav-container {
                padding: 6px 8px;
            }
            
            .tab-btn {
                min-width: 56px;
                padding: 10px 6px;
                font-size: 0.875rem;
            }
            
            .tab-btn span:first-child {
                font-size: 1.125rem;
            }
            
            /* Better modal handling on small screens */
            .modal-content {
                margin: 0.5rem;
                max-height: calc(100vh - 1rem);
                overflow-y: auto;
            }
            
            /* Enhanced form elements */
            .form-input {
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
            }
            
            /* Better video player sizing */
            .video-container {
                height: 200px;
                width: 100%;
            }
            
            /* Improved card layouts */
            .card-responsive {
                padding: 1rem;
                margin-bottom: 0.75rem;
            }
            
            /* Enhanced header spacing */
            .header-mobile {
                padding: 0.75rem 1rem;
            }
            
            /* Better navigation helper text */
            .nav-helper {
                font-size: 0.75rem;
                padding: 0.5rem;
            }
        }
        
        /* Reward icon animations */
        .reward-pulse {
            animation: rewardPulse 3s ease-in-out infinite;
        }
        
        @keyframes rewardPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        /* Floating reward icons */
        .floating-icon {
            position: fixed;
            z-index: -1;
            opacity: 0.1;
            animation: float 6s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }
        
        /* Adsterra Ad Styles */
        .adsterra-ad-container {
            width: 100%;
            margin: 1rem 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 250px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .adsterra-banner {
            width: 100%;
            max-width: 728px;
            margin: 0 auto;
            text-align: center;
        }
        
        .adsterra-mobile-banner {
            width: 100%;
            max-width: 320px;
            margin: 0 auto;
        }
        
        .adsterra-sticky {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .adsterra-sidebar {
            position: fixed;
            top: 50%;
            transform: translateY(-50%);
            z-index: 999;
        }
        
        .adsterra-sidebar-left {
            left: 0;
        }
        
        .adsterra-sidebar-right {
            right: 0;
        }
        
        .adsterra-native {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .ad-label {
            font-size: 10px;
            color: #666;
            text-align: center;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .ad-close-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1001;
        }
        
        .ad-loading {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            color: #666;
            font-size: 14px;
        }
        
        .ad-fallback {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            border-radius: 12px;
            margin: 1rem 0;
        }
        
        @media (max-width: 768px) {
            .adsterra-sidebar {
                display: none;
            }
            
            .adsterra-banner {
                max-width: 300px;
            }
            
            .adsterra-ad-container {
                margin: 0.5rem 0;
                min-height: 200px;
            }
        }
        
        @media (max-width: 480px) {
            .adsterra-banner {
                max-width: 280px;
            }
            
            .adsterra-ad-container {
                min-height: 150px;
            }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen high-dpi-text overflow-x-hidden">
    <!-- Sidebar Ads (Desktop Only) -->
    <div class="adsterra-sidebar adsterra-sidebar-left hidden lg:block">
        <div id="adsterra-sidebar-left">
            <!-- Adsterra Left Sidebar Ad -->
            <script type="text/javascript">
                atOptions = {
                    'key' : 'YOUR_ADSTERRA_SIDEBAR_LEFT_KEY_HERE',
                    'format' : 'iframe',
                    'height' : 600,
                    'width' : 160,
                    'params' : {}
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_SIDEBAR_LEFT_KEY_HERE/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
    </div>
    
    <div class="adsterra-sidebar adsterra-sidebar-right hidden lg:block">
        <div id="adsterra-sidebar-right">
            <!-- Adsterra Right Sidebar Ad -->
            <script type="text/javascript">
                atOptions = {
                    'key' : 'YOUR_ADSTERRA_SIDEBAR_RIGHT_KEY_HERE',
                    'format' : 'iframe',
                    'height' : 600,
                    'width' : 160,
                    'params' : {}
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_SIDEBAR_RIGHT_KEY_HERE/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
    </div>

    <!-- Sticky Footer Ad (Mobile) -->
    <div id="adsterra-sticky-footer" class="adsterra-sticky lg:hidden">
        <button class="ad-close-btn" onclick="closeStickyAd()">&times;</button>
        <div class="adsterra-mobile-banner">
            <div class="ad-label">Advertisement</div>
            <!-- Adsterra Mobile Sticky Banner -->
            <script type="text/javascript">
                atOptions = {
                    'key' : 'YOUR_ADSTERRA_MOBILE_STICKY_KEY_HERE',
                    'format' : 'iframe',
                    'height' : 50,
                    'width' : 320,
                    'params' : {}
                };
                document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_MOBILE_STICKY_KEY_HERE/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
    </div>

    <!-- Responsive Floating Reward Icons -->
    <div class="floating-icon hidden sm:block" style="top: 10%; left: 5%; font-size: 2rem;">üéÅ</div>
    <div class="floating-icon hidden md:block" style="top: 20%; right: 10%; font-size: 1.5rem; animation-delay: -2s;">üí∞</div>
    <div class="floating-icon hidden lg:block" style="top: 60%; left: 8%; font-size: 1.8rem; animation-delay: -4s;">üèÜ</div>
    <div class="floating-icon hidden xl:block" style="top: 80%; right: 15%; font-size: 1.3rem; animation-delay: -1s;">üíé</div>
    <div class="floating-icon hidden sm:block" style="top: 40%; right: 5%; font-size: 2.2rem; animation-delay: -3s;">üéä</div>
    <div class="floating-icon hidden md:block" style="top: 70%; left: 15%; font-size: 1.6rem; animation-delay: -5s;">‚≠ê</div>
    <!-- Loading Screen -->
    <div id="loading" class="fixed inset-0 gradient-bg-alt flex items-center justify-center z-50">
        <div class="text-center bg-white bg-opacity-90 p-8 rounded-2xl shadow-2xl mobile-padding">
            <div class="text-6xl mb-4 bounce-reward">üéÅ</div>
            <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-purple-500 mx-auto mb-4"></div>
            <h2 class="text-2xl font-bold text-purple-800 mb-2">Video Rewards</h2>
            <p class="text-purple-600 font-medium">Loading your rewards...</p>
        </div>
    </div>

    <!-- Auth Container -->
    <div id="authContainer" class="hidden min-h-screen flex items-center justify-center py-4 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8">
            <div class="text-center bg-white bg-opacity-90 p-6 rounded-2xl">
                <div class="text-6xl mb-4 reward-pulse">üéÅ</div>
                <h2 class="text-3xl font-extrabold text-purple-900 mb-2">Video Rewards App</h2>
                <p class="text-purple-700 font-medium">üé¨ Watch Videos ‚Ä¢ üéØ Complete Tasks ‚Ä¢ üí∞ Earn Rewards</p>
            </div>
            
            <!-- Login Form -->
            <div id="loginForm" class="bg-white bg-opacity-95 p-6 sm:p-8 rounded-2xl shadow-xl mobile-card">
                <div class="flex items-center justify-center mb-4">
                    <span class="text-2xl mr-2">üîê</span>
                    <h3 class="text-xl font-bold text-gray-800">Welcome Back!</h3>
                </div>
                <form id="loginFormElement">
                    <div class="mb-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üìß</span>
                            <input id="loginEmail" type="email" placeholder="Email" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <div class="mb-6">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîí</span>
                            <input id="loginPassword" type="password" placeholder="Password" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-bold py-3 px-4 rounded-xl hover:from-purple-700 hover:to-pink-700 transition duration-200 btn-mobile touch-feedback">
                        üöÄ Sign In & Start Earning
                    </button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    New here? 
                    <button id="showSignup" class="text-purple-600 hover:text-purple-800 font-bold enhanced-touch">Join Now! üéâ</button>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signupForm" class="bg-white bg-opacity-95 p-6 sm:p-8 rounded-2xl shadow-xl mobile-card hidden">
                <div class="flex items-center justify-center mb-4">
                    <span class="text-2xl mr-2">üéØ</span>
                    <h3 class="text-xl font-bold text-gray-800">Join the Fun!</h3>
                </div>
                <form id="signupFormElement">
                    <div class="mb-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üë§</span>
                            <input id="signupName" type="text" placeholder="Profile Name" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üë§</span>
                            <input id="signupDob" type="date" placeholder="Date of Birth" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üìß</span>
                            <input id="signupEmail" type="email" placeholder="Email" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <div class="mb-4">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîí</span>
                            <input id="signupPassword" type="password" placeholder="Password" required 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                    </div>
                    <div class="mb-6">
                        <div class="relative">
                            <span class="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400">üîó</span>
                            <input id="signupReferCode" type="text" placeholder="Refer Code (Optional)" 
                                   class="w-full pl-10 pr-3 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-purple-500 enhanced-touch form-input">
                        </div>
                        <p class="text-xs text-gray-500 mt-1">üéÅ Got a refer code? Enter it to give your friend bonus points!</p>
                    </div>
                    <button type="submit" class="w-full bg-gradient-to-r from-green-500 to-blue-500 text-white font-bold py-3 px-4 rounded-xl hover:from-green-600 hover:to-blue-600 transition duration-200 btn-mobile touch-feedback">
                        üéä Create Account & Start Earning
                    </button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Already earning rewards? 
                    <button id="showLogin" class="text-purple-600 hover:text-purple-800 font-bold enhanced-touch">Sign In! üöÄ</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="appContainer" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-white bg-opacity-95 backdrop-blur-sm shadow-lg border-b-4 border-gradient sticky top-0 z-40">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-3 sm:py-4 header-mobile">
                    <div class="flex items-center">
                        <span class="text-2xl sm:text-3xl mr-2 bounce-reward">üéÅ</span>
                        <div>
                            <h1 class="text-xl sm:text-2xl font-bold bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent heading-responsive">Video Rewards</h1>
                            <p class="text-xs text-gray-600 mobile-hidden sm:block">Earn ‚Ä¢ Watch ‚Ä¢ Win</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-1 sm:space-x-2 md:space-x-4">
                        <div id="resetTimer" class="hidden sm:flex items-center bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-2 sm:px-3 py-1 sm:py-2 rounded-full text-xs font-bold shadow-lg">
                            <span class="mr-1">üïõ</span>
                            <span id="timeUntilReset" class="text-xs sm:text-sm">--:--:--</span>
                        </div>
                        <button id="profileBtn" onclick="openProfileModal()" class="bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white px-2 sm:px-3 py-2 rounded-full font-bold text-xs sm:text-sm shadow-lg transition duration-200 enhanced-touch touch-feedback">
                            <span class="text-base sm:text-lg mr-1 sm:mr-2">üë§</span>
                            <span class="hidden sm:inline">Profile</span>
                        </button>
                        <span id="userPoints" class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-2 sm:px-3 py-2 rounded-full font-bold text-xs sm:text-base shadow-lg bounce-reward">
                            üí∞ <span class="hidden xs:inline">0 Points</span><span class="xs:hidden">0</span>
                        </span>
                        <button id="logoutBtn" class="text-gray-600 hover:text-gray-800 bg-gray-100 hover:bg-gray-200 px-2 sm:px-3 py-2 rounded-full transition duration-200 enhanced-touch touch-feedback">
                            <span class="mobile-hidden sm:inline">Logout</span>
                            <span class="sm:hidden text-base">üö™</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-8">
            <!-- Tab Navigation -->
            <div class="mobile-nav sticky top-0 z-50 mb-6 sm:mb-8">
                <nav class="mobile-nav-container flex overflow-x-auto space-x-1 sm:space-x-4 bg-white bg-opacity-95 backdrop-blur-lg p-3 rounded-2xl shadow-lg border border-white/20" id="tabNavigation">
                    <button class="tab-btn active py-2 px-3 sm:px-4 border-b-2 border-purple-500 font-bold text-purple-600 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="videos">
                        <span class="text-lg mr-1">üé¨</span>
                        <span class="text-xs sm:text-sm">Videos</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="offers">
                        <span class="text-lg mr-1">üéØ</span>
                        <span class="text-xs sm:text-sm">Offers</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="movies">
                        <span class="text-lg mr-1">üé¨</span>
                        <span class="text-xs sm:text-sm">Movies</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="redeem">
                        <span class="text-lg mr-1">üí∞</span>
                        <span class="text-xs sm:text-sm">Redeem</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="support">
                        <span class="text-lg mr-1">üí¨</span>
                        <span class="text-xs sm:text-sm">Support</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="faq">
                        <span class="text-lg mr-1">‚ùì</span>
                        <span class="text-xs sm:text-sm">FAQ</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="about">
                        <span class="text-lg mr-1">‚ÑπÔ∏è</span>
                        <span class="text-xs sm:text-sm">About</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="privacy">
                        <span class="text-lg mr-1">üîí</span>
                        <span class="text-xs sm:text-sm">Privacy</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0" data-tab="terms">
                        <span class="text-lg mr-1">üìã</span>
                        <span class="text-xs sm:text-sm">Terms</span>
                        <div class="nav-indicator"></div>
                    </button>
                    <button id="adminTabBtn" class="tab-btn py-2 px-3 sm:px-4 border-b-2 border-transparent font-bold text-gray-500 hover:text-gray-700 rounded-lg enhanced-touch touch-feedback whitespace-nowrap flex-shrink-0 hidden" data-tab="admin">
                        <span class="text-lg mr-1">‚öôÔ∏è</span>
                        <span class="text-xs sm:text-sm">Admin</span>
                        <div class="nav-indicator"></div>
                    </button>
                </nav>
                
                <!-- Mobile Navigation Helper -->
                <div class="flex sm:hidden justify-center mt-2">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-purple-300 rounded-full opacity-50"></div>
                        <div class="w-2 h-2 bg-purple-300 rounded-full opacity-50"></div>
                        <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                        <div class="w-2 h-2 bg-purple-300 rounded-full opacity-50"></div>
                        <div class="w-2 h-2 bg-purple-300 rounded-full opacity-50"></div>
                    </div>
                    <p class="text-xs text-gray-500 ml-2">‚Üê Swipe to see more tabs</p>
                </div>
            </div>

            <!-- Videos Tab -->
            <div id="videos" class="tab-content active">
                <!-- Top Banner Ad -->
                <div class="adsterra-ad-container adsterra-banner">
                    <div class="ad-label">Advertisement</div>
                    <div id="adsterra-header-banner">
                        <!-- Adsterra Header Banner (728x90 or 320x50 mobile) -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_BANNER_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 90,
                                'width' : 728,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_BANNER_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl mb-4 sm:mb-6 card-responsive">
                    <div class="text-center mb-4">
                        <div class="text-4xl sm:text-5xl lg:text-6xl mb-2 reward-pulse">üé¨</div>
                        <h2 class="heading-responsive font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Watch Videos to Earn Points</h2>
                        <p class="text-responsive text-gray-600">üëÄ Watch videos and earn amazing rewards!</p>
                        <div class="mt-3 px-3 sm:px-4 py-2 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-responsive text-blue-800 font-medium">
                                üîÑ <strong>Daily Reset:</strong> All videos reset at 12:00 AM daily - re-watch to earn points again!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Native Ad Between Content -->
                <div class="adsterra-ad-container adsterra-native">
                    <div class="ad-label">Sponsored Content</div>
                    <div id="adsterra-native-1">
                        <!-- Adsterra Native Ad -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_NATIVE_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 300,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_NATIVE_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <div id="videosList" class="responsive-grid">
                    <!-- Videos will be loaded here -->
                </div>
                
                <!-- Bottom Banner Ad -->
                <div class="adsterra-ad-container adsterra-banner">
                    <div class="ad-label">Advertisement</div>
                    <div id="adsterra-bottom-banner">
                        <!-- Adsterra Bottom Banner -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_BANNER_2_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 250,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_BANNER_2_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
            </div>

            <!-- Movies & Series Tab -->
            <div id="movies" class="tab-content">
                <!-- Top Banner Ad for Movies -->
                <div class="adsterra-ad-container adsterra-banner">
                    <div class="ad-label">Advertisement</div>
                    <div id="adsterra-movies-banner">
                        <!-- Adsterra Movies Banner -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_MOVIES_BANNER_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 90,
                                'width' : 728,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_MOVIES_BANNER_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl mb-4 sm:mb-6 card-responsive">
                    <div class="text-center mb-4">
                        <div class="text-4xl sm:text-5xl lg:text-6xl mb-2 reward-pulse">üé¨</div>
                        <h2 class="heading-responsive font-bold bg-gradient-to-r from-red-600 to-purple-600 bg-clip-text text-transparent mb-2">Movies & Series</h2>
                        <p class="text-responsive text-gray-600">üçø Watch and download amazing content, earn points!</p>
                        <div class="mt-3 px-3 sm:px-4 py-2 bg-purple-50 border border-purple-200 rounded-lg">
                            <p class="text-responsive text-purple-800 font-medium">
                                üîÑ <strong>Daily Reset:</strong> All downloads reset at 12:00 AM daily - download again to earn more points!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Category Filter -->
                <div class="mb-4 sm:mb-6">
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button onclick="filterMoviesByCategory('all')" class="category-filter-btn active bg-gradient-to-r from-purple-500 to-pink-500 text-white px-3 sm:px-4 py-2 rounded-full font-bold transition duration-200 enhanced-touch touch-feedback">
                            üéÜ All Content
                        </button>
                        <div id="movieCategoryFilters" class="flex flex-wrap gap-2">
                            <!-- Dynamic category filters will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Content Type Filter -->
                <div class="mb-4 sm:mb-6 bg-white bg-opacity-90 p-3 sm:p-4 rounded-xl sm:rounded-2xl shadow-lg card-responsive">
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button onclick="filterMoviesByType('all')" class="type-filter-btn active bg-gradient-to-r from-blue-500 to-indigo-500 text-white px-3 sm:px-4 py-2 rounded-full font-bold transition duration-200 enhanced-touch touch-feedback">
                            üé¶ All
                        </button>
                        <button onclick="filterMoviesByType('movie')" class="type-filter-btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-3 sm:px-4 py-2 rounded-full font-bold transition duration-200 enhanced-touch touch-feedback">
                            üé¨ Movies
                        </button>
                        <button onclick="filterMoviesByType('series')" class="type-filter-btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-3 sm:px-4 py-2 rounded-full font-bold transition duration-200 enhanced-touch touch-feedback">
                            üì∫ Series
                        </button>
                    </div>
                </div>
                
                <!-- Native Ad in Movies Section -->
                <div class="adsterra-ad-container adsterra-native">
                    <div class="ad-label">Sponsored Content</div>
                    <div id="adsterra-movies-native">
                        <!-- Adsterra Movies Native Ad -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_MOVIES_NATIVE_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 300,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_MOVIES_NATIVE_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <!-- Movies & Series Grid -->
                <div id="moviesGrid" class="grid gap-3 sm:gap-4 lg:gap-6 grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6">
                    <!-- Movies & Series will be loaded here -->
                </div>
            </div>

            <!-- Offers Tab -->
            <div id="offers" class="tab-content">
                <!-- Top Banner Ad for Offers -->
                <div class="adsterra-ad-container adsterra-banner">
                    <div class="ad-label">Advertisement</div>
                    <div id="adsterra-offers-banner">
                        <!-- Adsterra Offers Banner -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_OFFERS_BANNER_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 90,
                                'width' : 728,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_OFFERS_BANNER_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl mb-4 sm:mb-6 card-responsive">
                    <div class="text-center mb-4">
                        <div class="text-4xl sm:text-5xl lg:text-6xl mb-2 reward-pulse">üéØ</div>
                        <h2 class="heading-responsive font-bold bg-gradient-to-r from-green-600 to-blue-600 bg-clip-text text-transparent mb-2">Complete Offers to Earn Points</h2>
                        <p class="text-responsive text-gray-600">üèÜ Complete tasks and unlock awesome rewards!</p>
                        <div class="mt-3 px-3 sm:px-4 py-2 bg-green-50 border border-green-200 rounded-lg">
                            <p class="text-responsive text-green-800 font-medium">
                                üîÑ <strong>Daily Reset:</strong> All completed offers reset at 12:00 AM daily - redo to earn more points!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Native Ad in Offers Section -->
                <div class="adsterra-ad-container adsterra-native">
                    <div class="ad-label">Recommended Offers</div>
                    <div id="adsterra-offers-native">
                        <!-- Adsterra Offers Native Ad -->
                        <script type="text/javascript">
                            atOptions = {
                                'key' : 'YOUR_ADSTERRA_OFFERS_NATIVE_KEY_HERE',
                                'format' : 'iframe',
                                'height' : 300,
                                'width' : 300,
                                'params' : {}
                            };
                            document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/YOUR_ADSTERRA_OFFERS_NATIVE_KEY_HERE/invoke.js"></scr' + 'ipt>');
                        </script>
                    </div>
                </div>
                
                <div id="offersList" class="responsive-grid">
                    <!-- Offers will be loaded here -->
                </div>
            </div>

            <!-- Redeem Tab -->
            <div id="redeem" class="tab-content">
                <h2 class="heading-responsive font-bold mb-4 sm:mb-6">Redeem Your Points</h2>
                <div class="grid gap-4 sm:gap-6 lg:gap-8 grid-cols-1 lg:grid-cols-2">
                    <div class="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-lg card-responsive">
                        <h3 class="subheading-responsive font-semibold mb-4">Cash Out Options</h3>
                        
                        <!-- UPI ID Input -->
                        <div class="mb-4 sm:mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">UPI ID (Required for withdrawal)</label>
                            <input id="upiId" type="text" placeholder="Enter your UPI ID (e.g., yourname@paytm)" 
                                   class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                            <p class="text-xs text-gray-500 mt-1">This UPI ID will be used for processing your withdrawal</p>
                        </div>
                        
                        <div id="redeemOptionsList" class="space-y-3 sm:space-y-4">
                            <!-- Dynamic redeem options will be loaded here -->
                            <div class="text-center py-6 sm:py-8 text-gray-500">
                                <p class="text-responsive">Loading redeem options...</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-white p-4 sm:p-6 rounded-xl sm:rounded-2xl shadow-lg card-responsive">
                        <h3 class="subheading-responsive font-semibold mb-4">Withdrawal History</h3>
                        <div id="withdrawalHistory" class="space-y-3">
                            <!-- Withdrawal history will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Tab -->
            <div id="support" class="tab-content">
                <h2 class="text-2xl font-bold mb-6">Support</h2>
                
                <!-- Privacy Notice -->
                <div class="mb-6 p-4 bg-green-50 border border-green-200 rounded-xl">
                    <div class="flex items-center mb-2">
                        <span class="text-xl mr-2">üîí</span>
                        <h3 class="font-bold text-green-800">Private & Secure Support</h3>
                    </div>
                    <p class="text-sm text-green-700">
                        ‚úÖ Your support tickets are completely private and only visible to you and admin.<br>
                        ‚ùå Other users cannot see your tickets or personal information.<br>
                        üï∞Ô∏è You'll receive admin replies directly in your ticket history below.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">Send Message</h3>
                        <form id="supportForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Subject</label>
                                <input id="supportSubject" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                                <textarea id="supportMessage" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Send Message</button>
                        </form>
                    </div>
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">Your Messages</h3>
                        <div id="supportHistory" class="space-y-4">
                            <!-- Support history will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- FAQ Tab -->
            <div id="faq" class="tab-content">
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 rounded-2xl shadow-xl mb-6">
                    <div class="text-center mb-6">
                        <div class="text-4xl sm:text-6xl mb-2">‚ùì</div>
                        <h2 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Frequently Asked Questions</h2>
                        <p class="text-gray-600 text-sm sm:text-base">Find answers to common questions about our reward app</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <!-- General Questions -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-purple-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üåü</span> General Questions
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">How does the reward app work?</h4>
                                <p class="text-gray-600">Our app rewards you with points for completing various activities like watching videos, downloading movies, and completing offers. You can redeem these points for real cash through UPI.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">How do I earn points?</h4>
                                <p class="text-gray-600">You can earn points by:
                                    <br>‚Ä¢ Watching videos (points awarded after completion)
                                    <br>‚Ä¢ Downloading movies and series
                                    <br>‚Ä¢ Completing offers and tasks
                                    <br>‚Ä¢ All tasks reset daily at 12:00 AM for more earning opportunities!</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">When do points reset?</h4>
                                <p class="text-gray-600">All completed activities reset daily at 12:00 AM midnight. This means you can re-watch videos, re-download content, and redo offers every day to earn more points!</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">Is this app free to use?</h4>
                                <p class="text-gray-600">Yes! Our app is completely free to use. You just need to create an account and start earning points immediately.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Points & Rewards -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üí∞</span> Points & Rewards
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">How do I redeem my points?</h4>
                                <p class="text-gray-600">Go to the "Redeem" tab, enter your UPI ID, choose a cash-out option, and submit your withdrawal request. Admin will process your request within 24-48 hours.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">What is the minimum withdrawal amount?</h4>
                                <p class="text-gray-600">The minimum withdrawal depends on the available redemption options set by admin. Check the "Redeem" section for current options and point requirements.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">How long does withdrawal take?</h4>
                                <p class="text-gray-600">Withdrawal requests are typically processed within 24-48 hours. You'll receive the money directly to your UPI account.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">Do points expire?</h4>
                                <p class="text-gray-600">No, your earned points never expire! You can accumulate them over time and withdraw when you reach your desired amount.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Technical Support -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üîß</span> Technical Support
                        </h3>
                        
                        <div class="space-y-4">
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">My points are not showing up after completing a task</h4>
                                <p class="text-gray-600">Try refreshing the page. If points still don't appear, contact support with details about the specific task you completed.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">I can't watch videos or they won't load</h4>
                                <p class="text-gray-600">Ensure you have a stable internet connection and try refreshing the page. Make sure your browser allows embedded videos and disable ad blockers if necessary.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">Download links are not working</h4>
                                <p class="text-gray-600">Some download links may be temporarily unavailable. Try again later or contact support to report broken links.</p>
                            </div>
                            
                            <div class="border-b pb-4">
                                <h4 class="font-bold text-gray-800 mb-2">How do I contact support?</h4>
                                <p class="text-gray-600">Use the "Support" tab to send a message to our admin team. All support tickets are private and secure.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- About Us Tab -->
            <div id="about" class="tab-content">
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 rounded-2xl shadow-xl mb-6">
                    <div class="text-center mb-6">
                        <div class="text-4xl sm:text-6xl mb-2">‚ÑπÔ∏è</div>
                        <h2 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">About Us</h2>
                        <p class="text-gray-600 text-sm sm:text-base">Learn more about our mission and what we offer</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <!-- Our Mission -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-2xl font-bold text-purple-600 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üéØ</span> Our Mission
                        </h3>
                        <p class="text-gray-700 leading-relaxed mb-4">
                            We believe that your time and engagement should be rewarded. Our platform connects users with entertaining content while providing real monetary rewards for their participation. Whether you're watching videos, downloading movies, or completing offers, every action you take earns you valuable points that can be converted to real cash.
                        </p>
                        <p class="text-gray-700 leading-relaxed">
                            Our goal is to create a fair, transparent, and enjoyable experience where users can earn money while accessing high-quality entertainment content. We're committed to maintaining a daily reset system that ensures everyone has equal opportunities to earn rewards every single day.
                        </p>
                    </div>

                    <!-- What We Offer -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-2xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üåü</span> What We Offer
                        </h3>
                        <div class="grid md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <span class="text-xl mr-2">üé¨</span> Video Rewards
                                </h4>
                                <p class="text-gray-600 mb-4">Watch curated videos from YouTube and other platforms. Earn points for each video you complete watching.</p>
                                
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <span class="text-xl mr-2">üçø</span> Movies & Series
                                </h4>
                                <p class="text-gray-600 mb-4">Access a vast library of movies and TV series across multiple languages and genres. Download content and earn points.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <span class="text-xl mr-2">üéØ</span> Offer Completion
                                </h4>
                                <p class="text-gray-600 mb-4">Complete various offers and tasks from our partners to earn additional points and bonuses.</p>
                                
                                <h4 class="font-bold text-gray-800 mb-2 flex items-center">
                                    <span class="text-xl mr-2">üí∞</span> Cash Redemption
                                </h4>
                                <p class="text-gray-600 mb-4">Convert your earned points to real money and receive payments directly to your UPI account.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Our Commitment -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-2xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-3xl mr-3">ü§ù</span> Our Commitment
                        </h3>
                        <div class="grid md:grid-cols-3 gap-4">
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <div class="text-3xl mb-2">üîí</div>
                                <h4 class="font-bold text-gray-800 mb-2">Privacy First</h4>
                                <p class="text-sm text-gray-600">Your personal information and activities are completely private and secure.</p>
                            </div>
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <div class="text-3xl mb-2">‚ö°</div>
                                <h4 class="font-bold text-gray-800 mb-2">Fast Payments</h4>
                                <p class="text-sm text-gray-600">Quick withdrawal processing within 24-48 hours directly to your UPI.</p>
                            </div>
                            <div class="text-center p-4 bg-gray-50 rounded-lg">
                                <div class="text-3xl mb-2">üîÑ</div>
                                <h4 class="font-bold text-gray-800 mb-2">Daily Opportunities</h4>
                                <p class="text-sm text-gray-600">All tasks reset daily at midnight for continuous earning potential.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-2xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-3xl mr-3">üìû</span> Get In Touch
                        </h3>
                        <p class="text-gray-700 mb-4">
                            Have questions, suggestions, or need help? We're here to assist you!
                        </p>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <p class="text-gray-700">
                                <strong>Support:</strong> Use the "Support" tab to send us a message<br>
                                <strong>Response Time:</strong> We typically respond within 24 hours<br>
                                <strong>Privacy:</strong> All support communications are completely private and confidential
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Privacy Policy Tab -->
            <div id="privacy" class="tab-content">
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 rounded-2xl shadow-xl mb-6">
                    <div class="text-center mb-6">
                        <div class="text-4xl sm:text-6xl mb-2">üîí</div>
                        <h2 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Privacy Policy</h2>
                        <p class="text-gray-600 text-sm sm:text-base">Your privacy is our top priority</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <!-- Introduction -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-purple-600 mb-4">Introduction</h3>
                        <p class="text-gray-700 leading-relaxed">
                            This Privacy Policy explains how we collect, use, and protect your information when you use our reward application. We are committed to protecting your privacy and ensuring that your personal information is handled responsibly and securely.
                        </p>
                        <p class="text-gray-700 leading-relaxed mt-4">
                            <strong>Last Updated:</strong> This policy was last updated on the current date and may be revised periodically to reflect changes in our practices.
                        </p>
                    </div>

                    <!-- Information We Collect -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üìã</span> Information We Collect
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Account Information</h4>
                                <ul class="text-gray-600 list-disc list-inside space-y-1">
                                    <li>Email address (for account creation and authentication)</li>
                                    <li>UPI ID (for payment processing)</li>
                                    <li>Account activity and preferences</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Activity Data</h4>
                                <ul class="text-gray-600 list-disc list-inside space-y-1">
                                    <li>Videos watched and completion status</li>
                                    <li>Offers completed and submission details</li>
                                    <li>Points earned and redemption history</li>
                                    <li>Support ticket communications</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Technical Information</h4>
                                <ul class="text-gray-600 list-disc list-inside space-y-1">
                                    <li>Device information and browser type</li>
                                    <li>IP address and general location</li>
                                    <li>Usage patterns and preferences</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- How We Use Your Information -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üéØ</span> How We Use Your Information
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Provide and maintain our reward services</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Process point calculations and reward distributions</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Handle withdrawal requests and payments</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Provide customer support and respond to inquiries</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Improve our services and user experience</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-green-500 mr-2">‚úÖ</span>
                                <span class="text-gray-700">Prevent fraud and ensure platform security</span>
                            </div>
                        </div>
                    </div>

                    <!-- Data Protection -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üõ°Ô∏è</span> Data Protection & Security
                        </h3>
                        <div class="space-y-4">
                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <h4 class="font-bold text-red-800 mb-2">Security Measures</h4>
                                <ul class="text-red-700 space-y-1">
                                    <li>‚Ä¢ Firebase Authentication for secure login</li>
                                    <li>‚Ä¢ Encrypted data transmission and storage</li>
                                    <li>‚Ä¢ Regular security updates and monitoring</li>
                                    <li>‚Ä¢ Access controls and admin verification</li>
                                </ul>
                            </div>
                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <h4 class="font-bold text-green-800 mb-2">Privacy Guarantees</h4>
                                <ul class="text-green-700 space-y-1">
                                    <li>‚Ä¢ Your activity is private and not shared with other users</li>
                                    <li>‚Ä¢ Support tickets are confidential between you and admin</li>
                                    <li>‚Ä¢ Personal information is never sold or shared with third parties</li>
                                    <li>‚Ä¢ You control your account and can delete it anytime</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Your Rights -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-purple-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">‚öñÔ∏è</span> Your Rights
                        </h3>
                        <div class="grid md:grid-cols-2 gap-4">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Access & Control</h4>
                                <ul class="text-gray-600 space-y-1">
                                    <li>‚Ä¢ View your personal data and activity</li>
                                    <li>‚Ä¢ Update your account information</li>
                                    <li>‚Ä¢ Delete your account and data</li>
                                    <li>‚Ä¢ Download your data</li>
                                </ul>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Communication</h4>
                                <ul class="text-gray-600 space-y-1">
                                    <li>‚Ä¢ Opt out of promotional messages</li>
                                    <li>‚Ä¢ Control notification preferences</li>
                                    <li>‚Ä¢ Request information about your data</li>
                                    <li>‚Ä¢ Report privacy concerns</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Contact -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üìû</span> Privacy Questions
                        </h3>
                        <p class="text-gray-700 mb-4">
                            If you have any questions about this Privacy Policy or how we handle your data, please don't hesitate to contact us through the Support tab. We're committed to transparency and will respond to all privacy-related inquiries promptly.
                        </p>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <p class="text-blue-800">
                                <strong>Remember:</strong> Your privacy is fundamental to our service. We will never share your personal information with other users or third parties without your explicit consent.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Terms & Conditions Tab -->
            <div id="terms" class="tab-content">
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 rounded-2xl shadow-xl mb-6">
                    <div class="text-center mb-6">
                        <div class="text-4xl sm:text-6xl mb-2">üìã</div>
                        <h2 class="text-2xl sm:text-3xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent mb-2">Terms & Conditions</h2>
                        <p class="text-gray-600 text-sm sm:text-base">Please read these terms carefully before using our service</p>
                    </div>
                </div>

                <div class="space-y-6">
                    <!-- Agreement -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-purple-600 mb-4">Agreement to Terms</h3>
                        <p class="text-gray-700 leading-relaxed">
                            By accessing and using this reward application, you agree to be bound by these Terms and Conditions. If you do not agree to these terms, please do not use our service. These terms may be updated periodically, and continued use of the service constitutes acceptance of any changes.
                        </p>
                        <p class="text-gray-700 leading-relaxed mt-4">
                            <strong>Effective Date:</strong> These terms are effective immediately upon your first use of the service.
                        </p>
                    </div>

                    <!-- Service Description -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üåü</span> Service Description
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Reward System</h4>
                                <p class="text-gray-600">Our platform allows users to earn points by watching videos, downloading movies, and completing offers. Points can be redeemed for cash payments through UPI.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Daily Reset Feature</h4>
                                <p class="text-gray-600">All completed activities reset daily at 12:00 AM midnight, allowing users to re-earn points from the same content each day.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Content Access</h4>
                                <p class="text-gray-600">We provide access to videos, movies, and offers through embedded players and external links. Content availability may vary.</p>
                            </div>
                        </div>
                    </div>

                    <!-- User Responsibilities -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üë§</span> User Responsibilities
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Provide accurate and truthful information when creating your account</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Use the service in accordance with these terms and applicable laws</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Complete activities genuinely and not attempt to manipulate the point system</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Maintain the confidentiality of your account credentials</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Report any technical issues or suspicious activities</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-blue-500 mr-2">üìå</span>
                                <span class="text-gray-700">Respect intellectual property rights of content providers</span>
                            </div>
                        </div>
                    </div>

                    <!-- Prohibited Activities -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">‚õî</span> Prohibited Activities
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Creating multiple accounts to exploit the reward system</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Using automated tools, bots, or scripts to complete activities</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Providing false information during offer completion</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Attempting to hack, reverse engineer, or compromise the platform</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Sharing copyrighted content illegally or violating intellectual property rights</span>
                            </div>
                            <div class="flex items-start">
                                <span class="text-red-500 mr-2">‚ùå</span>
                                <span class="text-gray-700">Harassing other users or admin through support channels</span>
                            </div>
                        </div>
                    </div>

                    <!-- Points and Payments -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-green-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üí∞</span> Points and Payments
                        </h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Point Earning</h4>
                                <p class="text-gray-600">Points are awarded upon successful completion of activities. Point values are determined by admin and may change without notice.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Withdrawal Process</h4>
                                <p class="text-gray-600">Withdrawal requests require a valid UPI ID and are subject to admin approval. Processing typically takes 24-48 hours.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-gray-800 mb-2">Payment Disputes</h4>
                                <p class="text-gray-600">Any payment disputes must be reported within 7 days of the transaction. We reserve the right to investigate and resolve disputes.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Limitation of Liability -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-yellow-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">‚ö†Ô∏è</span> Limitation of Liability
                        </h3>
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                            <p class="text-yellow-800 mb-3">
                                Our service is provided "as is" without warranties of any kind. We are not liable for:
                            </p>
                            <ul class="text-yellow-700 space-y-1">
                                <li>‚Ä¢ Technical issues that prevent activity completion</li>
                                <li>‚Ä¢ Third-party content availability or quality</li>
                                <li>‚Ä¢ Internet connection problems</li>
                                <li>‚Ä¢ Device compatibility issues</li>
                                <li>‚Ä¢ External website or service failures</li>
                            </ul>
                        </div>
                    </div>

                    <!-- Account Termination -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-red-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üö´</span> Account Termination
                        </h3>
                        <p class="text-gray-700 mb-4">
                            We reserve the right to suspend or terminate accounts that violate these terms. In case of termination:
                        </p>
                        <ul class="text-gray-600 space-y-2">
                            <li>‚Ä¢ Accumulated points may be forfeited</li>
                            <li>‚Ä¢ Pending withdrawal requests may be cancelled</li>
                            <li>‚Ä¢ Account data may be permanently deleted</li>
                            <li>‚Ä¢ Future account creation may be prohibited</li>
                        </ul>
                    </div>

                    <!-- Contact for Terms -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-bold text-blue-600 mb-4 flex items-center">
                            <span class="text-2xl mr-2">üìû</span> Questions About Terms
                        </h3>
                        <p class="text-gray-700 mb-4">
                            If you have any questions about these Terms and Conditions, please contact us through the Support tab. We're here to clarify any aspects of our terms.
                        </p>
                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                            <p class="text-blue-800">
                                <strong>Important:</strong> By continuing to use our service, you acknowledge that you have read, understood, and agree to be bound by these Terms and Conditions.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel Tab -->
            <div id="admin" class="tab-content">
                <div class="bg-white bg-opacity-90 p-4 sm:p-6 lg:p-8 rounded-2xl shadow-xl mb-4 sm:mb-6 card-responsive">
                    <div class="text-center mb-6">
                        <div class="text-4xl sm:text-5xl lg:text-6xl mb-2 reward-pulse">‚öôÔ∏è</div>
                        <h2 class="heading-responsive font-bold bg-gradient-to-r from-red-600 to-purple-600 bg-clip-text text-transparent mb-2">Admin Panel</h2>
                        <p class="text-responsive text-gray-600">üîß Manage your website settings and ads configuration</p>
                    </div>
                    
                    <!-- Admin Authentication -->
                    <div id="adminAuth" class="mb-6">
                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                            <p class="text-yellow-800 font-medium">üîí Admin access required</p>
                        </div>
                        <div class="flex gap-4">
                            <input id="adminPassword" type="password" placeholder="Enter admin password" 
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                            <button onclick="authenticateAdmin()" class="btn-mobile bg-gradient-to-r from-blue-500 to-purple-500 text-white px-6 py-3 rounded-lg font-bold">
                                Login
                            </button>
                        </div>
                    </div>
                    
                    <!-- Admin Dashboard (Hidden by default) -->
                    <div id="adminDashboard" class="hidden">
                        <!-- Adsterra Management Section -->
                        <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">üí∞ Adsterra Ads Management</h3>
                            
                            <!-- Ad Network Status -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                                    <div class="text-2xl mb-2">üü¢</div>
                                    <div class="text-sm text-gray-600">Network Status</div>
                                    <div id="networkStatus" class="font-bold text-green-600">Active</div>
                                </div>
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                                    <div class="text-2xl mb-2">üìä</div>
                                    <div class="text-sm text-gray-600">Daily Revenue</div>
                                    <div id="dailyRevenue" class="font-bold text-blue-600">$0.00</div>
                                </div>
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                                    <div class="text-2xl mb-2">üëÅÔ∏è</div>
                                    <div class="text-sm text-gray-600">Impressions</div>
                                    <div id="impressionsCount" class="font-bold text-purple-600">0</div>
                                </div>
                            </div>
                            
                            <!-- Adsterra Configuration Form -->
                            <form id="adsterraConfigForm" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <!-- Banner Ads Section -->
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-bold text-gray-800 mb-4">üè∑Ô∏è Banner Ads</h4>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Header Banner Key</label>
                                                <input id="headerBannerKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">728x90 (Desktop) / 320x50 (Mobile)</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Movies Banner Key</label>
                                                <input id="moviesBannerKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">728x90 (Desktop) / 320x50 (Mobile)</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Offers Banner Key</label>
                                                <input id="offersBannerKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">728x90 (Desktop) / 320x50 (Mobile)</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Bottom Banner Key</label>
                                                <input id="bottomBannerKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">300x250 Rectangle</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Native Ads Section -->
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-bold text-gray-800 mb-4">üì± Native Ads</h4>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Videos Native Key</label>
                                                <input id="videosNativeKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">300x250 Native</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Movies Native Key</label>
                                                <input id="moviesNativeKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">300x250 Native</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Offers Native Key</label>
                                                <input id="offersNativeKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">300x250 Native</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Sidebar and Mobile Ads -->
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-bold text-gray-800 mb-4">üíª Desktop Sidebar</h4>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Left Sidebar Key</label>
                                                <input id="leftSidebarKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">160x600 Skyscraper</p>
                                            </div>
                                            
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Right Sidebar Key</label>
                                                <input id="rightSidebarKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">160x600 Skyscraper</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h4 class="font-bold text-gray-800 mb-4">üì± Mobile Ads</h4>
                                        
                                        <div class="space-y-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Mobile Sticky Key</label>
                                                <input id="mobileStickyKey" type="text" placeholder="Enter Adsterra zone ID" 
                                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                                                <p class="text-xs text-gray-500 mt-1">320x50 Mobile Banner</p>
                                            </div>
                                            
                                            <div class="flex items-center space-x-3">
                                                <input id="enableMobileSticky" type="checkbox" class="h-4 w-4 text-blue-600">
                                                <label class="text-sm text-gray-700">Enable Mobile Sticky Ad</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Ad Settings -->
                                <div class="bg-gray-50 p-4 rounded-lg">
                                    <h4 class="font-bold text-gray-800 mb-4">‚öôÔ∏è Ad Settings</h4>
                                    
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ad Refresh Rate (minutes)</label>
                                            <select id="adRefreshRate" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="5">5 minutes</option>
                                                <option value="10" selected>10 minutes</option>
                                                <option value="15">15 minutes</option>
                                                <option value="30">30 minutes</option>
                                            </select>
                                        </div>
                                        
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">Ad Density</label>
                                            <select id="adDensity" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                                <option value="low">Low (Better UX)</option>
                                                <option value="medium" selected>Medium (Balanced)</option>
                                                <option value="high">High (More Revenue)</option>
                                            </select>
                                        </div>
                                        
                                        <div class="flex items-center space-x-3">
                                            <input id="enableAdBlock" type="checkbox" class="h-4 w-4 text-blue-600" checked>
                                            <label class="text-sm text-gray-700">Enable Ad Block Detection</label>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Action Buttons -->
                                <div class="flex gap-4">
                                    <button type="button" onclick="saveAdsterraConfig()" 
                                            class="btn-mobile bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-3 rounded-lg font-bold flex-1">
                                        üíæ Save Configuration
                                    </button>
                                    <button type="button" onclick="testAdsterraAds()" 
                                            class="btn-mobile bg-gradient-to-r from-orange-500 to-red-500 text-white px-6 py-3 rounded-lg font-bold flex-1">
                                        üß™ Test Ads
                                    </button>
                                    <button type="button" onclick="clearAdsterraConfig()" 
                                            class="btn-mobile bg-gradient-to-r from-gray-500 to-gray-600 text-white px-6 py-3 rounded-lg font-bold">
                                        üóëÔ∏è Clear
                                    </button>
                                </div>
                            </form>
                        </div>
                        
                        <!-- Ad Performance Analytics -->
                        <div class="bg-white p-6 rounded-xl shadow-lg mb-6">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">üìà Ad Performance Analytics</h3>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 text-center">
                                    <div class="text-lg font-bold text-blue-600" id="totalImpressions">0</div>
                                    <div class="text-sm text-gray-600">Total Impressions</div>
                                </div>
                                <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                                    <div class="text-lg font-bold text-green-600" id="totalClicks">0</div>
                                    <div class="text-sm text-gray-600">Total Clicks</div>
                                </div>
                                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4 text-center">
                                    <div class="text-lg font-bold text-purple-600" id="ctrRate">0%</div>
                                    <div class="text-sm text-gray-600">CTR Rate</div>
                                </div>
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 text-center">
                                    <div class="text-lg font-bold text-yellow-600" id="estimatedEarnings">$0.00</div>
                                    <div class="text-sm text-gray-600">Est. Earnings</div>
                                </div>
                            </div>
                            
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h4 class="font-bold text-gray-800 mb-3">Recent Activity</h4>
                                <div id="recentActivity" class="space-y-2 text-sm text-gray-600">
                                    <p>‚Ä¢ No recent activity</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="bg-white p-6 rounded-xl shadow-lg">
                            <h3 class="text-xl font-bold mb-4 text-gray-800">‚ö° Quick Actions</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <button onclick="refreshAllAds()" 
                                        class="btn-mobile bg-gradient-to-r from-blue-500 to-purple-500 text-white p-4 rounded-lg font-bold">
                                    üîÑ Refresh All Ads
                                </button>
                                <button onclick="exportAdData()" 
                                        class="btn-mobile bg-gradient-to-r from-green-500 to-teal-500 text-white p-4 rounded-lg font-bold">
                                    üìÑ Export Data
                                </button>
                                <button onclick="showAdsterraGuide()" 
                                        class="btn-mobile bg-gradient-to-r from-orange-500 to-red-500 text-white p-4 rounded-lg font-bold">
                                    üìö Setup Guide
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Admin Panel -->
            <div id="adminPanel" class="hidden">
                <div class="mb-8">
                    <h2 class="text-2xl font-bold text-red-600">Admin Panel</h2>
                    <p class="text-gray-600">Manage videos, offers, redemptions, and support tickets</p>
                </div>

                <!-- Admin Tab Navigation -->
                <nav class="flex space-x-8 mb-8" id="adminTabNavigation">
                    <button class="admin-tab-btn active py-2 px-1 border-b-2 border-red-500 font-medium text-red-600" data-tab="manageVideos">Manage Videos</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageOffers">Manage Offers</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageMovies">Manage Movies</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageDownloads">Download Verifications</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageOfferSubmissions">Offer Submissions</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageReferrals">Manage Referrals</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageProfiles">User Profiles</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageRedeem">Manage Redeem</button>
                    <button class="admin-tab-btn py-2 px-1 border-b-2 border-transparent font-medium text-gray-500 hover:text-gray-700" data-tab="manageSupport">Manage Support</button>
                </nav>

                <!-- Manage Videos -->
                <div id="manageVideos" class="admin-tab-content">
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Add Video</h3>
                            <form id="addVideoForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                    <input id="videoTitle" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <!-- Video Source Type Selection -->
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Video Source</label>
                                    <div class="flex space-x-4 mb-3">
                                        <label class="flex items-center">
                                            <input type="radio" name="videoSource" value="youtube" checked class="mr-2">
                                            <span class="text-sm">YouTube</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="radio" name="videoSource" value="embed" class="mr-2">
                                            <span class="text-sm">Custom Embed URL</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div id="youtubeSection" class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">YouTube ID</label>
                                    <input id="videoYoutubeId" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Extract ID from YouTube URL (e.g., dQw4w9WgXcQ)</p>
                                </div>
                                
                                <div id="embedSection" class="mb-4 hidden">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Custom Embed URL</label>
                                    <input id="videoEmbedUrl" type="url" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Enter full embed URL from any platform (Vimeo, Dailymotion, etc.)</p>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Points</label>
                                    <input id="videoPoints" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="videoDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">Add Video</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Existing Videos</h3>
                            <div id="adminVideosList" class="space-y-3">
                                <!-- Admin videos list will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manage Movies & Series -->
                <div id="manageMovies" class="admin-tab-content hidden">
                    <!-- Category Management -->
                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Manage Categories</h3>
                            <form id="addCategoryForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Category Name</label>
                                    <input id="categoryName" type="text" required placeholder="Action, Comedy, Drama, etc."
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <button type="submit" class="w-full bg-purple-600 text-white py-2 px-4 rounded hover:bg-purple-700">Add Category</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Existing Categories</h3>
                            <div id="categoriesList" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Categories will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Movie/Series Management -->
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Add Movie/Series</h3>
                            <form id="addMovieForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                                    <select id="movieType" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="movie">Movie</option>
                                        <option value="series">Series</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                    <input id="movieTitle" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                    <select id="movieLanguage" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="English">English</option>
                                        <option value="Hindi">Hindi</option>
                                        <option value="Spanish">Spanish</option>
                                        <option value="French">French</option>
                                        <option value="German">German</option>
                                        <option value="Japanese">Japanese</option>
                                        <option value="Korean">Korean</option>
                                        <option value="Chinese">Chinese</option>
                                        <option value="Other">Other</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Categories</label>
                                    <div class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                                        <div id="categoryCheckboxes" class="space-y-2">
                                            <!-- Category checkboxes will be loaded here -->
                                        </div>
                                        <div class="mt-3 pt-3 border-t border-gray-200">
                                            <div class="flex gap-2">
                                                <input id="newCategoryInput" type="text" placeholder="Add new category..." 
                                                       class="flex-1 px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500">
                                                <button type="button" onclick="addNewCategory()" 
                                                        class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700 transition duration-200">
                                                    ‚ûï Add
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Select multiple categories or add new ones</p>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Release Year</label>
                                    <select id="movieReleaseYear" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <!-- Years will be populated here -->
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Video Quality</label>
                                    <select id="movieQuality" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="480p">480p</option>
                                        <option value="720p">720p</option>
                                        <option value="1080p">1080p</option>
                                        <option value="2K">2K</option>
                                        <option value="4K">4K</option>
                                        <option value="WebDL">WebDL</option>
                                        <option value="BluRay">BluRay</option>
                                        <option value="CamRip">CamRip</option>
                                        <option value="HD 720p">HD 720p</option>
                                        <option value="HD 1080p">HD 1080p</option>
                                    </select>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Poster URL</label>
                                    <input id="moviePoster" type="url" placeholder="https://example.com/poster.jpg"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Download Link</label>
                                    <input id="movieDownloadLink" type="url" placeholder="https://example.com/download"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Watch Link (Embed)</label>
                                    <input id="movieWatchLink" type="url" placeholder="https://example.com/embed"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Download Points</label>
                                    <input id="movieDownloadPoints" type="number" min="0" placeholder="Points for downloading"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Summary</label>
                                    <textarea id="movieSummary" rows="4" placeholder="Movie/Series summary..."
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-red-600 text-white py-2 px-4 rounded hover:bg-red-700">Add Movie/Series</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Existing Movies & Series</h3>
                            <div id="adminMoviesList" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Movies & Series will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Manage Download Verifications -->
                <div id="manageDownloads" class="admin-tab-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Download Verifications</h3>
                            <select id="downloadStatusFilter" onchange="loadAdminDownloadVerifications()" 
                                    class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">All Verifications</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div id="adminDownloadVerificationsList" class="space-y-4">
                            <!-- Download verifications will be loaded here -->
                        </div>
                    </div>
                </div>
                    <div class="grid md:grid-cols-2 gap-8">
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Add Offer</h3>
                            <form id="addOfferForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                    <input id="offerTitle" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Task</label>
                                    <input id="offerTask" type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Note</label>
                                    <input id="offerNote" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Offer Link (Optional)</label>
                                    <input id="offerLink" type="url" placeholder="https://example.com/offer" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Users will click this link to start the offer. Leave empty for manual approval offers.</p>
                                </div>
                                <div class="mb-4">
                                    <label class="flex items-center">
                                        <input id="offerAutoApprove" type="checkbox" class="mr-2">
                                        <span class="text-sm text-gray-700">Auto-approve when user clicks link (for external offers)</span>
                                    </label>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Points</label>
                                    <input id="offerPoints" type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description</label>
                                    <textarea id="offerDescription" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                                </div>
                                <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">Add Offer</button>
                            </form>
                        </div>
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Existing Offers</h3>
                            <div id="adminOffersList" class="space-y-3">
                                <!-- Admin offers list will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manage Offer Submissions -->
                <div id="manageOfferSubmissions" class="admin-tab-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">Offer Submissions</h3>
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Filter by Status</label>
                            <select id="statusFilter" onchange="loadAdminOfferSubmissions()" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="all">All Submissions</option>
                                <option value="started">Started</option>
                                <option value="pending">Pending</option>
                                <option value="processing">Processing</option>
                                <option value="completed">Completed</option>
                                <option value="rejected">Rejected</option>
                            </select>
                        </div>
                        <div id="adminOfferSubmissionsList" class="space-y-4">
                            <!-- Admin offer submissions will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Manage Redeem -->
                <div id="manageRedeem" class="admin-tab-content hidden">
                    <div class="grid md:grid-cols-2 gap-8 mb-8">
                        <!-- Add Redeem Option -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Add Redeem Option</h3>
                            <form id="addRedeemOptionForm">
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Cash Amount ($)</label>
                                    <input id="redeemCashAmount" type="number" step="0.01" min="0" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">INR Amount (‚Çπ)</label>
                                    <input id="redeemInrAmount" type="number" step="0.01" min="0" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <p class="text-xs text-gray-500 mt-1">Enter the equivalent amount in Indian Rupees</p>
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Points Required</label>
                                    <input id="redeemPointsRequired" type="number" min="1" required 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Description (Optional)</label>
                                    <input id="redeemDescription" type="text" placeholder="e.g., 'Popular choice', 'Best value'" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div class="mb-4">
                                    <label class="flex items-center">
                                        <input id="redeemActive" type="checkbox" checked class="mr-2">
                                        <span class="text-sm text-gray-700">Active (visible to users)</span>
                                    </label>
                                </div>
                                <button type="submit" class="w-full bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                                    Add Redeem Option
                                </button>
                            </form>
                        </div>
                        
                        <!-- Existing Redeem Options -->
                        <div class="bg-white p-6 rounded-lg shadow">
                            <h3 class="text-xl font-semibold mb-4">Redeem Options</h3>
                            <div id="adminRedeemOptionsList" class="space-y-3">
                                <!-- Admin redeem options will be loaded here -->
                            </div>
                        </div>
                    </div>
                    
                    <!-- Withdrawal Requests Management -->
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Withdrawal Requests</h3>
                            <div class="flex space-x-2">
                                <select id="withdrawalStatusFilter" onchange="loadAdminWithdrawals()" 
                                        class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Requests</option>
                                    <option value="pending">Pending</option>
                                    <option value="approved">Approved</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                                <button onclick="exportWithdrawals()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                    Export Data
                                </button>
                                <button onclick="bulkUpdateWithdrawals()" class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">
                                    Bulk Update
                                </button>
                            </div>
                        </div>
                        <div id="adminWithdrawalsList" class="space-y-4">
                            <!-- Admin withdrawal requests will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Manage Referrals -->
                <div id="manageReferrals" class="admin-tab-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">Referral Management</h3>
                            <div class="flex space-x-2">
                                <select id="referralStatusFilter" onchange="loadAdminReferrals()" 
                                        class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="all">All Referrals</option>
                                    <option value="completed">Completed</option>
                                    <option value="pending">Pending</option>
                                </select>
                                <button onclick="exportReferrals()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    Export Data
                                </button>
                            </div>
                        </div>
                        <div id="adminReferralsList" class="space-y-4">
                            <!-- Admin referrals will be loaded here -->
                        </div>
                    </div>
                </div>
                
                <!-- Manage User Profiles -->
                <div id="manageProfiles" class="admin-tab-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-xl font-semibold">User Profiles & Account Deletions</h3>
                            <div class="flex space-x-2">
                                <input id="userSearchInput" type="text" placeholder="Search users..." 
                                       class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <button onclick="searchUsers()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                    Search
                                </button>
                                <button onclick="loadAllUserProfiles()" class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700">
                                    Show All
                                </button>
                            </div>
                        </div>
                        
                        <!-- User Profiles Table -->
                        <div class="mb-8">
                            <h4 class="text-lg font-semibold mb-3">User Profiles</h4>
                            <div id="adminUserProfilesList" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- User profiles will be loaded here -->
                            </div>
                        </div>
                        
                        <!-- Account Deletion Requests -->
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-red-600">Account Deletion Requests</h4>
                            <div id="adminDeletionRequestsList" class="space-y-3">
                                <!-- Deletion requests will be loaded here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Manage Support -->
                <div id="manageSupport" class="admin-tab-content hidden">
                    <div class="bg-white p-6 rounded-lg shadow">
                        <h3 class="text-xl font-semibold mb-4">Support Tickets</h3>
                        <div id="adminSupportList" class="space-y-4">
                            <!-- Admin support tickets will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyA7xSH2UDMVzBbtHeQIP5AI3gtp4H5STsc",
            authDomain: "rewardapp-6b9a6.firebaseapp.com",
            projectId: "rewardapp-6b9a6",
            storageBucket: "rewardapp-6b9a6.firebasestorage.app",
            messagingSenderId: "334697205161",
            appId: "1:334697205161:web:c2381dad4f5011ed8008b8",
            measurementId: "G-NZ07S2HP0Q"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Global variables
        let currentUser = null;
        let userProfile = null;
        let isAdmin = false;
        const ADMIN_EMAIL = 'admin@rafiqul.com';

        // Security function to check admin access
        function checkAdminAccess() {
            if (!currentUser || currentUser.email !== ADMIN_EMAIL) {
                alert('Unauthorized access. Admin privileges required.');
                return false;
            }
            return true;
        }

        // Function to show/hide admin tab based on user permissions
        function updateAdminTabVisibility() {
            const adminTabBtn = document.getElementById('adminTabBtn');
            if (adminTabBtn) {
                if (isAdmin) {
                    adminTabBtn.classList.remove('hidden');
                } else {
                    adminTabBtn.classList.add('hidden');
                    // If user is currently on admin tab and is not admin, switch to videos tab
                    const activeTab = document.querySelector('.tab-btn.active');
                    if (activeTab && activeTab.dataset.tab === 'admin') {
                        switchTab('videos');
                    }
                }
            }
        }

        // Generate unique 5-digit refer code
        function generateReferCode() {
            const digits = '0123456789';
            let result = '';
            for (let i = 0; i < 5; i++) {
                result += digits.charAt(Math.floor(Math.random() * digits.length));
            }
            return result;
        }
        
        // Handle referral signup
        async function handleReferralSignup(referCode, newUserId, newUserName, batch) {
            try {
                // Find user with this refer code
                const usersSnapshot = await db.collection('users').get();
                let referrerFound = false;
                
                for (const userDoc of usersSnapshot.docs) {
                    const profileDoc = await db.collection('users').doc(userDoc.id).collection('profile').doc('data').get();
                    if (profileDoc.exists && profileDoc.data().referCode === referCode) {
                        const referrerData = profileDoc.data();
                        const referralPoints = 50; // Points awarded for successful referral
                        
                        // Update referrer's points and referral count
                        const newPoints = (referrerData.points || 0) + referralPoints;
                        const newReferrals = (referrerData.totalReferrals || 0) + 1;
                        
                        batch.update(profileDoc.ref, {
                            points: newPoints,
                            totalReferrals: newReferrals,
                            totalEarned: (referrerData.totalEarned || 0) + referralPoints
                        });
                        
                        // Create referral record for admin tracking
                        const referralRef = db.collection('admin_referrals').doc();
                        batch.set(referralRef, {
                            referrerId: userDoc.id,
                            referrerName: referrerData.name || 'Unknown',
                            referrerEmail: referrerData.email || 'Unknown',
                            newUserId: newUserId,
                            newUserName: newUserName,
                            referCode: referCode,
                            pointsAwarded: referralPoints,
                            status: 'completed',
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        referrerFound = true;
                        break;
                    }
                }
                
                if (!referrerFound) {
                    console.log('Refer code not found:', referCode);
                }
                
            } catch (error) {
                console.error('Error processing referral:', error);
            }
        }
        
        // Open profile modal
        function openProfileModal() {
            if (!currentUser || !userProfile) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-2 sm:p-4';
            modal.id = 'profileModal';
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-6xl max-h-[95vh] overflow-hidden shadow-2xl flex flex-col">
                    <div class="sticky top-0 bg-gradient-to-r from-purple-500 to-indigo-500 text-white p-4 sm:p-6 rounded-t-2xl flex-shrink-0">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl sm:text-3xl">üë§</span>
                                <div>
                                    <h3 class="text-xl sm:text-2xl font-bold">My Profile</h3>
                                    <p class="text-purple-100 text-sm sm:text-base">Manage your account and view earnings</p>
                                </div>
                            </div>
                            <button onclick="closeProfileModal()" class="text-white hover:text-gray-200 text-xl sm:text-2xl font-bold p-2 touch-target">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto p-4 sm:p-6">
                        <!-- Profile Info Section -->
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 sm:p-6 mb-4 sm:mb-6">
                            <div class="flex flex-col sm:flex-row sm:items-center justify-between mb-4 gap-3">
                                <h4 class="text-lg sm:text-xl font-bold text-gray-800 flex items-center">
                                    <span class="text-xl sm:text-2xl mr-2">üìù</span> Profile Information
                                </h4>
                                <button onclick="editProfile()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 sm:px-4 py-2 rounded-lg font-bold transition duration-200 text-sm sm:text-base touch-target">
                                    ‚úèÔ∏è Edit
                                </button>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Name</p>
                                    <p class="font-bold text-gray-800 text-sm sm:text-base break-words" id="profileName">${userProfile.name || 'Not set'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Email</p>
                                    <p class="font-bold text-gray-800 text-sm sm:text-base break-all" id="profileEmail">${userProfile.email || currentUser.email}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Date of Birth</p>
                                    <p class="font-bold text-gray-800 text-sm sm:text-base" id="profileDob">${userProfile.dateOfBirth || 'Not set'}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 mb-1">Member Since</p>
                                    <p class="font-bold text-gray-800 text-sm sm:text-base">${userProfile.createdAt ? new Date(userProfile.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Wallet Details Section -->
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-4 sm:p-6 mb-4 sm:mb-6">
                            <h4 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <span class="text-xl sm:text-2xl mr-2">üí∞</span> Wallet Details
                            </h4>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-4">
                                <div class="bg-white p-3 sm:p-4 rounded-lg border-2 border-green-200">
                                    <div class="text-center">
                                        <div class="text-xl sm:text-2xl font-bold text-green-600">${userProfile.points || 0}</div>
                                        <div class="text-xs sm:text-sm text-gray-600">Current Points</div>
                                    </div>
                                </div>
                                <div class="bg-white p-3 sm:p-4 rounded-lg border-2 border-blue-200">
                                    <div class="text-center">
                                        <div class="text-xl sm:text-2xl font-bold text-blue-600">${userProfile.totalEarned || 0}</div>
                                        <div class="text-xs sm:text-sm text-gray-600">Total Earned</div>
                                    </div>
                                </div>
                                <div class="bg-white p-3 sm:p-4 rounded-lg border-2 border-purple-200">
                                    <div class="text-center">
                                        <div class="text-xl sm:text-2xl font-bold text-purple-600">\$${((userProfile.totalWithdrawn || 0) / 100).toFixed(2)}</div>
                                        <div class="text-xs sm:text-sm text-gray-600">Total Withdrawn</div>
                                    </div>
                                </div>
                            </div>
                            <div class="p-3 sm:p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                                <p class="text-sm text-yellow-800">
                                    <span class="font-bold">üìà Available to Redeem:</span> ${userProfile.points || 0} points 
                                    <span class="text-gray-600">(‚âà \$${((userProfile.points || 0) / 100).toFixed(2)})</span>
                                </p>
                            </div>
                        </div>
                        
                        <!-- Referral Section -->
                        <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-4 sm:p-6 mb-4 sm:mb-6">
                            <h4 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <span class="text-xl sm:text-2xl mr-2">üîó</span> Referral System
                            </h4>
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600 mb-2">Your Refer Code</p>
                                    <div class="flex flex-col sm:flex-row items-start sm:items-center space-y-2 sm:space-y-0 sm:space-x-2">
                                        <code class="bg-gray-100 px-3 py-2 rounded-lg font-bold text-base sm:text-lg break-all flex-1 min-w-0">${userProfile.referCode || 'Not set'}</code>
                                        <button onclick="copyReferCode()" class="bg-pink-500 hover:bg-pink-600 text-white px-3 py-2 rounded-lg font-bold text-sm whitespace-nowrap touch-target">
                                            üìã Copy
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">Share this code with friends to earn 50 points per referral!</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600 mb-2">Total Referrals</p>
                                    <div class="text-2xl sm:text-3xl font-bold text-pink-600">${userProfile.totalReferrals || 0}</div>
                                    <p class="text-xs text-gray-500">Friends who joined using your code</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Account Actions Section -->
                        <div class="bg-gradient-to-r from-red-50 to-pink-50 rounded-xl p-4 sm:p-6">
                            <h4 class="text-lg sm:text-xl font-bold text-gray-800 mb-4 flex items-center">
                                <span class="text-xl sm:text-2xl mr-2">‚öôÔ∏è</span> Account Actions
                            </h4>
                            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                                <button onclick="changePassword()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-3 rounded-lg font-bold transition duration-200 flex items-center justify-center text-sm sm:text-base touch-target">
                                    <span class="text-lg mr-2">üîí</span> Change Password
                                </button>
                                <button onclick="requestAccountDeletion()" class="bg-red-500 hover:bg-red-600 text-white px-4 py-3 rounded-lg font-bold transition duration-200 flex items-center justify-center text-sm sm:text-base touch-target">
                                    <span class="text-lg mr-2">üóëÔ∏è</span> Delete Account
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on escape
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeProfileModal();
                }
            };
            document.addEventListener('keydown', handleEscape);
            modal.escapeHandler = handleEscape;
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    closeProfileModal();
                }
            });
        }
        
        function closeProfileModal() {
            const modal = document.getElementById('profileModal');
            if (modal) {
                if (modal.escapeHandler) {
                    document.removeEventListener('keydown', modal.escapeHandler);
                }
                modal.remove();
            }
        }
        
        function copyReferCode() {
            const referCode = userProfile.referCode;
            if (referCode) {
                navigator.clipboard.writeText(referCode).then(() => {
                    alert('üéâ Refer code copied to clipboard!\n\nShare it with friends to earn 50 points per referral!');
                }).catch(() => {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = referCode;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert('üéâ Refer code copied to clipboard!');
                });
            }
        }
        
        function editProfile() {
            const editModal = document.createElement('div');
            editModal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[70] p-2 sm:p-4';
            
            editModal.innerHTML = `
                <div class="bg-white rounded-2xl w-full max-w-md max-h-[95vh] overflow-y-auto p-4 sm:p-6 shadow-2xl">
                    <div class="text-center mb-6">
                        <span class="text-2xl sm:text-3xl">‚úèÔ∏è</span>
                        <h3 class="text-lg sm:text-xl font-bold text-gray-800 mt-2">Edit Profile</h3>
                    </div>
                    
                    <form id="editProfileForm">
                        <div class="mb-4">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                            <input id="editName" type="text" value="${userProfile.name || ''}" required 
                                   class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-base">
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Date of Birth</label>
                            <input id="editDob" type="date" value="${userProfile.dateOfBirth || ''}" required 
                                   class="w-full px-3 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500 text-base">
                        </div>
                        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                            <button type="button" onclick="this.closest('.fixed').remove()" 
                                    class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 touch-target">
                                Cancel
                            </button>
                            <button type="submit" 
                                    class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200 touch-target">
                                Save
                            </button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(editModal);
            
            document.getElementById('editProfileForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('editName').value.trim();
                const dob = document.getElementById('editDob').value;
                
                if (!name || !dob) {
                    alert('Please fill in all fields.');
                    return;
                }
                
                try {
                    await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').update({
                        name: name,
                        dateOfBirth: dob,
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    
                    // Update local profile
                    userProfile.name = name;
                    userProfile.dateOfBirth = dob;
                    
                    // Close edit modal and refresh profile modal
                    editModal.remove();
                    closeProfileModal();
                    openProfileModal();
                    
                    alert('‚úÖ Profile updated successfully!');
                } catch (error) {
                    console.error('Error updating profile:', error);
                    alert('‚ùå Error updating profile. Please try again.');
                }
            });
        }
        
        function changePassword() {
            const user = auth.currentUser;
            if (user && user.email) {
                auth.sendPasswordResetEmail(user.email).then(() => {
                    alert('üì¨ Password reset email sent!\n\nCheck your inbox and follow the instructions to reset your password.');
                }).catch((error) => {
                    console.error('Error sending password reset:', error);
                    alert('‚ùå Error sending password reset email. Please try again.');
                });
            }
        }
        
        function requestAccountDeletion() {
            const confirmation = prompt('‚ö†Ô∏è ACCOUNT DELETION REQUEST\n\nThis action cannot be undone! Your account and all data will be permanently deleted.\n\nType "DELETE MY ACCOUNT" to confirm:');
            
            if (confirmation === 'DELETE MY ACCOUNT') {
                const reason = prompt('üìù Please tell us why you\'re leaving (optional):') || 'No reason provided';
                
                // Create deletion request for admin
                db.collection('admin_deletion_requests').add({
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    userName: userProfile.name || 'Unknown',
                    reason: reason,
                    points: userProfile.points || 0,
                    totalEarned: userProfile.totalEarned || 0,
                    status: 'pending',
                    requestedAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    alert('üì´ Account deletion request submitted!\n\nYour request has been sent to admin for processing. You will receive an email confirmation once processed.');
                    closeProfileModal();
                }).catch((error) => {
                    console.error('Error submitting deletion request:', error);
                    alert('‚ùå Error submitting deletion request. Please try again.');
                });
            } else if (confirmation !== null) {
                alert('‚ùå Account deletion cancelled. Please type exactly "DELETE MY ACCOUNT" to confirm.');
            }
        }

        // Admin referral management functions
        async function loadAdminReferrals() {
            if (!checkAdminAccess()) return;
            
            try {
                const filter = document.getElementById('referralStatusFilter')?.value || 'all';
                let query = db.collection('admin_referrals').orderBy('createdAt', 'desc');
                
                if (filter !== 'all') {
                    query = query.where('status', '==', filter);
                }
                
                const snapshot = await query.get();
                const listDiv = document.getElementById('adminReferralsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No referrals found.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const referral = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = referral.status === 'completed' ? 'text-green-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-lg">üîó Referral Success</h4>
                                <div class="grid md:grid-cols-2 gap-4 mt-2">
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>Referrer:</strong> ${referral.referrerName || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>Email:</strong> ${referral.referrerEmail || 'Unknown'}</p>
                                        <p class="text-sm text-green-600 font-medium"><strong>Points Awarded:</strong> ${referral.pointsAwarded || 0}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>New User:</strong> ${referral.newUserName || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>Refer Code Used:</strong> ${referral.referCode || 'Unknown'}</p>
                                        <p class="text-xs text-gray-500"><strong>Date:</strong> ${referral.createdAt ? new Date(referral.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                    </div>
                                </div>
                            </div>
                            <span class="text-sm ${statusColor} capitalize font-semibold px-3 py-1 bg-gray-50 rounded">
                                ${referral.status || 'completed'}
                            </span>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading admin referrals:', error);
                const listDiv = document.getElementById('adminReferralsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading referrals. Please try again.</p>';
            }
        }
        
        function exportReferrals() {
            if (!checkAdminAccess()) return;
            
            db.collection('admin_referrals').orderBy('createdAt', 'desc').get().then(snapshot => {
                const data = [];
                snapshot.forEach(doc => {
                    const referral = doc.data();
                    data.push({
                        'Referrer Name': referral.referrerName || 'Unknown',
                        'Referrer Email': referral.referrerEmail || 'Unknown',
                        'New User Name': referral.newUserName || 'Unknown',
                        'Refer Code': referral.referCode || 'Unknown',
                        'Points Awarded': referral.pointsAwarded || 0,
                        'Status': referral.status || 'completed',
                        'Date': referral.createdAt ? new Date(referral.createdAt.toDate()).toLocaleDateString() : 'Recently'
                    });
                });
                
                const csv = convertToCSV(data);
                downloadCSV(csv, 'referrals_export.csv');
            }).catch(error => {
                console.error('Error exporting referrals:', error);
                alert('Error exporting referrals. Please try again.');
            });
        }
        
        // Admin user profile management functions
        async function loadAllUserProfiles() {
            if (!checkAdminAccess()) return;
            
            try {
                const usersSnapshot = await db.collection('users').get();
                const listDiv = document.getElementById('adminUserProfilesList');
                listDiv.innerHTML = '<p class="text-gray-500">Loading user profiles...</p>';
                
                const profiles = [];
                
                for (const userDoc of usersSnapshot.docs) {
                    try {
                        const profileDoc = await db.collection('users').doc(userDoc.id).collection('profile').doc('data').get();
                        if (profileDoc.exists) {
                            profiles.push({
                                userId: userDoc.id,
                                ...profileDoc.data()
                            });
                        }
                    } catch (error) {
                        console.error('Error loading profile for user:', userDoc.id, error);
                    }
                }
                
                listDiv.innerHTML = '';
                
                if (profiles.length === 0) {
                    listDiv.innerHTML = '<p class="text-gray-500">No user profiles found.</p>';
                    return;
                }
                
                profiles.sort((a, b) => (b.createdAt?.toDate() || 0) - (a.createdAt?.toDate() || 0));
                
                profiles.forEach(profile => {
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4 bg-gray-50';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-lg">üë§ ${profile.name || 'Unknown Name'}</h4>
                                <div class="grid md:grid-cols-3 gap-4 mt-2">
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>Email:</strong> ${profile.email || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>DOB:</strong> ${profile.dateOfBirth || 'Not set'}</p>
                                        <p class="text-sm text-gray-600"><strong>Joined:</strong> ${profile.createdAt ? new Date(profile.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-green-600"><strong>Points:</strong> ${profile.points || 0}</p>
                                        <p class="text-sm text-blue-600"><strong>Total Earned:</strong> ${profile.totalEarned || 0}</p>
                                        <p class="text-sm text-purple-600"><strong>Withdrawn:</strong> \$${((profile.totalWithdrawn || 0) / 100).toFixed(2)}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-pink-600"><strong>Refer Code:</strong> ${profile.referCode || 'Not set'}</p>
                                        <p class="text-sm text-indigo-600"><strong>Referrals:</strong> ${profile.totalReferrals || 0}</p>
                                        <p class="text-sm text-gray-600"><strong>Referred By:</strong> ${profile.referredBy || 'Direct signup'}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <button onclick="viewUserDetails('${profile.userId}')" 
                                        class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                    View Details
                                </button>
                                <button onclick="adjustUserPoints('${profile.userId}', ${profile.points || 0})" 
                                        class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                                    Adjust Points
                                </button>
                            </div>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading user profiles:', error);
                const listDiv = document.getElementById('adminUserProfilesList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading user profiles. Please try again.</p>';
            }
        }
        
        async function searchUsers() {
            if (!checkAdminAccess()) return;
            
            const searchTerm = document.getElementById('userSearchInput').value.trim().toLowerCase();
            if (!searchTerm) {
                loadAllUserProfiles();
                return;
            }
            
            try {
                const usersSnapshot = await db.collection('users').get();
                const listDiv = document.getElementById('adminUserProfilesList');
                listDiv.innerHTML = '<p class="text-gray-500">Searching...</p>';
                
                const profiles = [];
                
                for (const userDoc of usersSnapshot.docs) {
                    try {
                        const profileDoc = await db.collection('users').doc(userDoc.id).collection('profile').doc('data').get();
                        if (profileDoc.exists) {
                            const profile = profileDoc.data();
                            if (
                                (profile.name && profile.name.toLowerCase().includes(searchTerm)) ||
                                (profile.email && profile.email.toLowerCase().includes(searchTerm)) ||
                                (profile.referCode && profile.referCode.toLowerCase().includes(searchTerm))
                            ) {
                                profiles.push({
                                    userId: userDoc.id,
                                    ...profile
                                });
                            }
                        }
                    } catch (error) {
                        console.error('Error searching profile for user:', userDoc.id, error);
                    }
                }
                
                listDiv.innerHTML = '';
                
                if (profiles.length === 0) {
                    listDiv.innerHTML = `<p class="text-gray-500">No users found matching "${searchTerm}".</p>`;
                    return;
                }
                
                profiles.forEach(profile => {
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4 bg-yellow-50';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-lg">üîç ${profile.name || 'Unknown Name'}</h4>
                                <div class="grid md:grid-cols-3 gap-4 mt-2">
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>Email:</strong> ${profile.email || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>DOB:</strong> ${profile.dateOfBirth || 'Not set'}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-green-600"><strong>Points:</strong> ${profile.points || 0}</p>
                                        <p class="text-sm text-blue-600"><strong>Total Earned:</strong> ${profile.totalEarned || 0}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-pink-600"><strong>Refer Code:</strong> ${profile.referCode || 'Not set'}</p>
                                        <p class="text-sm text-indigo-600"><strong>Referrals:</strong> ${profile.totalReferrals || 0}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error searching users:', error);
                const listDiv = document.getElementById('adminUserProfilesList');
                listDiv.innerHTML = '<p class="text-red-500">Error searching users. Please try again.</p>';
            }
        }
        
        function adjustUserPoints(userId, currentPoints) {
            if (!checkAdminAccess()) return;
            
            const adjustment = prompt(`Current points: ${currentPoints}\n\nEnter point adjustment (positive to add, negative to subtract):`);
            if (adjustment === null) return;
            
            const adjustmentValue = parseInt(adjustment);
            if (isNaN(adjustmentValue)) {
                alert('Please enter a valid number.');
                return;
            }
            
            const newPoints = Math.max(0, currentPoints + adjustmentValue);
            const reason = prompt('Reason for adjustment (optional):') || 'Admin adjustment';
            
            db.collection('users').doc(userId).collection('profile').doc('data').update({
                points: newPoints,
                totalEarned: firebase.firestore.FieldValue.increment(adjustmentValue > 0 ? adjustmentValue : 0)
            }).then(() => {
                // Log the adjustment
                return db.collection('admin_point_adjustments').add({
                    userId: userId,
                    adjustment: adjustmentValue,
                    previousPoints: currentPoints,
                    newPoints: newPoints,
                    reason: reason,
                    adminEmail: currentUser.email,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            }).then(() => {
                alert(`‚úÖ Points adjusted successfully!

Previous: ${currentPoints}
New: ${newPoints}
Adjustment: ${adjustmentValue}`);
                loadAllUserProfiles();
            }).catch(error => {
                console.error('Error adjusting points:', error);
                alert('‚ùå Error adjusting points. Please try again.');
            });
        }
        
        async function loadAdminDeletionRequests() {
            if (!checkAdminAccess()) return;
            
            try {
                const snapshot = await db.collection('admin_deletion_requests').orderBy('requestedAt', 'desc').get();
                const listDiv = document.getElementById('adminDeletionRequestsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No deletion requests found.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const request = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4 bg-red-50 border-red-200';
                    
                    const statusColor = request.status === 'completed' ? 'text-green-600' : 
                                       request.status === 'rejected' ? 'text-red-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-lg text-red-700">üóëÔ∏è Account Deletion Request</h4>
                                <div class="grid md:grid-cols-2 gap-4 mt-2">
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>User:</strong> ${request.userName || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>Email:</strong> ${request.userEmail || 'Unknown'}</p>
                                        <p class="text-sm text-gray-600"><strong>Points:</strong> ${request.points || 0}</p>
                                    </div>
                                    <div>
                                        <p class="text-sm text-gray-600"><strong>Total Earned:</strong> ${request.totalEarned || 0}</p>
                                        <p class="text-sm text-gray-600"><strong>Reason:</strong> ${request.reason || 'No reason provided'}</p>
                                        <p class="text-xs text-gray-500"><strong>Requested:</strong> ${request.requestedAt ? new Date(request.requestedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex flex-col space-y-2">
                                <span class="text-sm ${statusColor} capitalize font-semibold px-3 py-1 bg-white rounded border">
                                    ${request.status || 'pending'}
                                </span>
                                ${request.status === 'pending' ? `
                                    <button onclick="processAccountDeletion('${doc.id}', '${request.userId}', 'approve')" 
                                            class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                        Approve Deletion
                                    </button>
                                    <button onclick="processAccountDeletion('${doc.id}', '${request.userId}', 'reject')" 
                                            class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700">
                                        Reject Request
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading deletion requests:', error);
                const listDiv = document.getElementById('adminDeletionRequestsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading deletion requests. Please try again.</p>';
            }
        }
        
        function processAccountDeletion(requestId, userId, action) {
            if (!checkAdminAccess()) return;
            
            const confirmMessage = action === 'approve' ? 
                '‚ö†Ô∏è Are you sure you want to APPROVE this account deletion?\n\nThis will PERMANENTLY DELETE all user data and cannot be undone!' :
                'Are you sure you want to REJECT this deletion request?';
                
            if (!confirm(confirmMessage)) return;
            
            if (action === 'approve') {
                // For demonstration, we'll just mark as completed
                // In a real implementation, you'd implement actual account deletion
                db.collection('admin_deletion_requests').doc(requestId).update({
                    status: 'completed',
                    processedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    processedBy: currentUser.email
                }).then(() => {
                    alert('‚úÖ Account deletion request approved!\n\nNote: In a production environment, this would trigger actual account deletion.');
                    loadAdminDeletionRequests();
                }).catch(error => {
                    console.error('Error processing deletion:', error);
                    alert('‚ùå Error processing deletion request.');
                });
            } else {
                const reason = prompt('Reason for rejection (optional):') || 'Admin decision';
                
                db.collection('admin_deletion_requests').doc(requestId).update({
                    status: 'rejected',
                    rejectionReason: reason,
                    processedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    processedBy: currentUser.email
                }).then(() => {
                    alert('‚úÖ Account deletion request rejected.');
                    loadAdminDeletionRequests();
                }).catch(error => {
                    console.error('Error rejecting deletion:', error);
                    alert('‚ùå Error rejecting deletion request.');
                });
            }
        }
        
        // Utility functions for CSV export
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvHeaders = headers.join(',');
            
            const csvRows = data.map(row => {
                return headers.map(header => {
                    const value = row[header] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                }).join(',');
            });
            
            return [csvHeaders, ...csvRows].join('\n');
        }
        
        function downloadCSV(csv, filename) {
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // URL validation function
        function isValidUrl(string) {
            try {
                const url = new URL(string);
                return url.protocol === 'http:' || url.protocol === 'https:';
            } catch (_) {
                return false;
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeDailyReset();
        });

        function initializeApp() {
            // Auth state listener
            auth.onAuthStateChanged(user => {
                if (user) {
                    currentUser = user;
                    isAdmin = user.email === ADMIN_EMAIL;
                    loadUserProfile();
                    showApp();
                    updateAdminTabVisibility(); // Show/hide admin tab based on user permissions
                } else {
                    currentUser = null;
                    userProfile = null;
                    isAdmin = false;
                    showAuth();
                    updateAdminTabVisibility(); // Hide admin tab when not logged in
                }
                hideLoading();
            });

            // Auth form handlers
            setupAuthHandlers();
            
            // Tab navigation
            setupTabNavigation();
            
            // Handle window resize for mobile navigation
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    initializeMobileNavigation();
                    updateScrollIndicators();
                }, 100);
            });
        }

        // Daily Reset System - Resets all tasks at midnight
        function initializeDailyReset() {
            // Set up interval to check for midnight reset every minute
            setInterval(checkAndResetDaily, 60000); // Check every minute
            
            // Also check immediately on load
            setTimeout(checkAndResetDaily, 5000); // Wait 5 seconds for auth to settle
        }
        
        async function checkAndResetDaily() {
            if (!currentUser) return;
            
            try {
                const now = new Date();
                const today = now.toDateString();
                
                // Get user's last reset date
                const userDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('profile').doc('data').get();
                    
                if (!userDoc.exists) return;
                
                const userData = userDoc.data();
                const lastReset = userData.lastDailyReset;
                const lastResetDate = lastReset ? new Date(lastReset.toDate()).toDateString() : null;
                
                // If it's a new day and not reset yet, perform daily reset
                if (lastResetDate !== today) {
                    console.log('Performing daily reset for user:', currentUser.email);
                    await performDailyReset();
                }
                
                // Schedule next reset at midnight
                scheduleNextMidnightReset();
                
            } catch (error) {
                console.error('Error checking daily reset:', error);
            }
        }
        
        async function performDailyReset() {
            if (!currentUser) return;
            
            try {
                const batch = db.batch();
                const userRef = db.collection('users').doc(currentUser.uid);
                
                // Clear watched videos
                const watchedVideosSnapshot = await userRef.collection('watchedVideos').get();
                watchedVideosSnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                // Clear completed offers (but keep rejected/pending ones)
                const completedOffersSnapshot = await userRef.collection('completedOffers').get();
                completedOffersSnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                // Reset started offers that are completed
                const startedOffersSnapshot = await userRef.collection('startedOffers').get();
                startedOffersSnapshot.forEach(doc => {
                    const offerData = doc.data();
                    if (offerData.status === 'completed') {
                        batch.delete(doc.ref);
                    }
                });
                
                // Clear movie downloads that are completed
                const downloadedMoviesSnapshot = await userRef.collection('downloadedMovies').get();
                downloadedMoviesSnapshot.forEach(doc => {
                    batch.delete(doc.ref);
                });
                
                // Clear download history that are completed
                const downloadHistorySnapshot = await userRef.collection('downloadHistory').get();
                downloadHistorySnapshot.forEach(doc => {
                    const downloadData = doc.data();
                    if (downloadData.status === 'completed' || downloadData.status === 'verified') {
                        batch.delete(doc.ref);
                    }
                });
                
                // Update last reset timestamp
                const profileRef = userRef.collection('profile').doc('data');
                batch.update(profileRef, {
                    lastDailyReset: firebase.firestore.FieldValue.serverTimestamp(),
                    dailyResetCount: firebase.firestore.FieldValue.increment(1)
                });
                
                await batch.commit();
                
                console.log('Daily reset completed successfully');
                
                // Show notification to user if they're active
                if (document.visibilityState === 'visible') {
                    showDailyResetNotification();
                }
                
                // Refresh current tab content if applicable
                refreshCurrentTabAfterReset();
                
            } catch (error) {
                console.error('Error performing daily reset:', error);
            }
        }
        
        function scheduleNextMidnightReset() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0); // Set to midnight
            
            const msUntilMidnight = tomorrow.getTime() - now.getTime();
            
            // Clear existing timeout if any
            if (window.midnightResetTimeout) {
                clearTimeout(window.midnightResetTimeout);
            }
            
            // Set timeout for midnight reset
            window.midnightResetTimeout = setTimeout(() => {
                console.log('Midnight reached - triggering daily reset');
                checkAndResetDaily();
            }, msUntilMidnight);
            
            console.log(`Next reset scheduled in ${Math.round(msUntilMidnight / 1000 / 60)} minutes at midnight`);
        }
        
        function showDailyResetNotification() {
            // Create a beautiful notification
            const notification = document.createElement('div');
            notification.className = 'fixed top-4 left-1/2 transform -translate-x-1/2 z-50 bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-4 rounded-2xl shadow-2xl animate-bounce';
            notification.innerHTML = `
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">üéä</div>
                    <div>
                        <h4 class="font-bold text-lg">Daily Reset Complete!</h4>
                        <p class="text-sm opacity-90">üîÑ All tasks refreshed ‚Ä¢ ‚ú® New earning opportunities available!</p>
                    </div>
                    <div class="text-2xl">üéÅ</div>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translate(-50%, -100%) scale(0.8)';
                notification.style.transition = 'all 0.5s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 500);
            }, 5000);
            
            // Allow manual close by clicking
            notification.addEventListener('click', () => {
                notification.style.opacity = '0';
                notification.style.transform = 'translate(-50%, -100%) scale(0.8)';
                notification.style.transition = 'all 0.3s ease';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            });
        }
        
        function refreshCurrentTabAfterReset() {
            // Get current active tab and refresh its content
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const tabName = activeTab.dataset.tab;
                
                // Small delay to ensure reset is complete
                setTimeout(() => {
                    if (tabName === 'videos') {
                        loadVideos();
                    } else if (tabName === 'offers') {
                        loadOffers();
                    } else if (tabName === 'movies') {
                        loadMovies();
                    }
                }, 1000);
            }
        }
        
        // Reset Timer Display Functions
        function startResetTimer() {
            // Show reset timer
            const resetTimer = document.getElementById('resetTimer');
            if (resetTimer) {
                resetTimer.classList.remove('hidden');
            }
            
            // Update timer every second
            setInterval(updateResetTimer, 1000);
            
            // Initial update
            updateResetTimer();
        }
        
        function updateResetTimer() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0); // Set to midnight
            
            const msUntilMidnight = tomorrow.getTime() - now.getTime();
            
            if (msUntilMidnight <= 0) {
                // It's past midnight, should reset
                document.getElementById('timeUntilReset').textContent = '00:00:00';
                return;
            }
            
            const hours = Math.floor(msUntilMidnight / (1000 * 60 * 60));
            const minutes = Math.floor((msUntilMidnight % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((msUntilMidnight % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            const timerElement = document.getElementById('timeUntilReset');
            if (timerElement) {
                timerElement.textContent = timeString;
                
                // Add visual warning when less than 1 hour remaining
                const resetTimer = document.getElementById('resetTimer');
                if (resetTimer) {
                    if (hours === 0) {
                        resetTimer.className = resetTimer.className.replace('from-indigo-500 to-purple-600', 'from-red-500 to-pink-600');
                        resetTimer.title = 'Tasks reset in less than 1 hour! üîî';
                    } else {
                        resetTimer.className = resetTimer.className.replace('from-red-500 to-pink-600', 'from-indigo-500 to-purple-600');
                        resetTimer.title = 'Time until daily task reset üïõ';
                    }
                }
            }
        }

        // Authentication functions
        function setupAuthHandlers() {
            // Show/hide forms
            document.getElementById('showSignup').addEventListener('click', () => {
                document.getElementById('loginForm').classList.add('hidden');
                document.getElementById('signupForm').classList.remove('hidden');
            });

            document.getElementById('showLogin').addEventListener('click', () => {
                document.getElementById('signupForm').classList.add('hidden');
                document.getElementById('loginForm').classList.remove('hidden');
            });

            // Login form submission
            document.getElementById('loginFormElement').addEventListener('submit', async (e) => {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    await auth.signInWithEmailAndPassword(email, password);
                } catch (error) {
                    alert('Login failed: ' + error.message);
                }
            });

            // Signup form submission
            document.getElementById('signupFormElement').addEventListener('submit', async (e) => {
                e.preventDefault();
                const name = document.getElementById('signupName').value.trim();
                const dob = document.getElementById('signupDob').value;
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const referCode = document.getElementById('signupReferCode').value.trim();

                if (!name || !dob || !email || !password) {
                    alert('Please fill in all required fields.');
                    return;
                }

                try {
                    const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                    const userId = userCredential.user.uid;
                    
                    // Generate unique refer code for new user
                    const newUserReferCode = generateReferCode();
                    
                    // Initialize user profile with comprehensive data
                    const profileData = {
                        name: name,
                        email: email,
                        dateOfBirth: dob,
                        referCode: newUserReferCode,
                        referredBy: referCode || null,
                        points: 0,
                        totalEarned: 0,
                        totalWithdrawn: 0,
                        totalReferrals: 0,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    const batch = db.batch();
                    
                    // Set user profile
                    const userProfileRef = db.collection('users').doc(userId).collection('profile').doc('data');
                    batch.set(userProfileRef, profileData);
                    
                    // Handle referral if refer code provided
                    if (referCode) {
                        await handleReferralSignup(referCode, userId, name, batch);
                    }
                    
                    await batch.commit();
                    
                    alert(`üéâ Welcome ${name}! Your account has been created successfully!\n\nüîó Your Refer Code: ${newUserReferCode}\nüéÅ Share it with friends to earn bonus points!`);
                    
                } catch (error) {
                    alert('Signup failed: ' + error.message);
                }
            });

            // Logout
            document.getElementById('logoutBtn').addEventListener('click', () => {
                auth.signOut();
            });
        }

        // Tab navigation
        function setupTabNavigation() {
            // User tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.preventDefault();
                    const tab = btn.dataset.tab;
                    switchTab(tab);
                    
                    // Smooth scroll to active tab on mobile
                    if (window.innerWidth <= 640) {
                        btn.scrollIntoView({
                            behavior: 'smooth',
                            block: 'nearest',
                            inline: 'center'
                        });
                    }
                });
                
                // Add touch feedback
                btn.addEventListener('touchstart', () => {
                    btn.style.transform = 'scale(0.95)';
                });
                
                btn.addEventListener('touchend', () => {
                    setTimeout(() => {
                        btn.style.transform = '';
                    }, 150);
                });
            });

            // Admin tabs
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tab = btn.dataset.tab;
                    switchAdminTab(tab);
                });
            });
            
            // Initialize mobile navigation helper
            initializeMobileNavigation();
        }

        function switchTab(tab) {
            // Security check for admin tab
            if (tab === 'admin' && !isAdmin) {
                alert('üö´ Access Denied! Admin privileges required.');
                return;
            }

            // Update navigation with mobile-friendly styling
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-purple-500', 'text-purple-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            const activeBtn = document.querySelector(`[data-tab="${tab}"]`);
            activeBtn.classList.add('active', 'border-purple-500', 'text-purple-600');
            activeBtn.classList.remove('border-transparent', 'text-gray-500');

            // Update content with smooth transitions
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Add small delay for smooth transition
            setTimeout(() => {
                document.getElementById(tab).classList.add('active');
                
                // Scroll to top of content on mobile
                if (window.innerWidth <= 768) {
                    document.getElementById(tab).scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            }, 150);

            // Load tab-specific content
            if (tab === 'videos') loadVideos();
            if (tab === 'offers') loadOffers();
            if (tab === 'movies') loadMovies();
            if (tab === 'redeem') {
                loadWithdrawalHistory();
                // Load redeem options with delay to ensure user profile is loaded
                setTimeout(() => {
                    loadUserRedeemOptions();
                }, 100);
            }
            if (tab === 'support') loadSupportHistory();
            if (tab === 'admin') {
                // Reset admin authentication when switching to admin tab
                document.getElementById('adminAuth').style.display = 'block';
                document.getElementById('adminDashboard').classList.add('hidden');
                document.getElementById('adminPassword').value = '';
            }
            // Note: FAQ, About, Privacy, and Terms sections are static content and don't need dynamic loading
            
            // Update mobile navigation helper
            updateMobileNavHelper(tab);
        }
        
        // Mobile navigation helper functions
        function initializeMobileNavigation() {
            if (window.innerWidth > 640) return;
            
            const navContainer = document.querySelector('.mobile-nav-container');
            let isScrolling = false;
            
            // Add scroll indicators
            navContainer.addEventListener('scroll', () => {
                if (!isScrolling) {
                    window.requestAnimationFrame(() => {
                        updateScrollIndicators();
                        isScrolling = false;
                    });
                    isScrolling = true;
                }
            });
            
            // Initial indicator update
            updateScrollIndicators();
        }
        
        function updateScrollIndicators() {
            if (window.innerWidth > 640) return;
            
            const navContainer = document.querySelector('.mobile-nav-container');
            const scrollLeft = navContainer.scrollLeft;
            const scrollWidth = navContainer.scrollWidth;
            const clientWidth = navContainer.clientWidth;
            
            // Update scroll indicator dots
            const indicators = document.querySelectorAll('.mobile-nav-container + div .w-2');
            if (indicators.length > 0) {
                const progress = scrollLeft / (scrollWidth - clientWidth);
                const activeIndex = Math.round(progress * (indicators.length - 1));
                
                indicators.forEach((dot, index) => {
                    if (index === activeIndex) {
                        dot.classList.remove('bg-purple-300', 'opacity-50');
                        dot.classList.add('bg-purple-500');
                    } else {
                        dot.classList.remove('bg-purple-500');
                        dot.classList.add('bg-purple-300', 'opacity-50');
                    }
                });
            }
        }
        
        function updateMobileNavHelper(activeTab) {
            if (window.innerWidth > 640) return;
            
            // Update navigation helper text based on active tab
            const helper = document.querySelector('.mobile-nav-container + div p');
            if (helper) {
                const tabNames = {
                    'videos': 'Videos',
                    'offers': 'Offers', 
                    'movies': 'Movies',
                    'redeem': 'Redeem',
                    'support': 'Support',
                    'faq': 'FAQ',
                    'about': 'About',
                    'privacy': 'Privacy',
                    'terms': 'Terms',
                    'admin': 'Admin'
                };
                helper.textContent = `‚Üê Swipe for more ‚Ä¢ Current: ${tabNames[activeTab] || activeTab}`;
            }
        }

        function switchAdminTab(tab) {
            // Security check
            if (!checkAdminAccess()) {
                return;
            }
            
            // Update navigation
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active', 'border-red-500', 'text-red-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            document.querySelector(`[data-tab="${tab}"]`).classList.add('active', 'border-red-500', 'text-red-600');
            document.querySelector(`[data-tab="${tab}"]`).classList.remove('border-transparent', 'text-gray-500');

            // Update content
            document.querySelectorAll('.admin-tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            document.getElementById(tab).classList.remove('hidden');

            // Load admin-specific content
            if (tab === 'manageVideos') loadAdminVideos();
            if (tab === 'manageOffers') loadAdminOffers();
            if (tab === 'manageMovies') {
                loadCategories();
                loadAdminMoviesList();
                setupAdminMovieForms();
            }
            if (tab === 'manageDownloads') loadAdminDownloadVerifications();
            if (tab === 'manageOfferSubmissions') loadAdminOfferSubmissions();
            if (tab === 'manageReferrals') loadAdminReferrals();
            if (tab === 'manageProfiles') {
                loadAllUserProfiles();
                loadAdminDeletionRequests();
            }
            if (tab === 'manageRedeem') {
                loadAdminWithdrawals();
                loadAdminRedeemOptions();
            }
            if (tab === 'manageSupport') loadAdminSupport();
        }

        // User profile functions
        async function loadUserProfile() {
            try {
                const doc = await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').get();
                if (doc.exists) {
                    userProfile = doc.data();
                    
                    // Check if existing user lacks a refer code and generate one
                    if (!userProfile.referCode) {
                        const referCode = generateReferCode();
                        userProfile.referCode = referCode;
                        
                        // Update the user's profile with the new refer code
                        await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').update({
                            referCode: referCode,
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    } else {
                        // Update last login for users who already have refer codes
                        db.collection('users').doc(currentUser.uid).collection('profile').doc('data').update({
                            lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                        });
                    }
                } else {
                    // Create initial profile with enhanced data
                    const referCode = generateReferCode();
                    userProfile = { 
                        name: '',
                        email: currentUser.email,
                        dateOfBirth: '',
                        referCode: referCode,
                        referredBy: null,
                        points: 0, 
                        totalEarned: 0,
                        totalWithdrawn: 0,
                        totalReferrals: 0
                    };
                    await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').set({
                        ...userProfile,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        lastLogin: firebase.firestore.FieldValue.serverTimestamp()
                    });
                }
                updatePointsDisplay();
                
                // Start the daily reset timer
                startResetTimer();
            } catch (error) {
                console.error('Error loading user profile:', error);
            }
        }

        function updatePointsDisplay() {
            const pointsElement = document.getElementById('userPoints');
            if (pointsElement) {
                pointsElement.innerHTML = `<span class="animate-pulse">üí∞</span> ${userProfile.points || 0} <span class="hidden sm:inline">Points</span>`;
                // Add celebratory animation on points increase
                pointsElement.classList.add('animate-bounce');
                setTimeout(() => {
                    pointsElement.classList.remove('animate-bounce');
                }, 1000);
            }
        }

        async function addPoints(points) {
            try {
                const newPoints = (userProfile.points || 0) + points;
                const newTotalEarned = (userProfile.totalEarned || 0) + points;
                await db.collection('users').doc(currentUser.uid).collection('profile').doc('data').update({
                    points: newPoints,
                    totalEarned: newTotalEarned
                });
                userProfile.points = newPoints;
                userProfile.totalEarned = newTotalEarned;
                updatePointsDisplay();
            } catch (error) {
                console.error('Error adding points:', error);
            }
        }

        // Videos functions
        async function loadVideos() {
            try {
                const snapshot = await db.collection('videos').get();
                const videosList = document.getElementById('videosList');
                videosList.innerHTML = '';

                if (snapshot.empty) {
                    videosList.innerHTML = '<p class="text-gray-500 col-span-full text-center">No videos available yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const video = doc.data();
                    const videoElement = createVideoElement(doc.id, video);
                    videosList.appendChild(videoElement);
                });
            } catch (error) {
                console.error('Error loading videos:', error);
            }
        }

        function createVideoElement(id, video) {
            const div = document.createElement('div');
            div.className = 'bg-white bg-opacity-95 rounded-2xl shadow-xl overflow-hidden video-card mobile-card transform hover:scale-105 transition-all duration-300';
            
            let embedHtml;
            
            if (video.sourceType === 'embed' && video.embedUrl) {
                // Custom embed URL
                embedHtml = `<iframe id="video-${id}" src="${video.embedUrl}" 
                            class="w-full h-full" frameborder="0" allowfullscreen></iframe>`;
            } else if (video.youtubeId) {
                // YouTube video (default/legacy) - add enablejsapi for completion tracking
                embedHtml = `<iframe id="video-${id}" src="https://www.youtube.com/embed/${video.youtubeId}?enablejsapi=1&rel=0" 
                            class="w-full h-full" frameborder="0" allowfullscreen></iframe>`;
            } else {
                // Fallback for videos without proper source
                embedHtml = `<div class="w-full h-full bg-gradient-to-br from-gray-200 to-gray-300 flex items-center justify-center">
                            <p class="text-gray-500">üìπ Video not available</p></div>`;
            }
            
            div.innerHTML = `
                <div class="aspect-video relative overflow-hidden">
                    <div id="video-container-${id}" class="w-full h-full">
                        ${embedHtml}
                    </div>
                    <div id="video-overlay-${id}" class="absolute inset-0 bg-gradient-to-br from-purple-900 to-pink-900 bg-opacity-90 flex items-center justify-center video-overlay">
                        <button onclick="startWatchingVideo('${id}', ${video.points})" 
                                class="bg-gradient-to-r from-white to-gray-100 text-purple-800 font-bold px-6 py-3 sm:px-8 sm:py-4 rounded-2xl flex items-center space-x-3 transform hover:scale-110 transition-all duration-200 shadow-2xl touch-target">
                            <div class="text-3xl sm:text-4xl reward-pulse">‚ñ∂Ô∏è</div>
                            <span class="text-lg hidden sm:inline">Watch Video</span>
                        </button>
                    </div>
                </div>
                <div class="p-4 sm:p-6">
                    <div class="flex items-start justify-between mb-3">
                        <h3 class="font-bold text-lg sm:text-xl text-gray-800 flex-1 mr-2">${video.title}</h3>
                        ${video.sourceType === 'embed' ? '<span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-medium">üîó External</span>' : '<span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium">üì∫ YouTube</span>'}
                    </div>
                    <p class="text-gray-600 text-sm mb-4 line-clamp-2">${video.description || 'Watch this amazing video and earn points!'}</p>
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-2 rounded-full shadow-lg">
                            <span class="text-xl mr-1">üí∞</span>
                            <span class="font-bold">${video.points}</span>
                            <span class="text-sm ml-1 hidden sm:inline">Points</span>
                        </div>
                        <div id="watch-status-${id}" class="text-xs sm:text-sm">
                            <span class="text-gray-500 bg-gray-100 px-3 py-2 rounded-full font-medium">üëÄ Ready to watch</span>
                        </div>
                    </div>
                    <div id="progress-bar-${id}" class="hidden">
                        <div class="bg-gray-200 rounded-full h-3 mb-2">
                            <div id="progress-fill-${id}" class="bg-gradient-to-r from-blue-500 to-indigo-500 h-3 rounded-full progress-fill transition-all duration-300" style="width: 0%"></div>
                        </div>
                        <p class="text-xs text-gray-600 text-center font-medium">üìä Watch progress</p>
                    </div>
                </div>
            `;
            return div;
        }

        // Video watching system
        let watchingSessions = {};

        async function startWatchingVideo(videoId, points) {
            try {
                // Check if user already earned points for this video today
                const userVideoDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('watchedVideos').doc(videoId).get();
                
                if (userVideoDoc.exists) {
                    const watchData = userVideoDoc.data();
                    const watchDate = watchData.watchedAt ? new Date(watchData.watchedAt.toDate()).toDateString() : null;
                    const today = new Date().toDateString();
                    
                    if (watchDate === today) {
                        alert('‚úÖ Already Completed Today!\n\nYou have already earned points for this video today.\nCome back tomorrow at 12:00 AM for a fresh reset!\n\nüé¨ Check out other videos to earn more points!');
                        return;
                    }
                }

                // Show enhanced confirmation dialog
                const confirmed = confirm(`üé¨ Ready to watch this video?

‚Ä¢ Watch the video in the embedded player below
‚Ä¢ Progress will be tracked automatically for ${points} points
‚Ä¢ Don't close or refresh the page during watching
‚Ä¢ Video resets daily at 12:00 AM for re-earning

Start watching now?`);
                if (!confirmed) return;

                // Hide overlay and show video
                document.getElementById(`video-overlay-${videoId}`).style.display = 'none';
                document.getElementById(`progress-bar-${videoId}`).classList.remove('hidden');
                document.getElementById(`watch-status-${videoId}`).innerHTML = 
                    '<span class="text-blue-600 bg-blue-100 px-3 py-2 rounded-full font-medium text-xs sm:text-sm">üì∫ Watching... Complete to earn points</span>';

                // Start tracking watch progress
                startWatchProgress(videoId, points);
                
            } catch (error) {
                console.error('Error starting video watch:', error);
                alert('‚ùå Error starting video\n\nPlease try again. If the problem persists, contact support.');
            }
        }

        function startWatchProgress(videoId, points) {
            // Create watching session
            const sessionId = Date.now().toString();
            watchingSessions[videoId] = {
                sessionId: sessionId,
                startTime: Date.now(),
                progress: 0,
                completed: false,
                points: points
            };

            // Simulate video progress (since we can't reliably track all embed videos)
            // You can adjust the duration based on your needs
            const estimatedDuration = 120000; // 2 minutes default
            const progressInterval = 1000; // Update every second
            const progressStep = 100 / (estimatedDuration / progressInterval);

            const progressTimer = setInterval(() => {
                const session = watchingSessions[videoId];
                if (!session || session.completed) {
                    clearInterval(progressTimer);
                    return;
                }

                session.progress += progressStep;
                const progressElement = document.getElementById(`progress-fill-${videoId}`);
                
                if (progressElement) {
                    progressElement.style.width = `${Math.min(session.progress, 100)}%`;
                }

                // Video completed
                if (session.progress >= 100) {
                    clearInterval(progressTimer);
                    completeVideoWatch(videoId, points);
                }
            }, progressInterval);

            // Store timer reference for cleanup
            watchingSessions[videoId].timer = progressTimer;
        }

        async function completeVideoWatch(videoId, points) {
            const session = watchingSessions[videoId];
            if (!session || session.completed) return;

            session.completed = true;

            try {
                // Award points and mark video as watched
                await Promise.all([
                    addPoints(points),
                    db.collection('users').doc(currentUser.uid).collection('watchedVideos').doc(videoId).set({
                        watchedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        pointsEarned: points,
                        sessionId: session.sessionId,
                        watchDuration: Date.now() - session.startTime,
                        watchDate: new Date().toDateString() // For daily reset tracking
                    })
                ]);

                // Update UI with enhanced success styling
                document.getElementById(`watch-status-${videoId}`).innerHTML = 
                    `<span class="text-green-600 font-bold bg-green-100 px-4 py-2 rounded-full text-xs sm:text-sm">üéâ Completed! +${points} points</span>`;
                
                document.getElementById(`progress-fill-${videoId}`).style.width = '100%';
                document.getElementById(`progress-fill-${videoId}`).classList.remove('from-blue-500', 'to-indigo-500');
                document.getElementById(`progress-fill-${videoId}`).classList.add('from-green-500', 'to-emerald-500');

                // Show enhanced success message
                setTimeout(() => {
                    alert(`üéä Congratulations!

üé¨ Video completed successfully!
üí∞ You earned ${points} points!
üìà New balance: ${userProfile.points} points

üöÄ Keep watching more videos to earn more points!`);
                }, 500);

                // Clean up session
                delete watchingSessions[videoId];
                
            } catch (error) {
                console.error('Error completing video watch:', error);
                alert('‚ùå Error awarding points\n\nPlease try again or contact support if the issue persists.');
            }
        }

        // Updated earnVideoPoints function (kept for backward compatibility)
        async function earnVideoPoints(videoId, points) {
            // This function is now primarily used for legacy support
            // New videos should use the watch completion system
            startWatchingVideo(videoId, points);
        }

        // Offers functions
        async function loadOffers() {
            try {
                const snapshot = await db.collection('offers').get();
                const offersList = document.getElementById('offersList');
                offersList.innerHTML = '';

                if (snapshot.empty) {
                    offersList.innerHTML = '<p class="text-gray-500 col-span-full text-center">No offers available yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const offer = doc.data();
                    const offerElement = createOfferElement(doc.id, offer);
                    offersList.appendChild(offerElement);
                });
            } catch (error) {
                console.error('Error loading offers:', error);
            }
        }

        function createOfferElement(id, offer) {
            const div = document.createElement('div');
            div.className = 'bg-white bg-opacity-95 rounded-2xl shadow-xl p-4 sm:p-6 mobile-card transform hover:scale-105 transition-all duration-300';
            
            const hasLink = offer.link && offer.link.trim() !== '';
            const linkSection = hasLink ? `
                <div class="mb-4 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="text-sm font-bold text-blue-900 flex items-center">
                            <span class="text-lg mr-2">üì¢</span>
                            Offer Task Link
                        </h4>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full font-bold">External Task</span>
                    </div>
                    <p class="text-sm text-blue-800 mb-3">Click "START TASK" below to open the offer link and complete the required task.</p>
                    <button onclick="openOfferLink('${offer.link}', '${id}')" 
                       class="inline-flex items-center justify-center w-full bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 px-4 rounded-xl transition duration-200 mb-2 touch-target">
                        <span class="text-xl mr-2">üöÄ</span>
                        START TASK
                    </button>
                    <p class="text-xs text-gray-600 text-center">After completing the task, return here and upload screenshots for verification</p>
                </div>
            ` : '';
            
            div.innerHTML = `
                <div class="flex items-start justify-between mb-4">
                    <h3 class="font-bold text-lg sm:text-xl text-gray-800 flex-1 mr-2">${offer.title}</h3>
                    <div class="flex items-center bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-3 py-2 rounded-full shadow-lg">
                        <span class="text-lg mr-1">üí∞</span>
                        <span class="font-bold">${offer.points}</span>
                        <span class="text-sm ml-1 hidden sm:inline">Points</span>
                    </div>
                </div>
                <p class="text-gray-600 text-sm mb-3">${offer.description || 'Complete this amazing offer and earn points!'}</p>
                <div class="mb-4 p-3 bg-gray-50 rounded-xl">
                    <p class="text-sm font-bold text-gray-700 mb-1">üéØ Task: ${offer.task}</p>
                    ${offer.note ? `<p class="text-sm text-gray-600">üìù Note: ${offer.note}</p>` : ''}
                </div>
                ${linkSection}
                <div id="verification-section-${id}" class="mb-4 hidden">
                    <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-300 rounded-lg p-4">
                        <div class="flex items-center mb-3">
                            <div class="flex-shrink-0">
                                <svg class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h4 class="text-lg font-bold text-yellow-800">üìã Task Completion Verification</h4>
                                <p class="text-sm text-yellow-700">Submit proof of task completion for admin review</p>
                            </div>
                        </div>
                        
                        <div class="mb-4 p-3 bg-white border border-yellow-200 rounded-md">
                            <label class="block text-sm font-bold text-gray-800 mb-2">üì∏ Upload Screenshots/Images (Recommended)</label>
                            <input type="file" id="verification-files-${id}" multiple accept="image/*" 
                                   class="w-full px-3 py-2 border-2 border-dashed border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <div class="mt-2 text-xs text-gray-600">
                                <p class="font-medium">üìã What to upload:</p>
                                <ul class="list-disc ml-4 mt-1">
                                    <li>Screenshots showing task completion</li>
                                    <li>Confirmation emails or receipts</li>
                                    <li>Any other proof of completion</li>
                                </ul>
                                <p class="mt-2 text-red-600 font-medium">‚ö†Ô∏è Max 5 files, 5MB each</p>
                            </div>
                        </div>
                        
                        <div class="mb-4 p-3 bg-white border border-yellow-200 rounded-md">
                            <label class="block text-sm font-bold text-gray-800 mb-2">üìù Verification Details</label>
                            <textarea id="verification-text-${id}" rows="4" 
                                      placeholder="Please provide detailed information about how you completed the task:\n\n‚Ä¢ Steps you followed\n‚Ä¢ Confirmation details (order numbers, usernames, etc.)\n‚Ä¢ Any relevant URLs or information\n‚Ä¢ Time/date of completion"
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                        </div>
                        
                        <button onclick="submitOfferVerification('${id}', ${offer.points})" 
                                class="w-full bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            üì§ Submit for Admin Review
                        </button>
                    </div>
                </div>
                <div id="offer-status-${id}" class="mb-3">
                    <!-- Status will be loaded here -->
                </div>
                <div class="flex justify-between items-center">
                    <div class="flex items-center">
                        <span class="text-2xl font-bold text-yellow-600">${offer.points}</span>
                        <span class="text-sm text-yellow-600 ml-1">Points</span>
                    </div>
                    <button id="offer-btn-${id}" onclick="startOffer('${id}', ${offer.points}, ${hasLink})" 
                            class="${hasLink ? 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600' : 'bg-gradient-to-r from-green-500 to-blue-500 hover:from-green-600 hover:to-blue-600'} text-white font-bold px-6 py-3 rounded-lg transition duration-200">
                        ${hasLink ? 'üéØ CLAIM POINTS' : 'üöÄ START TASK'}
                    </button>
                </div>
            `;
            
            // Load offer status for this user
            loadOfferStatus(id);
            
            return div;
        }

        async function loadOfferStatus(offerId) {
            try {
                const userOfferDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('startedOffers').doc(offerId).get();
                
                const statusDiv = document.getElementById(`offer-status-${offerId}`);
                const buttonElement = document.getElementById(`offer-btn-${offerId}`);
                
                if (userOfferDoc.exists) {
                    const offerData = userOfferDoc.data();
                    const status = offerData.status || 'started';
                    const hasLink = offerData.hasLink || false;
                    
                    // Show status with appropriate styling
                    let statusColor = 'text-blue-600';
                    let statusText = status;
                    
                    switch(status.toLowerCase()) {
                        case 'completed':
                            statusColor = 'text-green-600';
                            statusText = '‚úÖ Completed';
                            break;
                        case 'rejected':
                        case 'denied':
                            statusColor = 'text-red-600';
                            statusText = '‚ùå ' + status;
                            if (offerData.rejectionReason) {
                                statusText += ` - ${offerData.rejectionReason}`;
                            }
                            break;
                        case 'pending':
                            statusColor = 'text-yellow-600';
                            statusText = '‚è≥ Pending Review';
                            break;
                        case 'processing':
                            statusColor = 'text-blue-600';
                            statusText = 'üîÑ Processing';
                            break;
                        case 'started':
                            if (hasLink) {
                                statusColor = 'text-purple-600';
                                statusText = 'üîó Link Offer Started - Complete the task via the link above';
                            } else {
                                statusColor = 'text-purple-600';
                                statusText = 'üöÄ Started';
                            }
                            break;
                        default:
                            statusColor = 'text-gray-600';
                            statusText = status;
                    }
                    
                    statusDiv.innerHTML = `
                        <div class="p-2 bg-gray-50 rounded border-l-4 border-blue-400">
                            <p class="text-sm font-medium ${statusColor}">Status: ${statusText}</p>
                            <p class="text-xs text-gray-500">Started: ${offerData.startedAt ? new Date(offerData.startedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            ${offerData.adminNote ? `<p class="text-xs text-gray-600 mt-1">Note: ${offerData.adminNote}</p>` : ''}
                            ${offerData.verificationText ? `
                                <div class="mt-2 p-2 bg-blue-50 rounded border">
                                    <p class="text-xs font-medium text-blue-800">Your Verification:</p>
                                    <p class="text-xs text-blue-700">${offerData.verificationText}</p>
                                    ${offerData.files && offerData.files.length > 0 ? `<p class="text-xs text-blue-600 mt-1">üìé ${offerData.files.length} file(s) submitted</p>` : ''}
                                </div>
                            ` : ''}
                        </div>
                    `;
                    
                    // Update button based on status and offer type
                    if (status.toLowerCase() === 'completed') {
                        buttonElement.innerHTML = '‚úÖ Completed';
                        buttonElement.className = 'bg-green-600 text-white px-6 py-3 rounded-lg cursor-not-allowed font-bold';
                        buttonElement.disabled = true;
                        buttonElement.onclick = null;
                    } else if (hasLink && status.toLowerCase() === 'started') {
                        buttonElement.innerHTML = 'üéØ CLAIM POINTS';
                        buttonElement.className = 'bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-bold px-6 py-3 rounded-lg transition duration-200';
                        buttonElement.disabled = false;
                        buttonElement.onclick = () => claimOfferPoints(offerId, offerData.pointsOffered);
                    } else if (status.toLowerCase() === 'pending') {
                        buttonElement.innerHTML = '‚è≥ Under Review';
                        buttonElement.className = 'bg-yellow-600 text-white px-6 py-3 rounded-lg cursor-not-allowed font-bold';
                        buttonElement.disabled = true;
                        buttonElement.onclick = null;
                    } else if (status.toLowerCase() === 'rejected' && !hasLink) {
                        buttonElement.innerHTML = 'üîÑ Resubmit Verification';
                        buttonElement.className = 'bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 font-bold transition duration-200';
                        buttonElement.disabled = false;
                        buttonElement.onclick = () => showVerificationSection(offerId);
                        // Show verification section immediately for rejected offers
                        showVerificationSection(offerId);
                    } else if (status.toLowerCase() === 'started' && !hasLink) {
                        buttonElement.innerHTML = 'üì∏ Upload Screenshots';
                        buttonElement.className = 'bg-gradient-to-r from-purple-500 to-indigo-500 hover:from-purple-600 hover:to-indigo-600 text-white font-bold px-6 py-3 rounded-lg transition duration-200';
                        buttonElement.disabled = false;
                        buttonElement.onclick = () => showVerificationSection(offerId);
                    } else {
                        buttonElement.innerHTML = 'üîÑ In Progress';
                        buttonElement.className = 'bg-blue-600 text-white px-6 py-3 rounded-lg cursor-not-allowed font-bold';
                        buttonElement.disabled = true;
                        buttonElement.onclick = null;
                    }
                } else {
                    // No status, offer not started
                    statusDiv.innerHTML = `
                        <div class="p-3 bg-gray-50 rounded-lg border border-gray-200">
                            <p class="text-sm text-gray-700 font-medium">üéÅ Ready to start this offer!</p>
                            <p class="text-xs text-gray-600 mt-1">Click the button below to begin and earn ${offer.points || 0} points</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading offer status:', error);
            }
        }

        async function startOffer(offerId, points, hasLink = false) {
            try {
                // Check if user already started this offer
                const userOfferDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('startedOffers').doc(offerId).get();
                
                if (userOfferDoc.exists) {
                    const existingData = userOfferDoc.data();
                    if (existingData.status === 'completed') {
                        alert('You have already completed this offer!');
                        return;
                    } else if (hasLink && existingData.status === 'started') {
                        // For link-based offers, allow claiming points if already started
                        await claimOfferPoints(offerId, points);
                        return;
                    } else {
                        alert('You have already started this offer!');
                        return;
                    }
                }

                // Get offer details
                const offerDoc = await db.collection('offers').doc(offerId).get();
                if (!offerDoc.exists) {
                    alert('Offer not found!');
                    return;
                }
                
                const offerData = offerDoc.data();
                
                // For offers with links, start differently
                if (hasLink) {
                    await startLinkOffer(offerId, points, offerData);
                } else {
                    await startRegularOffer(offerId, points, offerData);
                }
                
            } catch (error) {
                console.error('Error starting offer:', error);
                alert('Error starting offer. Please try again.');
            }
        }
        
        async function startLinkOffer(offerId, points, offerData) {
            const confirmed = confirm(`üöÄ Ready to start this offer?

‚Ä¢ You'll be taken to an external website
‚Ä¢ Complete the required task there
‚Ä¢ Return here to upload screenshots and claim your ${points} points

Continue?`);
            
            if (!confirmed) return;
            
            const startedOfferData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                offerId: offerId,
                offerTitle: offerData.title,
                offerTask: offerData.task,
                offerLink: offerData.link,
                pointsOffered: points,
                status: 'started',
                hasLink: true,
                autoApprove: offerData.autoApprove || false,
                startedAt: firebase.firestore.FieldValue.serverTimestamp(),
                adminNote: ''
            };

            // Add to both user's collection and admin collection
            const batch = db.batch();
            const userOfferRef = db.collection('users').doc(currentUser.uid).collection('startedOffers').doc(offerId);
            const adminOfferRef = db.collection('admin_offer_submissions').doc(`${currentUser.uid}_${offerId}`);

            batch.set(userOfferRef, startedOfferData);
            batch.set(adminOfferRef, startedOfferData);

            await batch.commit();

            alert('‚úÖ Offer started successfully!\n\nüîó Click "START TASK" button above to open the external link.\nüì∏ After completing the task, return here to upload screenshots and claim your points.');
            
            // Reload offer status
            loadOfferStatus(offerId);
        }
        
        async function startRegularOffer(offerId, points, offerData) {
            const confirmed = confirm(`üéÅ Start this task offer?

‚Ä¢ Complete the required task: "${offerData.task}"
‚Ä¢ Upload screenshots as proof
‚Ä¢ Wait for admin approval to earn ${points} points

Ready to begin?`);
            
            if (!confirmed) return;
            
            const startedOfferData = {
                userId: currentUser.uid,
                userEmail: currentUser.email,
                offerId: offerId,
                offerTitle: offerData.title,
                offerTask: offerData.task,
                pointsOffered: points,
                status: 'started',
                hasLink: false,
                autoApprove: false,
                startedAt: firebase.firestore.FieldValue.serverTimestamp(),
                adminNote: ''
            };

            // Add to both user's collection and admin collection
            const batch = db.batch();
            const userOfferRef = db.collection('users').doc(currentUser.uid).collection('startedOffers').doc(offerId);
            const adminOfferRef = db.collection('admin_offer_submissions').doc(`${currentUser.uid}_${offerId}`);

            batch.set(userOfferRef, startedOfferData);
            batch.set(adminOfferRef, startedOfferData);

            await batch.commit();

            alert('‚úÖ Task started successfully!\n\nüìã Complete the task and click "Upload Screenshots" to submit proof for admin review.');
            
            // Reload offer status
            loadOfferStatus(offerId);
            
            // Auto-show verification section for manual tasks
            setTimeout(() => {
                showVerificationSection(offerId);
            }, 1000);
        }
        
        async function claimOfferPoints(offerId, points) {
            try {
                const userOfferDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('startedOffers').doc(offerId).get();
                    
                if (!userOfferDoc.exists) {
                    alert('Offer not found. Please start the offer first.');
                    return;
                }
                
                const offerData = userOfferDoc.data();
                
                if (offerData.status === 'completed') {
                    alert('You have already claimed points for this offer!');
                    return;
                }
                
                // For auto-approve offers, award points immediately
                if (offerData.autoApprove) {
                    const confirmed = confirm(`üéÜ Ready to claim your reward?

‚Ä¢ You'll receive ${points} points immediately
‚Ä¢ This is an auto-approved offer

Confirm to claim your points!`);
                    if (!confirmed) return;
                    
                    const batch = db.batch();
                    
                    // Update offer status
                    const updateData = {
                        status: 'completed',
                        adminNote: 'Auto-approved link offer',
                        completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        pointsAwarded: points,
                        completionDate: new Date().toDateString() // For daily reset tracking
                    };
                    
                    const userOfferRef = db.collection('users').doc(currentUser.uid).collection('startedOffers').doc(offerId);
                    const adminOfferRef = db.collection('admin_offer_submissions').doc(`${currentUser.uid}_${offerId}`);
                    
                    batch.update(userOfferRef, updateData);
                    batch.update(adminOfferRef, updateData);
                    
                    // Award points to user
                    const newPoints = (userProfile.points || 0) + points;
                    const userProfileRef = db.collection('users').doc(currentUser.uid).collection('profile').doc('data');
                    batch.update(userProfileRef, { points: newPoints });
                    
                    await batch.commit();
                    
                    // Update local profile
                    userProfile.points = newPoints;
                    updatePointsDisplay();
                    
                    alert(`üéâ Congratulations! You earned ${points} points!\n\nüí∞ New balance: ${newPoints} points`);
                    loadOfferStatus(offerId);
                    
                } else {
                    // For manual approval, show verification section
                    const confirmed = confirm(`üìã Submit proof for admin review?

‚Ä¢ Upload screenshots of task completion
‚Ä¢ Admin will review and award ${points} points
‚Ä¢ This may take some time for approval

Proceed to verification?`);
                    if (!confirmed) return;
                    
                    // Show verification section for manual review
                    showVerificationSection(offerId);
                }
                
            } catch (error) {
                console.error('Error claiming offer points:', error);
                alert('Error claiming points. Please try again.');
            }
        }
        
        // Verification functions
        function showVerificationSection(offerId) {
            const verificationSection = document.getElementById(`verification-section-${offerId}`);
            if (verificationSection) {
                verificationSection.classList.remove('hidden');
                verificationSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
        
        function hideVerificationSection(offerId) {
            const verificationSection = document.getElementById(`verification-section-${offerId}`);
            if (verificationSection) {
                verificationSection.classList.add('hidden');
            }
        }
        
        async function submitOfferVerification(offerId, points) {
            try {
                const verificationText = document.getElementById(`verification-text-${offerId}`).value.trim();
                const fileInput = document.getElementById(`verification-files-${offerId}`);
                const files = fileInput.files;
                
                if (!verificationText && files.length === 0) {
                    alert('‚ö†Ô∏è Verification Required\n\nPlease provide either:\n‚Ä¢ Upload screenshots/images of task completion\n‚Ä¢ Enter detailed verification text\n‚Ä¢ Or both for better approval chances');
                    return;
                }
                
                // Validate files
                if (files.length > 5) {
                    alert('‚ö†Ô∏è Too many files!\n\nMaximum 5 files allowed.\nPlease select fewer files.');
                    return;
                }
                
                for (let file of files) {
                    if (file.size > 5 * 1024 * 1024) { // 5MB limit
                        alert(`‚ö†Ô∏è File too large!

File "${file.name}" is too large.
Maximum size is 5MB per file.
Please compress or select a smaller image.`);
                        return;
                    }
                    if (!file.type.startsWith('image/')) {
                        alert(`‚ö†Ô∏è Invalid file type!\n\nFile "${file.name}" is not an image.\nOnly image files (JPG, PNG, GIF, etc.) are allowed.`);
                        return;
                    }
                }
                
                const confirmed = confirm(`üìã Submit Verification for Admin Review?

üìÑ Verification Details:
‚Ä¢ Text provided: ${verificationText ? 'Yes' : 'No'}
‚Ä¢ Files uploaded: ${files.length}
‚Ä¢ Potential reward: ${points} points

‚è≥ Your submission will be reviewed by an admin.
You'll be notified once approved!

Submit now?`);
                if (!confirmed) return;
                
                // Show loading state
                const submitBtn = document.querySelector(`#verification-section-${offerId} button`);
                const originalText = submitBtn.textContent;
                submitBtn.textContent = 'üîÑ Uploading...';
                submitBtn.disabled = true;
                
                try {
                    // Convert files to base64 for storage
                    const fileData = [];
                    for (let file of files) {
                        const base64 = await fileToBase64(file);
                        fileData.push({
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: base64
                        });
                    }
                    
                    const verificationData = {
                        verificationText: verificationText,
                        files: fileData,
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        status: 'pending'
                    };
                    
                    const batch = db.batch();
                    
                    // Update user's offer
                    const userOfferRef = db.collection('users').doc(currentUser.uid).collection('startedOffers').doc(offerId);
                    batch.update(userOfferRef, {
                        ...verificationData,
                        adminNote: 'Verification submitted - awaiting admin review'
                    });
                    
                    // Update admin submission
                    const adminOfferRef = db.collection('admin_offer_submissions').doc(`${currentUser.uid}_${offerId}`);
                    batch.update(adminOfferRef, {
                        ...verificationData,
                        adminNote: 'Verification submitted - awaiting admin review'
                    });
                    
                    await batch.commit();
                    
                    // Clear form
                    document.getElementById(`verification-text-${offerId}`).value = '';
                    document.getElementById(`verification-files-${offerId}`).value = '';
                    hideVerificationSection(offerId);
                    
                    alert('‚úÖ Verification Submitted Successfully!\n\nüìÑ Your verification has been sent to admin for review.\n‚è≥ You will receive your points once approved.\nüì± Check back later for updates!');
                    loadOfferStatus(offerId);
                    
                } finally {
                    // Restore button state
                    submitBtn.textContent = originalText;
                    submitBtn.disabled = false;
                }
                
            } catch (error) {
                console.error('Error submitting verification:', error);
                alert('‚ùå Error submitting verification\n\nPlease try again. If the problem persists, contact support.');
            }
        }
        
        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        // Withdrawal functions
        async function requestWithdrawal(pointsRequired, cashAmount) {
            if (userProfile.points < pointsRequired) {
                alert(`You need ${pointsRequired} points to request this withdrawal. You currently have ${userProfile.points} points.`);
                return;
            }

            // Get UPI ID
            const upiId = document.getElementById('upiId').value.trim();
            if (!upiId) {
                alert('Please enter your UPI ID to proceed with the withdrawal request.');
                return;
            }

            // Basic UPI ID validation
            if (!upiId.includes('@') || upiId.length < 5) {
                alert('Please enter a valid UPI ID (e.g., yourname@paytm)');
                return;
            }

            try {
                const withdrawalData = {
                    userId: currentUser.uid,
                    userEmail: currentUser.email,
                    upiId: upiId,
                    pointsUsed: pointsRequired,
                    cashAmount: cashAmount,
                    status: 'pending',
                    requestedAt: firebase.firestore.FieldValue.serverTimestamp()
                };

                // Add to both user's collection and admin collection
                const batch = db.batch();
                const userWithdrawalRef = db.collection('users').doc(currentUser.uid).collection('withdrawals').doc();
                const adminWithdrawalRef = db.collection('admin_withdrawals').doc(userWithdrawalRef.id);

                batch.set(userWithdrawalRef, withdrawalData);
                batch.set(adminWithdrawalRef, withdrawalData);

                // Deduct points
                const newPoints = userProfile.points - pointsRequired;
                const userProfileRef = db.collection('users').doc(currentUser.uid).collection('profile').doc('data');
                batch.update(userProfileRef, { points: newPoints });

                await batch.commit();

                userProfile.points = newPoints;
                updatePointsDisplay();
                loadWithdrawalHistory();

                alert(`Withdrawal request for $${cashAmount} submitted successfully! Payment will be sent to ${upiId}`);
                
                // Clear UPI ID field after successful submission
                document.getElementById('upiId').value = '';
            } catch (error) {
                console.error('Error requesting withdrawal:', error);
                alert('Error submitting withdrawal request. Please try again.');
            }
        }

        async function loadWithdrawalHistory() {
            try {
                const snapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('withdrawals').orderBy('requestedAt', 'desc').get();
                
                const historyDiv = document.getElementById('withdrawalHistory');
                historyDiv.innerHTML = '';

                if (snapshot.empty) {
                    historyDiv.innerHTML = '<p class="text-gray-500">No withdrawal history yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-3';
                    
                    const statusColor = withdrawal.status === 'approved' ? 'text-green-600' : 
                                       withdrawal.status === 'rejected' ? 'text-red-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <span class="font-medium">$${withdrawal.cashAmount}</span>
                            <span class="text-sm ${statusColor} capitalize">${withdrawal.status}</span>
                        </div>
                        <p class="text-sm text-gray-600">${withdrawal.pointsUsed} points used</p>
                        ${withdrawal.upiId ? `<p class="text-sm text-gray-600">UPI: ${withdrawal.upiId}</p>` : ''}
                        <p class="text-xs text-gray-500">${withdrawal.requestedAt ? new Date(withdrawal.requestedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                    `;
                    historyDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading withdrawal history:', error);
            }
        }

        // Support functions
        function setupSupportForm() {
            document.getElementById('supportForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                // Security check: Ensure user is authenticated
                if (!currentUser) {
                    alert('‚ö†Ô∏è Security Error: You must be logged in to submit support tickets.');
                    return;
                }
                
                const subject = document.getElementById('supportSubject').value.trim();
                const message = document.getElementById('supportMessage').value.trim();

                if (!subject || !message) {
                    alert('Please fill in both subject and message fields.');
                    return;
                }
                
                // Input sanitization
                if (subject.length > 200) {
                    alert('Subject must be less than 200 characters.');
                    return;
                }
                
                if (message.length > 2000) {
                    alert('Message must be less than 2000 characters.');
                    return;
                }

                try {
                    const ticketData = {
                        userId: currentUser.uid, // SECURITY: Always use authenticated user's ID
                        userEmail: currentUser.email, // SECURITY: Always use authenticated user's email
                        subject: subject,
                        message: message,
                        status: 'open',
                        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                        adminReply: null,
                        isPrivate: true // SECURITY: Mark as private ticket
                    };

                    // SECURITY: Create unique document ID and store in both collections
                    // User's private collection (only accessible to user and admin)
                    // Admin collection (only accessible to admin)
                    const batch = db.batch();
                    const userTicketRef = db.collection('users').doc(currentUser.uid).collection('support_tickets').doc();
                    const adminTicketRef = db.collection('admin_support_tickets').doc(userTicketRef.id);

                    batch.set(userTicketRef, ticketData);
                    batch.set(adminTicketRef, ticketData);

                    await batch.commit();

                    // Clear form
                    document.getElementById('supportForm').reset();
                    loadSupportHistory();

                    alert('‚úÖ Support ticket submitted successfully!\n\nüîí Your ticket is private and only visible to you and admin.\nüï∞Ô∏è You will receive a response from admin soon.');
                } catch (error) {
                    console.error('Error submitting support ticket:', error);
                    alert('‚ùå Error submitting ticket. Please try again.');
                }
            });
        }

        async function loadSupportHistory() {
            // Security check: Ensure user is authenticated
            if (!currentUser) {
                console.error('Unauthorized: User not authenticated');
                return;
            }
            
            try {
                // SECURITY: Only load support tickets for the current authenticated user
                // This prevents users from accessing other users' support tickets
                const snapshot = await db.collection('users').doc(currentUser.uid)
                    .collection('support_tickets').orderBy('createdAt', 'desc').get();
                
                const historyDiv = document.getElementById('supportHistory');
                historyDiv.innerHTML = '';

                if (snapshot.empty) {
                    historyDiv.innerHTML = '<p class="text-gray-500">No support tickets yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const ticket = doc.data();
                    
                    // SECURITY: Verify ticket belongs to current user
                    if (ticket.userId !== currentUser.uid) {
                        console.warn('Security violation: Attempted to load ticket not belonging to current user');
                        return;
                    }
                    
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = ticket.status === 'closed' ? 'text-green-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-medium">${ticket.subject}</h4>
                            <span class="text-sm ${statusColor} capitalize">${ticket.status}</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-2">${ticket.message}</p>
                        ${ticket.adminReply ? `
                            <div class="mt-3 p-3 bg-blue-50 rounded">
                                <p class="text-sm font-medium text-blue-800">Admin Reply:</p>
                                <p class="text-sm text-blue-700">${ticket.adminReply}</p>
                            </div>
                        ` : ''}
                        <p class="text-xs text-gray-500 mt-2">${ticket.createdAt ? new Date(ticket.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                        <div class="mt-2 text-xs text-gray-400">
                            <span class="inline-block px-2 py-1 bg-gray-100 rounded">üîí Private Ticket</span>
                        </div>
                    `;
                    historyDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading support history:', error);
                const historyDiv = document.getElementById('supportHistory');
                historyDiv.innerHTML = '<p class="text-red-500">‚ö†Ô∏è Error loading your support tickets. Please refresh and try again.</p>';
            }
        }

        // Admin functions
        function setupAdminForms() {
            // Security check
            if (!checkAdminAccess()) {
                return;
            }
            
            // Add video form
            const videoForm = document.getElementById('addVideoForm');
            if (videoForm) {
                // Remove existing event listeners to prevent duplicates
                const newVideoForm = videoForm.cloneNode(true);
                videoForm.parentNode.replaceChild(newVideoForm, videoForm);
                
                document.getElementById('addVideoForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!checkAdminAccess()) {
                        return;
                    }
                    
                    const title = document.getElementById('videoTitle').value.trim();
                    const points = parseInt(document.getElementById('videoPoints').value);
                    const description = document.getElementById('videoDescription').value.trim();
                    const videoSource = document.querySelector('input[name="videoSource"]:checked').value;
                    
                    let videoData = {
                        title: title,
                        points: points,
                        description: description,
                        sourceType: videoSource,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    if (videoSource === 'youtube') {
                        const youtubeId = document.getElementById('videoYoutubeId').value.trim();
                        if (!youtubeId) {
                            alert('Please enter a YouTube ID.');
                            return;
                        }
                        videoData.youtubeId = youtubeId;
                    } else {
                        const embedUrl = document.getElementById('videoEmbedUrl').value.trim();
                        if (!embedUrl) {
                            alert('Please enter a valid embed URL.');
                            return;
                        }
                        // Basic URL validation
                        try {
                            new URL(embedUrl);
                            videoData.embedUrl = embedUrl;
                        } catch {
                            alert('Please enter a valid URL.');
                            return;
                        }
                    }
                    
                    if (!title || !points || points < 1) {
                        alert('Please fill in all required fields with valid values.');
                        return;
                    }

                    try {
                        console.log('Adding video:', videoData);
                        await db.collection('videos').add(videoData);
                        document.getElementById('addVideoForm').reset();
                        // Reset to YouTube as default
                        document.querySelector('input[name="videoSource"][value="youtube"]').checked = true;
                        document.getElementById('youtubeSection').classList.remove('hidden');
                        document.getElementById('embedSection').classList.add('hidden');
                        loadAdminVideos();
                        alert('Video added successfully!');
                    } catch (error) {
                        console.error('Error adding video:', error);
                        alert('Error adding video: ' + error.message);
                    }
                });
            } else {
                console.error('Video form not found');
            }

            // Add offer form
            const offerForm = document.getElementById('addOfferForm');
            if (offerForm) {
                // Remove existing event listeners to prevent duplicates
                const newOfferForm = offerForm.cloneNode(true);
                offerForm.parentNode.replaceChild(newOfferForm, offerForm);
                
                document.getElementById('addOfferForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    if (!checkAdminAccess()) {
                        return;
                    }
                    
                    const title = document.getElementById('offerTitle').value.trim();
                    const task = document.getElementById('offerTask').value.trim();
                    const note = document.getElementById('offerNote').value.trim();
                    const link = document.getElementById('offerLink').value.trim();
                    const autoApprove = document.getElementById('offerAutoApprove').checked;
                    const points = parseInt(document.getElementById('offerPoints').value);
                    const description = document.getElementById('offerDescription').value.trim();
                    
                    if (!title || !task || !points || points < 1) {
                        alert('Please fill in all required fields with valid values.');
                        return;
                    }
                    
                    // Validate link if provided
                    if (link && !isValidUrl(link)) {
                        alert('Please enter a valid URL for the offer link.');
                        return;
                    }
                    
                    const offerData = {
                        title: title,
                        task: task,
                        note: note,
                        link: link,
                        autoApprove: autoApprove,
                        points: points,
                        description: description,
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };

                    try {
                        console.log('Adding offer:', offerData);
                        await db.collection('offers').add(offerData);
                        document.getElementById('addOfferForm').reset();
                        loadAdminOffers();
                        alert('Offer added successfully!');
                    } catch (error) {
                        console.error('Error adding offer:', error);
                        alert('Error adding offer: ' + error.message);
                    }
                });
            } else {
                console.error('Offer form not found');
            }
            
            // Add redeem option form
            const redeemForm = document.getElementById('addRedeemOptionForm');
            if (redeemForm) {
                // Remove existing event listeners to prevent duplicates
                const newRedeemForm = redeemForm.cloneNode(true);
                redeemForm.parentNode.replaceChild(newRedeemForm, redeemForm);
                
                document.getElementById('addRedeemOptionForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    await addRedeemOption();
                });
            } else {
                console.error('Redeem form not found');
            }
        }

        async function loadAdminVideos() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                // Try to order by createdAt, fall back to no ordering if field doesn't exist
                let snapshot;
                try {
                    snapshot = await db.collection('videos').orderBy('createdAt', 'desc').get();
                } catch (orderError) {
                    console.log('Ordering by createdAt failed, loading without ordering:', orderError);
                    snapshot = await db.collection('videos').get();
                }
                
                const listDiv = document.getElementById('adminVideosList');
                listDiv.innerHTML = '';

                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No videos yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const video = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4 hover:bg-gray-50 transition duration-200';
                    
                    const sourceType = video.sourceType === 'embed' ? 'üîó External' : 'üì∫ YouTube';
                    const sourceColor = video.sourceType === 'embed' ? 'text-blue-600' : 'text-red-600';
                    
                    // Generate direct video URL
                    let videoUrl = '';
                    if (video.sourceType === 'embed' && video.embedUrl) {
                        videoUrl = video.embedUrl;
                    } else if (video.youtubeId) {
                        videoUrl = `https://www.youtube.com/watch?v=${video.youtubeId}`;
                    }
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div class="flex-1">
                                <h4 class="font-bold text-lg text-gray-800">${video.title || 'Untitled'}</h4>
                                <p class="text-sm text-gray-600 mt-1">${video.description || 'No description'}</p>
                                <div class="flex items-center mt-2 space-x-4">
                                    <span class="text-yellow-600 font-semibold">${video.points || 0} points</span>
                                    <span class="text-xs ${sourceColor} bg-gray-100 px-2 py-1 rounded-full font-medium">${sourceType}</span>
                                </div>
                                ${videoUrl ? `
                                    <div class="mt-3 p-2 bg-blue-50 border border-blue-200 rounded">
                                        <p class="text-xs font-medium text-blue-800 mb-1">Direct Video Link:</p>
                                        <a href="${videoUrl}" target="_blank" rel="noopener noreferrer" 
                                           class="text-xs text-blue-600 hover:text-blue-800 underline break-all">
                                            ${videoUrl}
                                        </a>
                                    </div>
                                ` : ''}
                            </div>
                            <button onclick="deleteVideo('${doc.id}')" 
                                    class="ml-4 bg-red-500 hover:bg-red-600 text-white text-sm font-medium px-3 py-2 rounded transition duration-200">
                                üóëÔ∏è Delete
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin videos:', error);
                const listDiv = document.getElementById('adminVideosList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading videos. Check console for details.</p>';
            }
        }

        async function deleteVideo(videoId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            if (!confirm('‚ö†Ô∏è Delete Video?\n\nAre you sure you want to delete this video?\nThis action cannot be undone.')) return;

            try {
                await db.collection('videos').doc(videoId).delete();
                loadAdminVideos();
                alert('‚úÖ Video deleted successfully!');
            } catch (error) {
                console.error('Error deleting video:', error);
                alert('‚ùå Error deleting video\n\nPlease try again.');
            }
        }

        async function loadAdminOffers() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                // Try to order by createdAt, fall back to no ordering if field doesn't exist
                let snapshot;
                try {
                    snapshot = await db.collection('offers').orderBy('createdAt', 'desc').get();
                } catch (orderError) {
                    console.log('Ordering by createdAt failed, loading without ordering:', orderError);
                    snapshot = await db.collection('offers').get();
                }
                
                const listDiv = document.getElementById('adminOffersList');
                listDiv.innerHTML = '';

                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No offers yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const offer = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-3 flex justify-between items-center';
                    
                    const hasLink = offer.link && offer.link.trim() !== '';
                    const linkBadge = hasLink ? 
                        '<span class="inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded mr-2">üîó Link</span>' : '';
                    const autoApproveBadge = offer.autoApprove ? 
                        '<span class="inline-block px-2 py-1 text-xs bg-green-100 text-green-800 rounded">Auto-Approve</span>' : '';
                    
                    div.innerHTML = `
                        <div>
                            <h4 class="font-medium">${offer.title || 'Untitled'}</h4>
                            <p class="text-sm text-gray-600">${offer.points || 0} points</p>
                            ${hasLink ? `<p class="text-xs text-blue-600 mt-1 break-all">${offer.link}</p>` : ''}
                            <div class="mt-2">${linkBadge}${autoApproveBadge}</div>
                        </div>
                        <button onclick="deleteOffer('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">Delete</button>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin offers:', error);
                const listDiv = document.getElementById('adminOffersList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading offers. Check console for details.</p>';
            }
        }

        async function deleteOffer(offerId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            if (!confirm('Are you sure you want to delete this offer?')) return;

            try {
                await db.collection('offers').doc(offerId).delete();
                loadAdminOffers();
                alert('Offer deleted successfully!');
            } catch (error) {
                console.error('Error deleting offer:', error);
                alert('Error deleting offer. Please try again.');
            }
        }

        async function loadAdminOfferSubmissions() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const statusFilter = document.getElementById('statusFilter')?.value || 'all';
                
                // Try to order by startedAt, fall back to no ordering if field doesn't exist
                let snapshot;
                try {
                    let query = db.collection('admin_offer_submissions');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.orderBy('startedAt', 'desc').get();
                } catch (orderError) {
                    console.log('Ordering by startedAt failed, loading without ordering:', orderError);
                    let query = db.collection('admin_offer_submissions');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.get();
                }
                
                const listDiv = document.getElementById('adminOfferSubmissionsList');
                listDiv.innerHTML = '';

                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No offer submissions yet.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const submission = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    let statusColor = 'text-blue-600';
                    switch(submission.status?.toLowerCase()) {
                        case 'completed':
                            statusColor = 'text-green-600';
                            break;
                        case 'rejected':
                        case 'denied':
                            statusColor = 'text-red-600';
                            break;
                        case 'pending':
                            statusColor = 'text-yellow-600';
                            break;
                        case 'processing':
                            statusColor = 'text-blue-600';
                            break;
                        case 'started':
                            statusColor = 'text-purple-600';
                            break;
                        default:
                            statusColor = 'text-gray-600';
                    }
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium text-lg">${submission.offerTitle || 'Unknown Offer'}</h4>
                                <p class="text-sm text-gray-600">${submission.userEmail || 'Unknown User'}</p>
                                <p class="text-sm text-gray-700 mt-1"><strong>Task:</strong> ${submission.offerTask || 'No task description'}</p>
                                <p class="text-sm text-yellow-600 mt-1"><strong>Points:</strong> ${submission.pointsOffered || 0}</p>
                                ${submission.offerLink ? `<p class="text-sm text-blue-600 mt-1"><strong>Link:</strong> <a href="${submission.offerLink}" target="_blank" class="underline break-all">${submission.offerLink}</a></p>` : ''}
                                <p class="text-xs text-gray-500 mt-2">Started: ${submission.startedAt ? new Date(submission.startedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                ${submission.hasLink ? '<span class="inline-block px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded mt-1 mr-2">üîó Link Offer</span>' : ''}
                                ${submission.autoApprove ? '<span class="inline-block px-2 py-1 text-xs bg-green-100 text-green-800 rounded mt-1">Auto-Approve</span>' : ''}
                            </div>
                            <span class="text-sm ${statusColor} font-semibold capitalize px-2 py-1 bg-gray-100 rounded">
                                ${submission.status || 'started'}
                            </span>
                        </div>
                        
                        ${submission.adminNote ? `
                            <div class="mb-3 p-2 bg-blue-50 rounded">
                                <p class="text-sm text-blue-800"><strong>Admin Note:</strong> ${submission.adminNote}</p>
                            </div>
                        ` : ''}
                        
                        ${submission.verificationText || (submission.files && submission.files.length > 0) || submission.filesCleared ? `
                            <div class="mb-4 p-4 bg-gradient-to-r from-green-50 to-emerald-50 border border-green-300 rounded-lg">
                                <div class="flex items-center mb-3">
                                    <div class="flex-shrink-0">
                                        <svg class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                        </svg>
                                    </div>
                                    <div class="ml-3">
                                        <h5 class="text-lg font-bold text-green-800">üìã User Verification ${submission.filesCleared ? '(Files Cleared)' : 'Submitted'}</h5>
                                        <p class="text-sm text-green-700">${submission.filesCleared ? 'Review completed - files cleared for storage optimization' : 'Review the evidence provided by the user'}</p>
                                    </div>
                                </div>
                                ${submission.verificationText ? `
                                    <div class="mb-3 p-3 bg-white border border-green-200 rounded-md">
                                        <p class="text-sm font-bold text-gray-800 mb-2">üìù Verification Details:</p>
                                        <div class="text-sm text-gray-700 bg-gray-50 p-3 rounded border max-h-32 overflow-y-auto">
                                            ${submission.verificationText.replace(/\n/g, '<br>')}
                                        </div>
                                    </div>
                                ` : ''}
                                ${submission.filesCleared ? `
                                    <div class="mb-3 p-3 bg-blue-50 border border-blue-200 rounded-md">
                                        <p class="text-sm font-bold text-blue-800 mb-2">üìÅ Files Storage Info:</p>
                                        <p class="text-sm text-blue-700">‚úÖ ${submission.originalFileCount || 'Multiple'} verification files were automatically deleted after review completion to optimize storage space.</p>
                                        <p class="text-xs text-blue-600 mt-1">Cleared: ${submission.filesClearedAt ? new Date(submission.filesClearedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                                    </div>
                                ` : ''}
                                ${submission.files && submission.files.length > 0 ? `
                                    <div class="mb-3">
                                        <p class="text-sm font-bold text-gray-800 mb-3">üì∏ Uploaded Evidence (${submission.files.length} files):</p>
                                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
                                            ${submission.files.map((file, index) => `
                                                <div class="border-2 border-green-200 rounded-lg p-3 bg-white hover:bg-green-50 transition duration-200">
                                                    <div class="flex items-center justify-between mb-2">
                                                        <p class="text-xs font-medium truncate text-gray-800">üñºÔ∏è ${file.name}</p>
                                                        <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">${(file.size / 1024).toFixed(1)} KB</span>
                                                    </div>
                                                    <button onclick="viewVerificationFile('${doc.id}', ${index})" 
                                                            class="w-full bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white text-xs font-medium py-2 px-3 rounded-md transition duration-200">
                                                        üîç View Image
                                                    </button>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                ` : ''}
                                <p class="text-xs text-green-600 font-medium mt-2">‚è∞ Submitted: ${submission.submittedAt ? new Date(submission.submittedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            </div>
                        ` : ''}
                        
                        <div class="grid md:grid-cols-2 gap-4 mt-4">
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">üìã Update Status</label>
                                <select id="status-${doc.id}" class="w-full text-sm px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="started" ${submission.status === 'started' ? 'selected' : ''}>Started</option>
                                    <option value="pending" ${submission.status === 'pending' ? 'selected' : ''}>Pending Review</option>
                                    <option value="processing" ${submission.status === 'processing' ? 'selected' : ''}>Processing</option>
                                    <option value="completed" ${submission.status === 'completed' ? 'selected' : ''}>Completed</option>
                                    <option value="rejected" ${submission.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-bold text-gray-800 mb-2">üìù Admin Note</label>
                                <input id="note-${doc.id}" type="text" value="${submission.adminNote || ''}" 
                                       placeholder="Optional note for user"
                                       class="w-full text-sm px-3 py-2 border-2 border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>
                        
                        <div class="flex flex-wrap gap-2 mt-4">
                            <button onclick="updateOfferStatus('${doc.id}', '${submission.userId}', '${submission.offerId}', ${submission.pointsOffered})" 
                                    class="bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition duration-200">
                                üîÑ Update Status
                            </button>
                            <button onclick="rejectOfferWithReason('${doc.id}', '${submission.userId}', '${submission.offerId}')" 
                                    class="bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition duration-200">
                                ‚ùå Reject with Reason
                            </button>
                            ${submission.status !== 'completed' ? `
                                <button onclick="completeOffer('${doc.id}', '${submission.userId}', '${submission.offerId}', ${submission.pointsOffered})" 
                                        class="bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-medium px-4 py-2 rounded-lg text-sm transition duration-200">
                                    ‚úÖ Complete & Award Points
                                </button>
                            ` : ''}
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin offer submissions:', error);
                const listDiv = document.getElementById('adminOfferSubmissionsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading offer submissions. Check console for details.</p>';
            }
        }

        async function updateOfferStatus(submissionId, userId, offerId, pointsOffered) {
            if (!checkAdminAccess()) {
                return;
            }
            
            const newStatus = document.getElementById(`status-${submissionId}`).value;
            const adminNote = document.getElementById(`note-${submissionId}`).value.trim();
            
            try {
                // Get current submission data to check for files
                const currentSubmission = await db.collection('admin_offer_submissions').doc(submissionId).get();
                const submissionData = currentSubmission.exists ? currentSubmission.data() : null;
                
                const batch = db.batch();
                
                const updateData = {
                    status: newStatus,
                    adminNote: adminNote,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                // If this is a review completion (status changed to completed/rejected), clear files to save storage
                if ((newStatus === 'completed' || newStatus === 'rejected') && submissionData && submissionData.files && submissionData.files.length > 0) {
                    updateData.files = []; // Clear files array
                    updateData.filesCleared = true;
                    updateData.filesClearedAt = firebase.firestore.FieldValue.serverTimestamp();
                    updateData.originalFileCount = submissionData.files.length;
                    console.log(`Clearing ${submissionData.files.length} verification files for storage optimization`);
                }
                
                // Update both admin and user collections
                const adminRef = db.collection('admin_offer_submissions').doc(submissionId);
                const userRef = db.collection('users').doc(userId).collection('startedOffers').doc(offerId);
                
                batch.update(adminRef, updateData);
                batch.update(userRef, updateData);
                
                await batch.commit();
                
                const storageMessage = updateData.filesCleared ? `\n\nüìÅ Storage: ${updateData.originalFileCount} verification files automatically deleted to free up space.` : '';
                alert(`‚úÖ Offer status updated to: ${newStatus}${storageMessage}`);
                loadAdminOfferSubmissions();
                
            } catch (error) {
                console.error('Error updating offer status:', error);
                alert('‚ùå Error updating offer status. Please try again.');
            }
        }

        async function completeOffer(submissionId, userId, offerId, pointsOffered) {
            if (!checkAdminAccess()) {
                return;
            }
            
            if (!confirm(`Award ${pointsOffered} points to user and mark offer as completed?`)) {
                return;
            }
            
            try {
                // Get current submission data to check for files
                const currentSubmission = await db.collection('admin_offer_submissions').doc(submissionId).get();
                const submissionData = currentSubmission.exists ? currentSubmission.data() : null;
                
                const batch = db.batch();
                
                const updateData = {
                    status: 'completed',
                    adminNote: document.getElementById(`note-${submissionId}`).value.trim() || 'Completed by admin',
                    completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    pointsAwarded: pointsOffered
                };
                
                // Clear verification files to save storage since offer is completed
                if (submissionData && submissionData.files && submissionData.files.length > 0) {
                    updateData.files = []; // Clear files array
                    updateData.filesCleared = true;
                    updateData.filesClearedAt = firebase.firestore.FieldValue.serverTimestamp();
                    updateData.originalFileCount = submissionData.files.length;
                    console.log(`Clearing ${submissionData.files.length} verification files after offer completion`);
                }
                
                // Update submission status
                const adminRef = db.collection('admin_offer_submissions').doc(submissionId);
                const userRef = db.collection('users').doc(userId).collection('startedOffers').doc(offerId);
                
                batch.update(adminRef, updateData);
                batch.update(userRef, updateData);
                
                // Award points to user
                const userProfileRef = db.collection('users').doc(userId).collection('profile').doc('data');
                const userDoc = await userProfileRef.get();
                const currentPoints = userDoc.exists ? (userDoc.data().points || 0) : 0;
                
                batch.update(userProfileRef, {
                    points: currentPoints + pointsOffered
                });
                
                // Mark as completed offer
                const completedOfferRef = db.collection('users').doc(userId).collection('completedOffers').doc(offerId);
                batch.set(completedOfferRef, {
                    completedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    pointsEarned: pointsOffered,
                    completedByAdmin: true,
                    completionDate: new Date().toDateString() // For daily reset tracking
                });
                
                await batch.commit();
                
                const storageMessage = updateData.filesCleared ? `\n\nüìÅ Storage: ${updateData.originalFileCount} verification files automatically deleted.` : '';
                alert(`‚úÖ Offer completed! ${pointsOffered} points awarded to user.${storageMessage}`);
                loadAdminOfferSubmissions();
                
            } catch (error) {
                console.error('Error completing offer:', error);
                alert('‚ùå Error completing offer. Please try again.');
            }
        }
        
        // Admin verification functions
        async function viewVerificationFile(submissionId, fileIndex) {
            try {
                const doc = await db.collection('admin_offer_submissions').doc(submissionId).get();
                if (doc.exists) {
                    const submission = doc.data();
                    if (submission.files && submission.files[fileIndex]) {
                        const file = submission.files[fileIndex];
                        
                        // Create enhanced modal to display image
                        const modal = document.createElement('div');
                        modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4';
                        modal.innerHTML = `
                            <div class="bg-white rounded-xl shadow-2xl max-w-5xl max-h-5xl w-full h-full overflow-hidden flex flex-col">
                                <div class="flex justify-between items-center p-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50">
                                    <div>
                                        <h3 class="text-xl font-bold text-gray-800">üñºÔ∏è ${file.name}</h3>
                                        <p class="text-sm text-gray-600">Verification Image ${fileIndex + 1} of ${submission.files.length}</p>
                                    </div>
                                    <button onclick="this.closest('.fixed').remove()" 
                                            class="text-gray-500 hover:text-gray-700 bg-white rounded-full p-2 shadow-md transition duration-200">
                                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                        </svg>
                                    </button>
                                </div>
                                <div class="flex-1 flex items-center justify-center p-4 overflow-auto bg-gray-50">
                                    <img src="${file.data}" alt="${file.name}" 
                                         class="max-w-full max-h-full object-contain rounded-lg shadow-lg cursor-zoom-in"
                                         onclick="this.classList.toggle('cursor-zoom-in'); this.classList.toggle('cursor-zoom-out'); this.style.transform = this.style.transform ? '' : 'scale(1.5)'; this.style.transition = 'transform 0.3s';">
                                </div>
                                <div class="p-4 bg-gray-100 border-t">
                                    <div class="flex justify-between items-center text-sm text-gray-600">
                                        <div>
                                            <span class="font-medium">Size:</span> ${(file.size / 1024).toFixed(1)} KB
                                            <span class="mx-2">‚Ä¢</span>
                                            <span class="font-medium">Type:</span> ${file.type}
                                        </div>
                                        <div class="flex space-x-2">
                                            ${fileIndex > 0 ? `
                                                <button onclick="this.closest('.fixed').remove(); viewVerificationFile('${submissionId}', ${fileIndex - 1})" 
                                                        class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-200">
                                                    ‚Üê Previous
                                                </button>
                                            ` : ''}
                                            ${fileIndex < submission.files.length - 1 ? `
                                                <button onclick="this.closest('.fixed').remove(); viewVerificationFile('${submissionId}', ${fileIndex + 1})" 
                                                        class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600 transition duration-200">
                                                    Next ‚Üí
                                                </button>
                                            ` : ''}
                                            <button onclick="downloadVerificationFile('${file.data}', '${file.name}')" 
                                                    class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600 transition duration-200">
                                                üíæ Download
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        document.body.appendChild(modal);
                        
                        // Close modal when clicking outside
                        modal.addEventListener('click', (e) => {
                            if (e.target === modal) {
                                modal.remove();
                            }
                        });
                        
                        // Close modal with Escape key
                        const handleEscape = (e) => {
                            if (e.key === 'Escape') {
                                modal.remove();
                                document.removeEventListener('keydown', handleEscape);
                            }
                        };
                        document.addEventListener('keydown', handleEscape);
                    }
                }
            } catch (error) {
                console.error('Error viewing verification file:', error);
                alert('Error loading verification file.');
            }
        }
        
        function downloadVerificationFile(dataUrl, filename) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        async function rejectOfferWithReason(submissionId, userId, offerId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            const reason = prompt('Enter rejection reason for the user:');
            if (!reason || reason.trim() === '') {
                alert('Rejection reason is required.');
                return;
            }
            
            try {
                // Get current submission data to check for files
                const currentSubmission = await db.collection('admin_offer_submissions').doc(submissionId).get();
                const submissionData = currentSubmission.exists ? currentSubmission.data() : null;
                
                const batch = db.batch();
                
                const updateData = {
                    status: 'rejected',
                    adminNote: `Rejected: ${reason.trim()}`,
                    rejectedAt: firebase.firestore.FieldValue.serverTimestamp(),
                    rejectionReason: reason.trim()
                };
                
                // Clear verification files to save storage since offer is rejected
                if (submissionData && submissionData.files && submissionData.files.length > 0) {
                    updateData.files = []; // Clear files array
                    updateData.filesCleared = true;
                    updateData.filesClearedAt = firebase.firestore.FieldValue.serverTimestamp();
                    updateData.originalFileCount = submissionData.files.length;
                    console.log(`Clearing ${submissionData.files.length} verification files after offer rejection`);
                }
                
                // Update both admin and user collections
                const adminRef = db.collection('admin_offer_submissions').doc(submissionId);
                const userRef = db.collection('users').doc(userId).collection('startedOffers').doc(offerId);
                
                batch.update(adminRef, updateData);
                batch.update(userRef, updateData);
                
                await batch.commit();
                
                const storageMessage = updateData.filesCleared ? `\n\nüìÅ Storage: ${updateData.originalFileCount} verification files automatically deleted.` : '';
                alert(`‚úÖ Offer rejected successfully with reason: "${reason}"${storageMessage}`);
                loadAdminOfferSubmissions();
                
            } catch (error) {
                console.error('Error rejecting offer:', error);
                alert('‚ùå Error rejecting offer. Please try again.');
            }
        }

        async function loadAdminWithdrawals() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const statusFilter = document.getElementById('withdrawalStatusFilter')?.value || 'all';
                
                // Try to order by requestedAt, fall back to no ordering if field doesn't exist
                let snapshot;
                try {
                    let query = db.collection('admin_withdrawals');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.orderBy('requestedAt', 'desc').get();
                } catch (orderError) {
                    console.log('Ordering by requestedAt failed, loading without ordering:', orderError);
                    let query = db.collection('admin_withdrawals');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.get();
                }
                
                const listDiv = document.getElementById('adminWithdrawalsList');
                listDiv.innerHTML = '';

                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No withdrawal requests found for the selected filter.</p>';
                    return;
                }

                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = withdrawal.status === 'approved' ? 'text-green-600' : 
                                       withdrawal.status === 'rejected' ? 'text-red-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">${withdrawal.userEmail || 'Unknown User'}</h4>
                                <p class="text-sm text-gray-600">$${withdrawal.cashAmount} (${withdrawal.pointsUsed} points)</p>
                                ${withdrawal.upiId ? `<p class="text-sm text-blue-600 font-medium">UPI: ${withdrawal.upiId}</p>` : '<p class="text-sm text-red-500">No UPI ID provided</p>'}
                                <p class="text-xs text-gray-500">${withdrawal.requestedAt ? new Date(withdrawal.requestedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            </div>
                            <span class="text-sm ${statusColor} capitalize">${withdrawal.status}</span>
                        </div>
                        ${withdrawal.status === 'pending' ? `
                            <div class="flex space-x-2 mt-3">
                                <button onclick="updateWithdrawalStatus('${doc.id}', 'approved')" 
                                        class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    Approve
                                </button>
                                <button onclick="updateWithdrawalStatus('${doc.id}', 'rejected')" 
                                        class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                    Reject
                                </button>
                            </div>
                        ` : ''}
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin withdrawals:', error);
                const listDiv = document.getElementById('adminWithdrawalsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading withdrawal requests. Check console for details.</p>';
            }
        }

        async function updateWithdrawalStatus(withdrawalId, status) {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const batch = db.batch();
                
                // Update both admin and user collections
                const adminRef = db.collection('admin_withdrawals').doc(withdrawalId);
                const adminDoc = await adminRef.get();
                
                if (adminDoc.exists) {
                    const withdrawalData = adminDoc.data();
                    const userRef = db.collection('users').doc(withdrawalData.userId)
                        .collection('withdrawals').doc(withdrawalId);
                    
                    batch.update(adminRef, { status: status });
                    batch.update(userRef, { status: status });
                    
                    // If rejected, refund the points to the user
                    if (status === 'rejected') {
                        const userProfileRef = db.collection('users').doc(withdrawalData.userId)
                            .collection('profile').doc('data');
                        const userProfileDoc = await userProfileRef.get();
                        
                        if (userProfileDoc.exists) {
                            const currentPoints = userProfileDoc.data().points || 0;
                            const refundedPoints = currentPoints + withdrawalData.pointsUsed;
                            batch.update(userProfileRef, { points: refundedPoints });
                        }
                    }
                    
                    await batch.commit();
                    loadAdminWithdrawals();
                    
                    const action = status === 'rejected' ? 'rejected and points refunded' : status;
                    alert(`Withdrawal ${action} successfully!`);
                }
            } catch (error) {
                console.error('Error updating withdrawal status:', error);
                alert('Error updating withdrawal status. Please try again.');
            }
        }

        // Admin redeem options management
        async function addRedeemOption() {
            if (!checkAdminAccess()) {
                return;
            }
            
            const cashAmount = document.getElementById('redeemCashAmount').value;
            const inrAmount = document.getElementById('redeemInrAmount').value;
            const pointsRequired = document.getElementById('redeemPointsRequired').value;
            const description = document.getElementById('redeemDescription').value;
            const isActive = document.getElementById('redeemActive').checked;
            
            if (!cashAmount || !inrAmount || !pointsRequired || !description) {
                alert('All fields are required.');
                return;
            }
            
            try {
                const redeemOption = {
                    cashAmount: parseFloat(cashAmount),
                    inrAmount: parseFloat(inrAmount),
                    pointsRequired: parseInt(pointsRequired),
                    description: description,
                    isActive: isActive,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('redeem_options').add(redeemOption);
                alert('Redeem option added successfully!');
                loadRedeemOptions();
            } catch (error) {
                console.error('Error adding redeem option:', error);
                alert('Error adding redeem option. Please try again.');
            }
        }
        
        async function loadRedeemOptions() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const snapshot = await db.collection('redeem_options').get();
                const listDiv = document.getElementById('redeemOptionsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No redeem options found.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const option = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = option.isActive ? 'text-green-600' : 'text-red-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">${option.description}</h4>
                                <p class="text-sm text-gray-600">üí∞ ${option.cashAmount} (${option.pointsRequired} points)</p>
                                <p class="text-sm text-gray-600">‚Çπ ${option.inrAmount}</p>
                                <p class="text-xs text-gray-500">${option.createdAt ? new Date(option.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            </div>
                            <span class="text-sm ${statusColor} capitalize">${option.isActive ? 'Active' : 'Inactive'}</span>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="editRedeemOption('${doc.id}', '${option.description}', ${option.cashAmount}, ${option.inrAmount}, ${option.pointsRequired}, ${option.isActive})" 
                                    class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                                Edit
                            </button>
                            <button onclick="deleteRedeemOption('${doc.id}')" 
                                    class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                Delete
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading redeem options:', error);
                const listDiv = document.getElementById('redeemOptionsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading redeem options. Check console for details.</p>';
            }
        }
        
        function editRedeemOption(optionId, description, cashAmount, inrAmount, pointsRequired, isActive) {
            if (!checkAdminAccess()) {
                return;
            }
            
            document.getElementById('redeemOptionId').value = optionId;
            document.getElementById('redeemCashAmount').value = cashAmount;
            document.getElementById('redeemInrAmount').value = inrAmount;
            document.getElementById('redeemPointsRequired').value = pointsRequired;
            document.getElementById('redeemDescription').value = description;
            document.getElementById('redeemActive').checked = isActive;
            
            document.getElementById('addRedeemOptionButton').style.display = 'none';
            document.getElementById('editRedeemOptionButton').style.display = 'inline-block';
        }
        
        async function updateRedeemOption() {
            if (!checkAdminAccess()) {
                return;
            }
            
            const optionId = document.getElementById('redeemOptionId').value;
            const cashAmount = document.getElementById('redeemCashAmount').value;
            const inrAmount = document.getElementById('redeemInrAmount').value;
            const pointsRequired = document.getElementById('redeemPointsRequired').value;
            const description = document.getElementById('redeemDescription').value;
            const isActive = document.getElementById('redeemActive').checked;
            
            if (!cashAmount || !inrAmount || !pointsRequired || !description) {
                alert('All fields are required.');
                return;
            }
            
            try {
                const redeemOption = {
                    cashAmount: parseFloat(cashAmount),
                    inrAmount: parseFloat(inrAmount),
                    pointsRequired: parseInt(pointsRequired),
                    description: description,
                    isActive: isActive,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                await db.collection('redeem_options').doc(optionId).update(redeemOption);
                alert('Redeem option updated successfully!');
                loadRedeemOptions();
            } catch (error) {
                console.error('Error updating redeem option:', error);
                alert('Error updating redeem option. Please try again.');
            }
        }
        
        async function deleteRedeemOption(optionId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            if (!confirm('Are you sure you want to delete this redeem option?')) {
                return;
            }
            
            try {
                await db.collection('redeem_options').doc(optionId).delete();
                alert('Redeem option deleted successfully!');
                loadRedeemOptions();
            } catch (error) {
                console.error('Error deleting redeem option:', error);
                alert('Error deleting redeem option. Please try again.');
            }
        }
        
        // Download Verification Management Functions
        async function loadAdminDownloadVerifications() {
            if (!checkAdminAccess()) return;
            
            try {
                const statusFilter = document.getElementById('downloadStatusFilter')?.value || 'all';
                
                let snapshot;
                try {
                    let query = db.collection('admin_download_verifications');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.orderBy('submittedAt', 'desc').get();
                } catch (orderError) {
                    let query = db.collection('admin_download_verifications');
                    if (statusFilter !== 'all') {
                        query = query.where('status', '==', statusFilter);
                    }
                    snapshot = await query.get();
                }
                
                const listDiv = document.getElementById('adminDownloadVerificationsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No download verifications found.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const verification = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = verification.status === 'approved' ? 'text-green-600' : 
                                       verification.status === 'rejected' ? 'text-red-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-3">
                            <div class="flex-1">
                                <h4 class="font-medium">${verification.userEmail}</h4>
                                <p class="text-sm text-gray-600">Movie: ${verification.movieTitle}</p>
                                <p class="text-sm text-green-600 font-medium">üí∞ ${verification.points} points</p>
                                ${verification.comments ? `<p class="text-sm text-gray-600 mt-1">Comments: ${verification.comments}</p>` : ''}
                                <p class="text-xs text-gray-500">${verification.submittedAt ? new Date(verification.submittedAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            </div>
                            <span class="text-sm ${statusColor} capitalize font-medium">${verification.status}</span>
                        </div>
                        
                        ${verification.screenshot ? `
                            <div class="mb-3">
                                <img src="${verification.screenshot}" alt="Download Screenshot" 
                                     class="max-w-full h-32 object-contain border rounded cursor-pointer" 
                                     onclick="showFullScreenImage('${verification.screenshot}', 'Download Screenshot')">
                            </div>
                        ` : ''}
                        
                        ${verification.status === 'pending' ? `
                            <div class="flex space-x-2">
                                <button onclick="updateDownloadVerificationStatus('${doc.id}', 'approved')" 
                                        class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                    ‚úÖ Approve
                                </button>
                                <button onclick="updateDownloadVerificationStatus('${doc.id}', 'rejected')" 
                                        class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                    ‚ùå Reject
                                </button>
                            </div>
                        ` : ''}
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading download verifications:', error);
                const listDiv = document.getElementById('adminDownloadVerificationsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading verifications. Check console for details.</p>';
            }
        }
        
        async function updateDownloadVerificationStatus(verificationId, status) {
            if (!checkAdminAccess()) return;
            
            try {
                const verificationDoc = await db.collection('admin_download_verifications').doc(verificationId).get();
                if (!verificationDoc.exists) {
                    alert('Verification not found!');
                    return;
                }
                
                const verificationData = verificationDoc.data();
                const batch = db.batch();
                
                // Update admin collection
                const adminRef = db.collection('admin_download_verifications').doc(verificationId);
                batch.update(adminRef, { 
                    status: status,
                    reviewedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user's pending downloads
                const userRef = db.collection('users').doc(verificationData.userId)
                    .collection('pendingDownloads').doc(verificationId);
                batch.update(userRef, { 
                    status: status,
                    reviewedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // If approved, add points and move to downloaded movies
                if (status === 'approved') {
                    // Add points to user
                    const userProfileRef = db.collection('users').doc(verificationData.userId)
                        .collection('profile').doc('data');
                    const userProfileDoc = await userProfileRef.get();
                    
                    if (userProfileDoc.exists) {
                        const currentPoints = userProfileDoc.data().points || 0;
                        const newPoints = currentPoints + verificationData.points;
                        batch.update(userProfileRef, { points: newPoints });
                    }
                    
                    // Add to downloaded movies
                    const downloadedMovieRef = db.collection('users').doc(verificationData.userId)
                        .collection('downloadedMovies').doc(verificationData.movieId);
                    batch.set(downloadedMovieRef, {
                        downloadedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        pointsEarned: verificationData.points,
                        movieTitle: verificationData.movieTitle,
                        verificationId: verificationId,
                        downloadDate: new Date().toDateString() // For daily reset tracking
                    });
                }
                
                await batch.commit();
                loadAdminDownloadVerifications();
                
                const action = status === 'approved' ? 'approved and points credited' : 'rejected';
                alert(`Download verification ${action} successfully!`);
                
            } catch (error) {
                console.error('Error updating verification status:', error);
                alert('Error updating verification status. Please try again.');
            }
        }
        
        function showFullScreenImage(imageSrc, title) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="relative max-w-full max-h-full">
                    <button onclick="this.closest('.fixed').remove()" 
                            class="absolute top-4 right-4 text-white text-2xl font-bold bg-black bg-opacity-50 rounded-full w-10 h-10 flex items-center justify-center hover:bg-opacity-70">
                        ‚úï
                    </button>
                    <img src="${imageSrc}" alt="${title}" class="max-w-full max-h-full object-contain">
                    <div class="absolute bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-70 text-white px-4 py-2 rounded">
                        ${title}
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on click outside
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            });
        }
        
        async function loadAdminRedeemOptions() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                let snapshot;
                
                // Try with orderBy first
                try {
                    snapshot = await db.collection('redeem_options')
                        .orderBy('pointsRequired', 'asc').get();
                } catch (orderError) {
                    console.log('OrderBy failed, loading without ordering:', orderError);
                    // Fallback: get all documents without ordering
                    snapshot = await db.collection('redeem_options').get();
                }
                    
                const listDiv = document.getElementById('adminRedeemOptionsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No redeem options yet. Create your first redeem option above.</p>';
                    return;
                }
                
                // Convert to array and sort manually if needed
                const options = [];
                snapshot.forEach(doc => {
                    const option = doc.data();
                    options.push({ id: doc.id, ...option });
                });
                
                // Sort by points required
                options.sort((a, b) => (a.pointsRequired || 0) - (b.pointsRequired || 0));
                
                options.forEach(optionData => {
                    const option = optionData;
                    const docId = optionData.id;
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-3';
                    
                    const statusBadge = option.active ? 
                        '<span class="inline-block px-2 py-1 text-xs bg-green-100 text-green-800 rounded">Active</span>' :
                        '<span class="inline-block px-2 py-1 text-xs bg-red-100 text-red-800 rounded">Inactive</span>';
                    
                    const cashAmount = option.cashAmount || 0;
                    const inrAmount = option.inrAmount || 0;
                    const pointsRequired = option.pointsRequired || 0;
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">$${cashAmount} (‚Çπ${inrAmount}) - ${pointsRequired} Points</h4>
                                ${option.description ? `<p class="text-sm text-gray-600">${option.description}</p>` : ''}
                                <p class="text-xs text-gray-500 mt-1">Created: ${option.createdAt ? new Date(option.createdAt.toDate()).toLocaleDateString() : 'Recently'}</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                ${statusBadge}
                            </div>
                        </div>
                        <div class="flex space-x-2 mt-3">
                            <button onclick="toggleRedeemOption('${docId}', ${!option.active})" 
                                    class="${option.active ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-green-600 hover:bg-green-700'} text-white px-3 py-1 rounded text-sm">
                                ${option.active ? 'Deactivate' : 'Activate'}
                            </button>
                            <button onclick="editRedeemOption('${docId}')" 
                                    class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                Edit
                            </button>
                            <button onclick="deleteRedeemOption('${docId}')" 
                                    class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                Delete
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading admin redeem options:', error);
                const listDiv = document.getElementById('adminRedeemOptionsList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading redeem options. Please refresh the page. If the issue persists, check the browser console for details.</p>';
            }
        }
        
        async function toggleRedeemOption(optionId, newStatus) {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                await db.collection('redeem_options').doc(optionId).update({
                    active: newStatus
                });
                
                loadAdminRedeemOptions();
                alert(`Redeem option ${newStatus ? 'activated' : 'deactivated'} successfully!`);
                
            } catch (error) {
                console.error('Error updating redeem option:', error);
                alert('Error updating redeem option. Please try again.');
            }
        }
        
        async function deleteRedeemOption(optionId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            if (!confirm('Are you sure you want to delete this redeem option?')) return;
            
            try {
                await db.collection('redeem_options').doc(optionId).delete();
                loadAdminRedeemOptions();
                alert('Redeem option deleted successfully!');
                
            } catch (error) {
                console.error('Error deleting redeem option:', error);
                alert('Error deleting redeem option. Please try again.');
            }
        }
        
        async function editRedeemOption(optionId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const doc = await db.collection('redeem_options').doc(optionId).get();
                if (doc.exists) {
                    const option = doc.data();
                    
                    // Fill form with current values
                    document.getElementById('redeemCashAmount').value = option.cashAmount;
                    document.getElementById('redeemInrAmount').value = option.inrAmount || (option.cashAmount * 83); // Default conversion if missing
                    document.getElementById('redeemPointsRequired').value = option.pointsRequired;
                    document.getElementById('redeemDescription').value = option.description || '';
                    document.getElementById('redeemActive').checked = option.active;
                    
                    // Change form to edit mode
                    const form = document.getElementById('addRedeemOptionForm');
                    const submitBtn = form.querySelector('button[type="submit"]');
                    submitBtn.textContent = 'Update Redeem Option';
                    submitBtn.onclick = () => updateRedeemOption(optionId);
                }
            } catch (error) {
                console.error('Error loading redeem option for edit:', error);
                alert('Error loading redeem option data.');
            }
        }
        
        async function updateRedeemOption(optionId) {
            if (!checkAdminAccess()) {
                return;
            }
            
            const cashAmount = document.getElementById('redeemCashAmount').value;
            const inrAmount = document.getElementById('redeemInrAmount').value;
            const pointsRequired = document.getElementById('redeemPointsRequired').value;
            const description = document.getElementById('redeemDescription').value;
            const isActive = document.getElementById('redeemActive').checked;
            
            if (!cashAmount || !inrAmount || !pointsRequired) {
                alert('Please fill in all required fields.');
                return;
            }
            
            try {
                await db.collection('redeem_options').doc(optionId).update({
                    cashAmount: parseFloat(cashAmount),
                    inrAmount: parseFloat(inrAmount),
                    pointsRequired: parseInt(pointsRequired),
                    description: description,
                    active: isActive,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Reset form
                document.getElementById('addRedeemOptionForm').reset();
                document.getElementById('redeemActive').checked = true;
                
                // Reset form to add mode
                const form = document.getElementById('addRedeemOptionForm');
                const submitBtn = form.querySelector('button[type="submit"]');
                submitBtn.textContent = 'Add Redeem Option';
                submitBtn.onclick = null;
                
                alert('Redeem option updated successfully!');
                loadAdminRedeemOptions();
                
            } catch (error) {
                console.error('Error updating redeem option:', error);
                alert('Error updating redeem option. Please try again.');
            }
        }
        
        // User redeem options loading
        async function loadUserRedeemOptions() {
            try {
                let snapshot;
                
                // Try with where and orderBy first
                try {
                    snapshot = await db.collection('redeem_options')
                        .where('active', '==', true)
                        .orderBy('pointsRequired', 'asc').get();
                } catch (indexError) {
                    console.log('Index not available, trying without orderBy:', indexError);
                    // Fallback: try with just where clause
                    try {
                        snapshot = await db.collection('redeem_options')
                            .where('active', '==', true).get();
                    } catch (whereError) {
                        console.log('Where clause failed, loading all documents:', whereError);
                        // Final fallback: get all documents and filter manually
                        snapshot = await db.collection('redeem_options').get();
                    }
                }
                    
                const listDiv = document.getElementById('redeemOptionsList');
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<div class="text-center py-8 text-gray-500"><p>No redeem options available at the moment.</p><p class="text-sm mt-2">Please check back later or contact support.</p></div>';
                    return;
                }
                
                // Filter and sort manually if needed
                const options = [];
                snapshot.forEach(doc => {
                    const option = doc.data();
                    if (option.active !== false) { // Include if active is true or undefined
                        options.push({ id: doc.id, ...option });
                    }
                });
                
                // Sort by points required
                options.sort((a, b) => (a.pointsRequired || 0) - (b.pointsRequired || 0));
                
                if (options.length === 0) {
                    listDiv.innerHTML = '<div class="text-center py-8 text-gray-500"><p>No active redeem options available at the moment.</p><p class="text-sm mt-2">Please check back later or contact support.</p></div>';
                    return;
                }
                
                options.forEach(option => {
                    const div = document.createElement('div');
                    div.className = 'border p-4 rounded-lg';
                    
                    const canAfford = userProfile && userProfile.points >= (option.pointsRequired || 0);
                    const buttonClass = canAfford ? 
                        'w-full mt-2 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700' :
                        'w-full mt-2 bg-gray-400 text-white py-2 px-4 rounded cursor-not-allowed';
                    
                    const cashAmount = option.cashAmount || 0;
                    const inrAmount = option.inrAmount || 0;
                    const pointsRequired = option.pointsRequired || 0;
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="font-medium">$${cashAmount.toFixed(2)}</span>
                                <span class="text-sm text-blue-600 ml-2">(‚Çπ${inrAmount.toFixed(2)} INR)</span>
                            </div>
                            <span class="text-sm text-gray-600">${pointsRequired} Points</span>
                        </div>
                        ${option.description ? `<p class="text-xs text-gray-500 mt-1">${option.description}</p>` : ''}
                        <button onclick="requestWithdrawal(${pointsRequired}, ${cashAmount})" 
                                class="${buttonClass}" ${!canAfford ? 'disabled' : ''}>
                            ${canAfford ? 'Request' : `Need ${pointsRequired - (userProfile?.points || 0)} more points`}
                        </button>
                    `;
                    listDiv.appendChild(div);
                });
                
            } catch (error) {
                console.error('Error loading user redeem options:', error);
                const listDiv = document.getElementById('redeemOptionsList');
                // Show default options if database fails
                listDiv.innerHTML = `
                    <div class="text-center py-4 text-yellow-600">
                        <p class="mb-4">Unable to load custom redeem options. Using default options:</p>
                    </div>
                    <div class="border p-4 rounded-lg mb-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="font-medium">$1.00</span>
                                <span class="text-sm text-blue-600 ml-2">(‚Çπ83.00 INR)</span>
                            </div>
                            <span class="text-sm text-gray-600">100 Points</span>
                        </div>
                        <button onclick="requestWithdrawal(100, 1)" 
                                class="w-full mt-2 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                            Request
                        </button>
                    </div>
                    <div class="border p-4 rounded-lg mb-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="font-medium">$5.00</span>
                                <span class="text-sm text-blue-600 ml-2">(‚Çπ415.00 INR)</span>
                            </div>
                            <span class="text-sm text-gray-600">500 Points</span>
                        </div>
                        <button onclick="requestWithdrawal(500, 5)" 
                                class="w-full mt-2 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                            Request
                        </button>
                    </div>
                    <div class="border p-4 rounded-lg">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="font-medium">$10.00</span>
                                <span class="text-sm text-blue-600 ml-2">(‚Çπ830.00 INR)</span>
                            </div>
                            <span class="text-sm text-gray-600">1000 Points</span>
                        </div>
                        <button onclick="requestWithdrawal(1000, 10)" 
                                class="w-full mt-2 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                            Request
                        </button>
                    </div>
                `;
            }
        }
        
        // Enhanced withdrawal management functions
        async function bulkUpdateWithdrawals() {
            if (!checkAdminAccess()) {
                return;
            }
            
            const action = prompt('Enter action (approve/reject):');
            if (!['approve', 'reject'].includes(action)) {
                alert('Invalid action. Please enter "approve" or "reject".');
                return;
            }
            
            const confirmed = confirm(`Are you sure you want to ${action} all pending withdrawal requests?`);
            if (!confirmed) return;
            
            try {
                const snapshot = await db.collection('admin_withdrawals')
                    .where('status', '==', 'pending').get();
                    
                if (snapshot.empty) {
                    alert('No pending withdrawal requests found.');
                    return;
                }
                
                const batch = db.batch();
                let count = 0;
                
                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const adminRef = db.collection('admin_withdrawals').doc(doc.id);
                    const userRef = db.collection('users').doc(withdrawal.userId)
                        .collection('withdrawals').doc(doc.id);
                    
                    batch.update(adminRef, { status: action === 'approve' ? 'approved' : 'rejected' });
                    batch.update(userRef, { status: action === 'approve' ? 'approved' : 'rejected' });
                    count++;
                });
                
                await batch.commit();
                loadAdminWithdrawals();
                alert(`Successfully ${action}d ${count} withdrawal requests.`);
                
            } catch (error) {
                console.error('Error in bulk update:', error);
                alert('Error in bulk update. Please try again.');
            }
        }
        
        async function exportWithdrawals() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                const snapshot = await db.collection('admin_withdrawals')
                    .orderBy('requestedAt', 'desc').get();
                    
                if (snapshot.empty) {
                    alert('No withdrawal data to export.');
                    return;
                }
                
                let csvContent = 'Date,User Email,UPI ID,Cash Amount,Points Used,Status\n';
                
                snapshot.forEach(doc => {
                    const withdrawal = doc.data();
                    const date = withdrawal.requestedAt ? 
                        new Date(withdrawal.requestedAt.toDate()).toLocaleDateString() : 'N/A';
                    
                    csvContent += `"${date}","${withdrawal.userEmail || ''}","${withdrawal.upiId || ''}","$${withdrawal.cashAmount}","${withdrawal.pointsUsed}","${withdrawal.status}"\n`;
                });
                
                // Create and download file
                const blob = new Blob([csvContent], { type: 'text/csv' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = `withdrawal_requests_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
                document.body.removeChild(a);
                
                alert('Withdrawal data exported successfully!');
                
            } catch (error) {
                console.error('Error exporting withdrawals:', error);
                alert('Error exporting withdrawal data. Please try again.');
            }
        }

        async function loadAdminSupport() {
            if (!checkAdminAccess()) {
                return;
            }
            
            try {
                // Try to order by createdAt, fall back to no ordering if field doesn't exist
                let snapshot;
                try {
                    snapshot = await db.collection('admin_support_tickets')
                        .orderBy('createdAt', 'desc').get();
                } catch (orderError) {
                    console.log('Ordering by createdAt failed, loading without ordering:', orderError);
                    snapshot = await db.collection('admin_support_tickets').get();
                }
                
                const listDiv = document.getElementById('adminSupportList');
                listDiv.innerHTML = '';

                if (snapshot.empty) {
                    listDiv.innerHTML = '<div class="text-center py-8"><p class="text-gray-500">No support tickets yet.</p><p class="text-xs text-gray-400 mt-2">üîí All user tickets will appear here for admin review</p></div>';
                    return;
                }
                
                // Add security header
                const headerDiv = document.createElement('div');
                headerDiv.className = 'mb-4 p-3 bg-red-50 border border-red-200 rounded-lg';
                headerDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <h4 class="font-bold text-red-800">üìä Admin Support Dashboard</h4>
                        <span class="text-sm bg-red-100 text-red-800 px-2 py-1 rounded-full font-medium">${snapshot.size} Total Tickets</span>
                    </div>
                    <p class="text-xs text-red-600 mt-1">‚ö†Ô∏è CONFIDENTIAL: Private tickets from all users - Handle with strict confidentiality</p>
                `;
                listDiv.appendChild(headerDiv);

                snapshot.forEach(doc => {
                    const ticket = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-4';
                    
                    const statusColor = ticket.status === 'closed' ? 'text-green-600' : 'text-yellow-600';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h4 class="font-medium">${ticket.subject || 'No Subject'}</h4>
                                <p class="text-sm text-gray-600">üë§ ${ticket.userEmail || 'Unknown User'}</p>
                                <p class="text-xs text-gray-500">ID: ${ticket.userId ? ticket.userId.substring(0, 8) + '...' : 'N/A'}</p>
                            </div>
                            <div class="text-right">
                                <span class="text-sm ${statusColor} capitalize font-semibold px-2 py-1 bg-gray-50 rounded">${ticket.status || 'open'}</span>
                                <div class="text-xs text-gray-400 mt-1">üîí Private Ticket</div>
                            </div>
                        </div>
                        <div class="mb-3 p-3 bg-gray-50 rounded border-l-4 border-blue-400">
                            <p class="text-sm text-gray-700">${ticket.message || 'No message'}</p>
                        </div>
                        <p class="text-xs text-gray-500 mb-3">
                            üï∞Ô∏è Submitted: ${ticket.createdAt ? new Date(ticket.createdAt.toDate()).toLocaleDateString() : 'Recently'}
                        </p>
                        
                        ${ticket.adminReply ? `
                            <div class="mb-3 p-3 bg-blue-50 rounded">
                                <p class="text-sm font-medium text-blue-800">Your Reply:</p>
                                <p class="text-sm text-blue-700">${ticket.adminReply}</p>
                            </div>
                        ` : ''}
                        
                        ${(ticket.status || 'open') === 'open' ? `
                            <div class="mt-3">
                                <textarea id="reply-${doc.id}" placeholder="Type your reply..." 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md text-sm mb-2"></textarea>
                                <button onclick="replyToTicket('${doc.id}')" 
                                        class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                    Send Reply
                                </button>
                            </div>
                        ` : ''}
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin support:', error);
                const listDiv = document.getElementById('adminSupportList');
                listDiv.innerHTML = '<p class="text-red-500">Error loading support tickets. Check console for details.</p>';
            }
        }

        async function replyToTicket(ticketId) {
            // SECURITY: Admin access required
            if (!checkAdminAccess()) {
                return;
            }
            
            const replyText = document.getElementById(`reply-${ticketId}`).value.trim();
            if (!replyText) {
                alert('Please enter a reply message.');
                return;
            }
            
            if (replyText.length > 2000) {
                alert('Reply message must be less than 2000 characters.');
                return;
            }

            try {
                const batch = db.batch();
                
                // Get ticket data to find user ID
                const adminRef = db.collection('admin_support_tickets').doc(ticketId);
                const adminDoc = await adminRef.get();
                
                if (adminDoc.exists) {
                    const ticketData = adminDoc.data();
                    
                    // SECURITY: Verify ticket data integrity
                    if (!ticketData.userId || !ticketData.userEmail) {
                        alert('Error: Invalid ticket data. Cannot send reply.');
                        return;
                    }
                    
                    const userRef = db.collection('users').doc(ticketData.userId)
                        .collection('support_tickets').doc(ticketId);
                    
                    const updateData = {
                        adminReply: replyText,
                        status: 'closed',
                        repliedAt: firebase.firestore.FieldValue.serverTimestamp(),
                        repliedBy: currentUser.email // Track which admin replied
                    };
                    
                    batch.update(adminRef, updateData);
                    batch.update(userRef, updateData);
                    
                    await batch.commit();
                    loadAdminSupport();
                    
                    alert(`‚úÖ Reply sent successfully!\n\nüìß Sent to: ${ticketData.userEmail}\nüîí Ticket marked as closed`);
                } else {
                    alert('Error: Ticket not found.');
                }
            } catch (error) {
                console.error('Error replying to ticket:', error);
                alert('‚ùå Error sending reply. Please try again.');
            }
        }

        // UI functions
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }

        function showAuth() {
            document.getElementById('authContainer').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
        }

        function showApp() {
            document.getElementById('authContainer').classList.add('hidden');
            document.getElementById('appContainer').classList.remove('hidden');
            
            // Show admin panel if user is admin
            if (isAdmin) {
                document.getElementById('adminPanel').classList.remove('hidden');
                // Ensure admin forms are set up
                setTimeout(() => {
                    setupAdminForms();
                    loadAdminVideos();
                }, 100);
            } else {
                document.getElementById('adminPanel').classList.add('hidden');
            }
            
            // Setup forms and load initial data
            setupSupportForm();
            loadVideos();
            
            // Load redeem options for the redeem tab
            if (document.getElementById('redeem').classList.contains('active')) {
                setTimeout(() => {
                    loadUserRedeemOptions();
                }, 200);
            }
                            
            // Setup video source type toggle
            setupVideoSourceToggle();
        }

        // Video source toggle function
        function setupVideoSourceToggle() {
            const radioButtons = document.querySelectorAll('input[name="videoSource"]');
            const youtubeSection = document.getElementById('youtubeSection');
            const embedSection = document.getElementById('embedSection');
            const youtubeInput = document.getElementById('videoYoutubeId');
            const embedInput = document.getElementById('videoEmbedUrl');

            if (radioButtons.length > 0) {
                radioButtons.forEach(radio => {
                    radio.addEventListener('change', function() {
                        if (this.value === 'youtube') {
                            youtubeSection.classList.remove('hidden');
                            embedSection.classList.add('hidden');
                            youtubeInput.required = true;
                            embedInput.required = false;
                            embedInput.value = '';
                        } else {
                            youtubeSection.classList.add('hidden');
                            embedSection.classList.remove('hidden');
                            embedInput.required = true;
                            youtubeInput.required = false;
                            youtubeInput.value = '';
                        }
                    });
                });
            }
        }

        // Movies & Series Functions
        let moviesData = [];
        let categoriesData = [];
        let currentMovieFilters = { type: 'all', category: 'all' };

        // Load Movies & Series
        async function loadMovies() {
            try {
                const snapshot = await db.collection('movies').get();
                moviesData = [];
                
                snapshot.forEach(doc => {
                    moviesData.push({ id: doc.id, ...doc.data() });
                });
                
                displayMovies();
                loadCategories();
            } catch (error) {
                console.error('Error loading movies:', error);
            }
        }

        // Load Categories
        async function loadCategories() {
            try {
                const snapshot = await db.collection('movie_categories').get();
                categoriesData = [];
                
                snapshot.forEach(doc => {
                    categoriesData.push({ id: doc.id, ...doc.data() });
                });
                
                displayCategoryFilters();
                loadAdminCategories();
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        // Display Category Filters
        function displayCategoryFilters() {
            const filtersDiv = document.getElementById('movieCategoryFilters');
            if (!filtersDiv) return;
            filtersDiv.innerHTML = '';
            
            categoriesData.forEach(category => {
                const button = document.createElement('button');
                button.onclick = () => filterMoviesByCategory(category.id);
                button.className = 'category-filter-btn bg-gray-200 text-gray-700 hover:bg-gray-300 px-4 py-2 rounded-full font-bold transition duration-200 touch-target';
                button.innerHTML = `üé≠ ${category.name}`;
                filtersDiv.appendChild(button);
            });
        }

        // Filter Functions
        function filterMoviesByCategory(categoryId) {
            currentMovieFilters.category = categoryId;
            updateCategoryFilterButtons(categoryId);
            displayMovies();
        }

        function filterMoviesByType(type) {
            currentMovieFilters.type = type;
            updateTypeFilterButtons(type);
            displayMovies();
        }

        // Update filter buttons
        function updateCategoryFilterButtons(activeCategory) {
            document.querySelectorAll('.category-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            if (activeCategory === 'all') {
                const allBtn = document.querySelector('button[onclick="filterMoviesByCategory(\'all\')"]');
                if (allBtn) {
                    allBtn.classList.add('active', 'bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white');
                    allBtn.classList.remove('bg-gray-200', 'text-gray-700');
                }
            } else {
                const categoryBtn = document.querySelector(`button[onclick="filterMoviesByCategory('${activeCategory}')"]`);
                if (categoryBtn) {
                    categoryBtn.classList.add('active', 'bg-gradient-to-r', 'from-purple-500', 'to-pink-500', 'text-white');
                    categoryBtn.classList.remove('bg-gray-200', 'text-gray-700');
                }
            }
        }

        function updateTypeFilterButtons(activeType) {
            document.querySelectorAll('.type-filter-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-gradient-to-r', 'from-blue-500', 'to-indigo-500', 'text-white');
                btn.classList.add('bg-gray-200', 'text-gray-700');
            });
            
            const activeBtn = document.querySelector(`button[onclick="filterMoviesByType('${activeType}')"]`);
            if (activeBtn) {
                activeBtn.classList.add('active', 'bg-gradient-to-r', 'from-blue-500', 'to-indigo-500', 'text-white');
                activeBtn.classList.remove('bg-gray-200', 'text-gray-700');
            }
        }

        // Display Movies
        function displayMovies() {
            const grid = document.getElementById('moviesGrid');
            if (!grid) return;
            grid.innerHTML = '';
            
            let filteredMovies = moviesData;
            
            if (currentMovieFilters.type !== 'all') {
                filteredMovies = filteredMovies.filter(movie => movie.type === currentMovieFilters.type);
            }
            
            if (currentMovieFilters.category !== 'all') {
                filteredMovies = filteredMovies.filter(movie => {
                    // Handle both new multiple categories and old single category format
                    if (Array.isArray(movie.categories)) {
                        return movie.categories.includes(currentMovieFilters.category);
                    } else {
                        // Backward compatibility for old single category format
                        return movie.category === currentMovieFilters.category;
                    }
                });
            }
            
            if (filteredMovies.length === 0) {
                grid.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8"><p>No content found for current filters.</p></div>';
                return;
            }
            
            filteredMovies.forEach(movie => {
                const movieCard = createMovieCard(movie);
                grid.appendChild(movieCard);
            });
        }

        // Create Movie Card
        function createMovieCard(movie) {
            const div = document.createElement('div');
            div.className = 'bg-white bg-opacity-95 rounded-xl shadow-xl overflow-hidden transform hover:scale-105 transition-all duration-300 mobile-card';
            
            const typeIcon = movie.type === 'movie' ? 'üé¨' : 'üì∫';
            const qualityColor = getQualityColor(movie.quality);
            
            div.innerHTML = `
                <div class="relative">
                    ${movie.poster ? `
                        <img src="${movie.poster}" alt="${movie.title}" class="w-full h-48 sm:h-56 object-cover">
                    ` : `
                        <div class="w-full h-48 sm:h-56 bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center">
                            <div class="text-center text-white">
                                <div class="text-3xl mb-2">${typeIcon}</div>
                                <p class="text-sm font-medium">${movie.type.toUpperCase()}</p>
                            </div>
                        </div>
                    `}
                    <div class="absolute top-2 left-2 flex flex-col gap-1">
                        <span class="bg-black bg-opacity-70 text-white text-xs px-2 py-1 rounded-full font-bold">
                            ${typeIcon} ${movie.type.toUpperCase()}
                        </span>
                        <span class="${qualityColor} text-xs px-2 py-1 rounded-full font-bold">
                            üì∫ ${movie.quality}
                        </span>
                    </div>
                    ${movie.downloadPoints > 0 ? `
                        <div class="absolute top-2 right-2">
                            <span class="bg-gradient-to-r from-yellow-400 to-orange-500 text-white text-xs px-2 py-1 rounded-full font-bold">
                                üí∞ ${movie.downloadPoints}pts
                            </span>
                        </div>
                    ` : ''}
                </div>
                <div class="p-3">
                    <h3 class="font-bold text-sm mb-1 line-clamp-2 text-gray-800">${movie.title}</h3>
                    <div class="flex items-center gap-2 mb-2">
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">${movie.language}</span>
                        ${movie.releaseYear ? `<span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">${movie.releaseYear}</span>` : ''}
                    </div>
                    <div class="mb-2">
                        <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full">${getCategoryName(movie.categories || movie.category)}</span>
                    </div>
                    <button onclick="openMovieDetails('${movie.id}')" 
                            class="w-full bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white text-xs font-bold py-2 px-2 rounded transition duration-200">
                        üìñ View Details
                    </button>
                </div>
            `;
            
            return div;
        }

        // Helper Functions
        function getQualityColor(quality) {
            const qualityColors = {
                '4K': 'bg-red-600 text-white',
                '2K': 'bg-red-500 text-white',
                '1080p': 'bg-blue-600 text-white',
                'HD 1080p': 'bg-blue-600 text-white',
                '720p': 'bg-blue-500 text-white',
                'HD 720p': 'bg-blue-500 text-white',
                '480p': 'bg-green-500 text-white',
                'BluRay': 'bg-purple-600 text-white',
                'WebDL': 'bg-indigo-600 text-white',
                'CamRip': 'bg-yellow-600 text-white'
            };
            return qualityColors[quality] || 'bg-gray-600 text-white';
        }

        function getCategoryName(categoryIds) {
            if (Array.isArray(categoryIds)) {
                // Handle multiple categories
                return categoryIds.map(id => {
                    const category = categoriesData.find(cat => cat.id === id);
                    return category ? category.name : 'Unknown';
                }).join(', ');
            } else {
                // Handle single category (backward compatibility)
                const category = categoriesData.find(cat => cat.id === categoryIds);
                return category ? category.name : 'Unknown';
            }
        }

        // Movie Actions
        async function downloadMovie(movieId, downloadLink, points) {
            try {
                const userMovieDoc = await db.collection('users').doc(currentUser.uid)
                    .collection('downloadedMovies').doc(movieId).get();
                
                if (userMovieDoc.exists) {
                    const downloadData = userMovieDoc.data();
                    const downloadDate = downloadData.downloadDate || (downloadData.downloadedAt ? new Date(downloadData.downloadedAt.toDate()).toDateString() : null);
                    const today = new Date().toDateString();
                    
                    if (downloadDate === today) {
                        const confirmed = confirm('üé¨ Already Downloaded Today!\n\nYou have already downloaded this movie today and earned points.\nCome back tomorrow at 12:00 AM for a fresh reset!\n\nWould you like to download it again without earning points?');
                        if (confirmed) {
                            // Force external browser redirect
                            redirectToExternalBrowser(downloadLink);
                        }
                        return;
                    }
                }
                
                const confirmed = confirm(`üé¨ Start Download Process?

‚Ä¢ You'll be redirected to the download link via external browser
‚Ä¢ After downloading, you need to upload a screenshot for verification
‚Ä¢ Points will be credited after admin approval
‚Ä¢ Downloads reset daily at 12:00 AM for re-earning

Proceed with download?`);
                if (!confirmed) return;
                
                // Force redirect to external browser
                redirectToExternalBrowser(downloadLink);
                
                // Show verification modal
                setTimeout(() => {
                    showDownloadVerificationModal(movieId, points);
                }, 2000); // Give time for download to start
                
            } catch (error) {
                console.error('Error downloading movie:', error);
                alert('‚ùå Error starting download\n\nPlease try again. If the problem persists, contact support.');
            }
        }
        
        // Function to force external browser redirect
        function redirectToExternalBrowser(url) {
            try {
                // Create a temporary link element to force external browser opening
                const link = document.createElement('a');
                link.href = url;
                link.target = '_blank';
                link.rel = 'noopener noreferrer';
                
                // For mobile devices, try to use window.location for better external browser handling
                if (/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                    // On mobile, try multiple methods to ensure external browser opening
                    
                    // Method 1: Direct location change (works well on mobile)
                    setTimeout(() => {
                        window.location.href = url;
                    }, 100);
                    
                    // Method 2: Fallback with window.open
                    setTimeout(() => {
                        window.open(url, '_blank', 'noopener,noreferrer');
                    }, 200);
                    
                } else {
                    // For desktop, use standard window.open
                    window.open(url, '_blank', 'noopener,noreferrer');
                }
                
                // Additional fallback: programmatic click
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                // Show user feedback
                setTimeout(() => {
                    if (confirm('üåê External Browser Redirect\n\nIf the download didn\'t start automatically, please check your browser\'s download section or tap "OK" to try again.')) {
                        window.open(url, '_blank', 'noopener,noreferrer');
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Error redirecting to external browser:', error);
                // Fallback to simple window.open
                window.open(url, '_blank');
            }
        }
        
        function showDownloadVerificationModal(movieId, points) {
            const movie = moviesData.find(m => m.id === movieId);
            if (!movie) return;
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-md w-full">
                    <div class="p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">üì∏ Verify Your Download</h3>
                        <p class="text-gray-600 mb-4">To earn ${points} points for downloading "${movie.title}", please upload a screenshot of your download.</p>
                        
                        <form id="downloadVerificationForm">
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Upload Screenshot</label>
                                <input type="file" id="downloadScreenshot" accept="image/*" required 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <p class="text-xs text-gray-500 mt-1">Upload a screenshot showing the download in progress or completed</p>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Additional Comments (Optional)</label>
                                <textarea id="downloadComments" rows="3" placeholder="Any additional comments about the download..."
                                          class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>
                            </div>
                            
                            <div class="flex gap-3">
                                <button type="submit" class="flex-1 bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700">
                                    ‚úÖ Submit Verification
                                </button>
                                <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                                    ‚ùå Cancel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Handle form submission
            document.getElementById('downloadVerificationForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const fileInput = document.getElementById('downloadScreenshot');
                const comments = document.getElementById('downloadComments').value.trim();
                
                if (!fileInput.files[0]) {
                    alert('Please select a screenshot to upload.');
                    return;
                }
                
                try {
                    // Convert file to base64
                    const screenshot = await fileToBase64(fileInput.files[0]);
                    
                    const verificationData = {
                        userId: currentUser.uid,
                        userEmail: currentUser.email,
                        movieId: movieId,
                        movieTitle: movie.title,
                        points: points,
                        screenshot: screenshot,
                        comments: comments,
                        status: 'pending',
                        submittedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    // Add to admin collection for review
                    const verificationRef = await db.collection('admin_download_verifications').add(verificationData);
                    
                    // Add to user's pending downloads
                    await db.collection('users').doc(currentUser.uid)
                        .collection('pendingDownloads').doc(verificationRef.id).set(verificationData);
                    
                    modal.remove();
                    alert('üéâ Verification submitted!\n\nYour download verification has been submitted for admin review. You will receive points once approved.');
                    
                } catch (error) {
                    console.error('Error submitting verification:', error);
                    alert('Error submitting verification. Please try again.');
                }
            });
        }

        function openMoviePlayer(movieId) {
            const movie = moviesData.find(m => m.id === movieId);
            if (!movie || !movie.watchLink) {
                alert('Watch link not available for this movie.');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-6xl w-full max-h-full overflow-hidden">
                    <div class="flex justify-between items-center p-4 border-b">
                        <h3 class="text-xl font-bold text-gray-800">${movie.title}</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                            ‚úï
                        </button>
                    </div>
                    <div class="aspect-video">
                        <iframe src="${movie.watchLink}" class="w-full h-full" frameborder="0" allowfullscreen></iframe>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function openMovieDetails(movieId) {
            const movie = moviesData.find(m => m.id === movieId);
            if (!movie) return;
            
            const typeIcon = movie.type === 'movie' ? 'üé¨' : 'üì∫';
            const qualityColor = getQualityColor(movie.quality);
            
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-2xl w-full max-h-full overflow-y-auto">
                    <div class="sticky top-0 bg-white flex justify-between items-center p-4 border-b">
                        <h3 class="text-xl font-bold text-gray-800">üìñ Movie Details</h3>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                            ‚úï
                        </button>
                    </div>
                    <div class="p-6">
                        ${movie.poster ? `<img src="${movie.poster}" alt="${movie.title}" class="w-full h-64 object-cover rounded-xl mb-4">` : `
                            <div class="w-full h-64 bg-gradient-to-br from-gray-800 to-gray-900 flex items-center justify-center rounded-xl mb-4">
                                <div class="text-center text-white">
                                    <div class="text-6xl mb-2">${typeIcon}</div>
                                    <p class="text-lg font-bold">${movie.type.toUpperCase()}</p>
                                </div>
                            </div>
                        `}
                        
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">${movie.title}</h2>
                        
                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm text-gray-600 font-medium">Type</p>
                                <p class="font-bold">${typeIcon} ${movie.type.toUpperCase()}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm text-gray-600 font-medium">Language</p>
                                <p class="font-bold">${movie.language}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm text-gray-600 font-medium">Categories</p>
                                <p class="font-bold">${getCategoryName(movie.categories || movie.category)}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-sm text-gray-600 font-medium">Quality</p>
                                <p class="font-bold ${qualityColor} px-2 py-1 rounded text-center">${movie.quality}</p>
                            </div>
                            ${movie.releaseYear ? `
                                <div class="bg-gray-50 p-3 rounded-lg col-span-2">
                                    <p class="text-sm text-gray-600 font-medium">Release Year</p>
                                    <p class="font-bold text-lg">${movie.releaseYear}</p>
                                </div>
                            ` : ''}
                        </div>
                        
                        ${movie.summary ? `
                            <div class="mb-4">
                                <h4 class="font-bold text-gray-800 mb-2">üìã Summary</h4>
                                <p class="text-gray-600 leading-relaxed">${movie.summary}</p>
                            </div>
                        ` : ''}
                        
                        <div class="flex gap-2">
                            ${movie.downloadLink ? `
                                <button onclick="downloadMovie('${movie.id}', '${movie.downloadLink}', ${movie.downloadPoints || 0}); this.closest('.fixed').remove();" 
                                        class="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                                    ‚¨áÔ∏è Download Now
                                    ${movie.downloadPoints > 0 ? ` (+${movie.downloadPoints} pts)` : ''}
                                </button>
                            ` : ''}
                            ${movie.watchLink ? `
                                <button onclick="openMoviePlayer('${movie.id}'); this.closest('.fixed').remove();" 
                                        class="flex-1 bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                                    ‚ñ∂Ô∏è Watch Online
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        // Admin Movie Functions
        async function loadAdminCategories() {
            // Load checkboxes for multi-category selection
            const categoryCheckboxes = document.getElementById('categoryCheckboxes');
            if (categoryCheckboxes) {
                categoryCheckboxes.innerHTML = '';
                
                if (categoriesData.length === 0) {
                    categoryCheckboxes.innerHTML = '<p class="text-gray-500 text-sm">No categories available. Add some below.</p>';
                } else {
                    categoriesData.forEach(category => {
                        const checkboxDiv = document.createElement('div');
                        checkboxDiv.className = 'flex items-center';
                        checkboxDiv.innerHTML = `
                            <input type="checkbox" id="cat_${category.id}" value="${category.id}" 
                                   class="category-checkbox mr-2 text-blue-600 focus:ring-blue-500 border-gray-300 rounded">
                            <label for="cat_${category.id}" class="text-sm text-gray-700">${category.name}</label>
                        `;
                        categoryCheckboxes.appendChild(checkboxDiv);
                    });
                }
            }
            
            // Populate release years dropdown
            const releaseYearSelect = document.getElementById('movieReleaseYear');
            if (releaseYearSelect) {
                releaseYearSelect.innerHTML = '<option value="">Select Release Year</option>';
                
                // Generate years from 1980 to current year + 2
                const currentYear = new Date().getFullYear();
                for (let year = currentYear + 2; year >= 1980; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    releaseYearSelect.appendChild(option);
                }
            }
            
            // Load categories list for management
            const categoriesList = document.getElementById('categoriesList');
            if (categoriesList) {
                categoriesList.innerHTML = '';
                if (categoriesData.length === 0) {
                    categoriesList.innerHTML = '<p class="text-gray-500 text-sm">No categories yet.</p>';
                    return;
                }
                
                categoriesData.forEach(category => {
                    const div = document.createElement('div');
                    div.className = 'flex justify-between items-center p-2 bg-gray-50 rounded border';
                    div.innerHTML = `
                        <span class="font-medium">${category.name}</span>
                        <button onclick="deleteCategory('${category.id}')" class="text-red-600 hover:text-red-800 text-sm">
                            üóëÔ∏è Delete
                        </button>
                    `;
                    categoriesList.appendChild(div);
                });
            }
        }

        // Add new category function
        async function addNewCategory() {
            if (!checkAdminAccess()) return;
            
            const newCategoryInput = document.getElementById('newCategoryInput');
            const categoryName = newCategoryInput.value.trim();
            
            if (!categoryName) {
                alert('Please enter a category name.');
                return;
            }
            
            // Check if category already exists
            const existingCategory = categoriesData.find(cat => 
                cat.name.toLowerCase() === categoryName.toLowerCase()
            );
            
            if (existingCategory) {
                alert('This category already exists!');
                return;
            }
            
            try {
                const docRef = await db.collection('movie_categories').add({
                    name: categoryName,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Add to local array and refresh UI
                categoriesData.push({ id: docRef.id, name: categoryName });
                loadAdminCategories();
                displayCategoryFilters();
                
                // Clear input and show success
                newCategoryInput.value = '';
                alert(`Category "${categoryName}" added successfully!`);
                
            } catch (error) {
                console.error('Error adding category:', error);
                alert('Error adding category. Please try again.');
            }
        }

        function setupAdminMovieForms() {
            if (!checkAdminAccess()) return;
            
            const categoryForm = document.getElementById('addCategoryForm');
            if (categoryForm) {
                categoryForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!checkAdminAccess()) return;
                    
                    const categoryName = document.getElementById('categoryName').value.trim();
                    if (!categoryName) {
                        alert('Please enter a category name.');
                        return;
                    }
                    
                    try {
                        await db.collection('movie_categories').add({
                            name: categoryName,
                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        
                        document.getElementById('categoryName').value = '';
                        loadCategories();
                        alert('Category added successfully!');
                    } catch (error) {
                        console.error('Error adding category:', error);
                        alert('Error adding category. Please try again.');
                    }
                });
            }
            
            const movieForm = document.getElementById('addMovieForm');
            if (movieForm) {
                movieForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    if (!checkAdminAccess()) return;
                    
                    const movieData = {
                        type: document.getElementById('movieType').value,
                        title: document.getElementById('movieTitle').value.trim(),
                        language: document.getElementById('movieLanguage').value,
                        categories: getSelectedCategories(), // Multiple categories
                        releaseYear: parseInt(document.getElementById('movieReleaseYear').value),
                        quality: document.getElementById('movieQuality').value,
                        poster: document.getElementById('moviePoster').value.trim(),
                        downloadLink: document.getElementById('movieDownloadLink').value.trim(),
                        watchLink: document.getElementById('movieWatchLink').value.trim(),
                        downloadPoints: parseInt(document.getElementById('movieDownloadPoints').value) || 0,
                        summary: document.getElementById('movieSummary').value.trim(),
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    // Validation
                    if (!movieData.title) {
                        alert('Please enter a movie title.');
                        return;
                    }
                    
                    if (!movieData.categories || movieData.categories.length === 0) {
                        alert('Please select at least one category.');
                        return;
                    }
                    
                    if (!movieData.releaseYear) {
                        alert('Please select a release year.');
                        return;
                    }
                    
                    if (!movieData.downloadLink && !movieData.watchLink) {
                        alert('Please provide at least one link (download or watch).');
                        return;
                    }
                    
                    try {
                        // Add debugging logs
                        console.log('Adding movie with data:', movieData);
                        
                        // Save movie to database
                        const docRef = await db.collection('movies').add(movieData);
                        console.log('Movie saved with ID:', docRef.id);
                        
                        // Reset form
                        document.getElementById('addMovieForm').reset();
                        // Clear category checkboxes
                        document.querySelectorAll('.category-checkbox').forEach(checkbox => {
                            checkbox.checked = false;
                        });
                        
                        // Reload data
                        await loadMovies();
                        await loadAdminMoviesList();
                        
                        alert('Movie/Series added successfully!');
                    } catch (error) {
                        console.error('Error adding movie:', error);
                        alert('Error adding movie: ' + error.message);
                    }
                });
            }
        }

        // Helper function to get selected categories
        function getSelectedCategories() {
            const checkboxes = document.querySelectorAll('.category-checkbox:checked');
            return Array.from(checkboxes).map(checkbox => checkbox.value);
        }

        async function deleteCategory(categoryId) {
            if (!checkAdminAccess()) return;
            
            const confirmed = confirm('Are you sure you want to delete this category?');
            if (!confirmed) return;
            
            try {
                await db.collection('movie_categories').doc(categoryId).delete();
                loadCategories();
                alert('Category deleted successfully!');
            } catch (error) {
                console.error('Error deleting category:', error);
                alert('Error deleting category. Please try again.');
            }
        }

        async function loadAdminMoviesList() {
            if (!checkAdminAccess()) return;
            
            try {
                const snapshot = await db.collection('movies').orderBy('createdAt', 'desc').get();
                const listDiv = document.getElementById('adminMoviesList');
                if (!listDiv) return;
                listDiv.innerHTML = '';
                
                if (snapshot.empty) {
                    listDiv.innerHTML = '<p class="text-gray-500">No movies/series added yet.</p>';
                    return;
                }
                
                snapshot.forEach(doc => {
                    const movie = doc.data();
                    const div = document.createElement('div');
                    div.className = 'border rounded-lg p-3';
                    
                    const typeIcon = movie.type === 'movie' ? 'üé¨' : 'üì∫';
                    
                    div.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <h4 class="font-medium">${movie.title}</h4>
                                <p class="text-sm text-gray-600">${typeIcon} ${movie.type} ‚Ä¢ ${movie.language} ‚Ä¢ ${movie.quality}</p>
                                <p class="text-sm text-gray-600">Categories: ${getCategoryName(movie.categories || movie.category)}</p>
                                ${movie.releaseYear ? `<p class="text-sm text-gray-600">Year: ${movie.releaseYear}</p>` : ''}
                                ${movie.downloadPoints > 0 ? `<p class="text-sm text-green-600 font-medium">üí∞ ${movie.downloadPoints} points</p>` : ''}
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editMovie('${doc.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                    ‚úèÔ∏è Edit
                                </button>
                                <button onclick="deleteMovie('${doc.id}')" class="text-red-600 hover:text-red-800 text-sm">
                                    üóëÔ∏è Delete
                                </button>
                            </div>
                        </div>
                        <div class="flex gap-2 text-xs">
                            ${movie.downloadLink ? '<span class="bg-green-100 text-green-800 px-2 py-1 rounded">Download ‚úì</span>' : ''}
                            ${movie.watchLink ? '<span class="bg-blue-100 text-blue-800 px-2 py-1 rounded">Watch ‚úì</span>' : ''}
                        </div>
                    `;
                    listDiv.appendChild(div);
                });
            } catch (error) {
                console.error('Error loading admin movies list:', error);
            }
        }

        async function deleteMovie(movieId) {
            if (!checkAdminAccess()) return;
            
            const confirmed = confirm('Are you sure you want to delete this movie/series?');
            if (!confirmed) return;
            
            try {
                await db.collection('movies').doc(movieId).delete();
                loadMovies();
                loadAdminMoviesList();
                alert('Movie/Series deleted successfully!');
            } catch (error) {
                console.error('Error deleting movie:', error);
                alert('Error deleting movie. Please try again.');
            }
        }

        async function editMovie(movieId) {
            if (!checkAdminAccess()) return;
            
            try {
                // Get movie data
                const movieDoc = await db.collection('movies').doc(movieId).get();
                if (!movieDoc.exists) {
                    alert('Movie not found!');
                    return;
                }
                
                const movie = movieDoc.data();
                
                // Create edit modal
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl max-w-2xl w-full max-h-full overflow-y-auto">
                        <div class="sticky top-0 bg-white flex justify-between items-center p-4 border-b">
                            <h3 class="text-xl font-bold text-gray-800">‚úèÔ∏è Edit Movie/Series</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                                ‚úï
                            </button>
                        </div>
                        <div class="p-6">
                            <form id="editMovieForm">
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Type</label>
                                        <select id="editMovieType" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="movie" ${movie.type === 'movie' ? 'selected' : ''}>Movie</option>
                                            <option value="series" ${movie.type === 'series' ? 'selected' : ''}>Series</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Language</label>
                                        <select id="editMovieLanguage" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="English" ${movie.language === 'English' ? 'selected' : ''}>English</option>
                                            <option value="Hindi" ${movie.language === 'Hindi' ? 'selected' : ''}>Hindi</option>
                                            <option value="Spanish" ${movie.language === 'Spanish' ? 'selected' : ''}>Spanish</option>
                                            <option value="French" ${movie.language === 'French' ? 'selected' : ''}>French</option>
                                            <option value="German" ${movie.language === 'German' ? 'selected' : ''}>German</option>
                                            <option value="Japanese" ${movie.language === 'Japanese' ? 'selected' : ''}>Japanese</option>
                                            <option value="Korean" ${movie.language === 'Korean' ? 'selected' : ''}>Korean</option>
                                            <option value="Other" ${movie.language === 'Other' ? 'selected' : ''}>Other</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Title</label>
                                    <input id="editMovieTitle" type="text" required value="${movie.title || ''}" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Release Year</label>
                                        <select id="editMovieReleaseYear" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">Select Release Year</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Video Quality</label>
                                        <select id="editMovieQuality" required class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="480p" ${movie.quality === '480p' ? 'selected' : ''}>480p</option>
                                            <option value="720p" ${movie.quality === '720p' ? 'selected' : ''}>720p</option>
                                            <option value="1080p" ${movie.quality === '1080p' ? 'selected' : ''}>1080p</option>
                                            <option value="2K" ${movie.quality === '2K' ? 'selected' : ''}>2K</option>
                                            <option value="4K" ${movie.quality === '4K' ? 'selected' : ''}>4K</option>
                                            <option value="WebDL" ${movie.quality === 'WebDL' ? 'selected' : ''}>WebDL</option>
                                            <option value="BluRay" ${movie.quality === 'BluRay' ? 'selected' : ''}>BluRay</option>
                                            <option value="CamRip" ${movie.quality === 'CamRip' ? 'selected' : ''}>CamRip</option>
                                            <option value="HD 720p" ${movie.quality === 'HD 720p' ? 'selected' : ''}>HD 720p</option>
                                            <option value="HD 1080p" ${movie.quality === 'HD 1080p' ? 'selected' : ''}>HD 1080p</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Categories</label>
                                    <div class="border border-gray-300 rounded-md p-3 max-h-40 overflow-y-auto bg-gray-50">
                                        <div id="editCategoryCheckboxes" class="space-y-2">
                                            <!-- Categories will be loaded here -->
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Poster URL</label>
                                    <input id="editMoviePoster" type="url" value="${movie.poster || ''}" placeholder="https://example.com/poster.jpg"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div class="grid md:grid-cols-2 gap-4 mb-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Download Link</label>
                                        <input id="editMovieDownloadLink" type="url" value="${movie.downloadLink || ''}" placeholder="https://example.com/download"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">Watch Link (Embed)</label>
                                        <input id="editMovieWatchLink" type="url" value="${movie.watchLink || ''}" placeholder="https://example.com/embed"
                                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Download Points</label>
                                    <input id="editMovieDownloadPoints" type="number" min="0" value="${movie.downloadPoints || 0}" placeholder="Points for downloading"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                
                                <div class="mb-4">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Summary</label>
                                    <textarea id="editMovieSummary" rows="4" placeholder="Movie/Series summary..."
                                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">${movie.summary || ''}</textarea>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button type="submit" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700">
                                        ‚úÖ Update Movie/Series
                                    </button>
                                    <button type="button" onclick="this.closest('.fixed').remove()" class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-50">
                                        ‚ùå Cancel
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Populate release years
                const editReleaseYearSelect = document.getElementById('editMovieReleaseYear');
                const currentYear = new Date().getFullYear();
                for (let year = currentYear + 2; year >= 1980; year--) {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    option.selected = movie.releaseYear === year;
                    editReleaseYearSelect.appendChild(option);
                }
                
                // Populate categories
                const editCategoryCheckboxes = document.getElementById('editCategoryCheckboxes');
                categoriesData.forEach(category => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'flex items-center';
                    const isSelected = Array.isArray(movie.categories) ? 
                        movie.categories.includes(category.id) : 
                        movie.category === category.id;
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" id="edit_cat_${category.id}" value="${category.id}" 
                               class="edit-category-checkbox mr-2 text-blue-600 focus:ring-blue-500 border-gray-300 rounded" 
                               ${isSelected ? 'checked' : ''}>
                        <label for="edit_cat_${category.id}" class="text-sm text-gray-700">${category.name}</label>
                    `;
                    editCategoryCheckboxes.appendChild(checkboxDiv);
                });
                
                // Handle form submission
                document.getElementById('editMovieForm').addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const selectedCategories = Array.from(document.querySelectorAll('.edit-category-checkbox:checked')).map(cb => cb.value);
                    
                    if (selectedCategories.length === 0) {
                        alert('Please select at least one category.');
                        return;
                    }
                    
                    const updatedMovieData = {
                        type: document.getElementById('editMovieType').value,
                        title: document.getElementById('editMovieTitle').value.trim(),
                        language: document.getElementById('editMovieLanguage').value,
                        categories: selectedCategories,
                        releaseYear: parseInt(document.getElementById('editMovieReleaseYear').value),
                        quality: document.getElementById('editMovieQuality').value,
                        poster: document.getElementById('editMoviePoster').value.trim(),
                        downloadLink: document.getElementById('editMovieDownloadLink').value.trim(),
                        watchLink: document.getElementById('editMovieWatchLink').value.trim(),
                        downloadPoints: parseInt(document.getElementById('editMovieDownloadPoints').value) || 0,
                        summary: document.getElementById('editMovieSummary').value.trim(),
                        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                    };
                    
                    if (!updatedMovieData.title) {
                        alert('Please enter a movie title.');
                        return;
                    }
                    
                    if (!updatedMovieData.releaseYear) {
                        alert('Please select a release year.');
                        return;
                    }
                    
                    if (!updatedMovieData.downloadLink && !updatedMovieData.watchLink) {
                        alert('Please provide at least one link (download or watch).');
                        return;
                    }
                    
                    try {
                        await db.collection('movies').doc(movieId).update(updatedMovieData);
                        
                        // Close modal and reload data
                        modal.remove();
                        await loadMovies();
                        await loadAdminMoviesList();
                        
                        alert('Movie/Series updated successfully!');
                    } catch (error) {
                        console.error('Error updating movie:', error);
                        alert('Error updating movie: ' + error.message);
                    }
                });
                
            } catch (error) {
                console.error('Error loading movie for edit:', error);
                alert('Error loading movie data. Please try again.');
            }
        }

        // Offer link webpage modal function
        function openOfferLink(url, offerId) {
            // Create webpage modal
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 p-4';
            modal.id = `offer-modal-${offerId}`;
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-6xl w-full h-5/6 flex flex-col shadow-2xl">
                    <div class="flex items-center justify-between p-4 border-b bg-gradient-to-r from-blue-50 to-indigo-50">
                        <div class="flex items-center space-x-3">
                            <span class="text-2xl">üåç</span>
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">Offer Task Page</h3>
                                <p class="text-sm text-gray-600">Complete the task shown in the webpage below</p>
                            </div>
                        </div>
                        <div class="flex items-center space-x-2">
                            <button onclick="openInExternalBrowser('${url}')" 
                                    class="bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold px-4 py-2 rounded-lg transition duration-200 flex items-center space-x-2">
                                <span class="text-lg">üåç</span>
                                <span>Open Externally</span>
                            </button>
                            <button onclick="closeOfferModal('${offerId}')" 
                                    class="text-gray-500 hover:text-gray-700 text-2xl font-bold p-2">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    <div class="flex-1 relative">
                        <iframe src="${url}" 
                                class="w-full h-full border-0" 
                                frameborder="0" 
                                allowfullscreen
                                sandbox="allow-scripts allow-same-origin allow-forms allow-popups allow-popups-to-escape-sandbox allow-top-navigation">
                        </iframe>
                        <div class="absolute inset-0 pointer-events-none">
                            <div class="absolute top-4 right-4 bg-black bg-opacity-70 text-white px-3 py-2 rounded-lg text-sm">
                                üì± If page needs redirection, use "Open Externally" button above
                            </div>
                        </div>
                    </div>
                    <div class="p-4 border-t bg-gray-50">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2 text-sm text-gray-600">
                                <span class="text-lg">üìù</span>
                                <span>Complete the task in the webpage above, then return to claim your points</span>
                            </div>
                            <button onclick="closeOfferModal('${offerId}')" 
                                    class="bg-gradient-to-r from-blue-500 to-indigo-500 hover:from-blue-600 hover:to-indigo-600 text-white font-bold px-6 py-2 rounded-lg transition duration-200">
                                Done - Return to App
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Close on escape key
            const handleEscape = (e) => {
                if (e.key === 'Escape') {
                    closeOfferModal(offerId);
                }
            };
            document.addEventListener('keydown', handleEscape);
            
            // Store escape handler for cleanup
            modal.escapeHandler = handleEscape;
        }
        
        function closeOfferModal(offerId) {
            const modal = document.getElementById(`offer-modal-${offerId}`);
            if (modal) {
                // Remove escape key listener
                if (modal.escapeHandler) {
                    document.removeEventListener('keydown', modal.escapeHandler);
                }
                modal.remove();
            }
        }
        
        function openInExternalBrowser(url) {
            // Show redirection popup
            const redirectModal = document.createElement('div');
            redirectModal.className = 'fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-60 p-4';
            
            redirectModal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-md w-full p-6 shadow-2xl">
                    <div class="text-center mb-6">
                        <div class="text-4xl mb-3">üåç</div>
                        <h3 class="text-xl font-bold text-gray-800 mb-2">Open in External Browser</h3>
                        <p class="text-gray-600 text-sm">This will redirect you to your device's default browser for better compatibility</p>
                    </div>
                    
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="flex items-start space-x-3">
                            <span class="text-blue-600 text-lg">üìù</span>
                            <div class="text-sm text-blue-800">
                                <p class="font-medium mb-1">Instructions:</p>
                                <ul class="list-disc ml-4 space-y-1">
                                    <li>Complete the task in your browser</li>
                                    <li>Take screenshots as proof</li>
                                    <li>Return here to upload verification</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex space-x-3">
                        <button onclick="this.closest('.fixed').remove()" 
                                class="flex-1 bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            Cancel
                        </button>
                        <button onclick="confirmExternalRedirect('${url}')" 
                                class="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white font-bold py-3 px-4 rounded-lg transition duration-200">
                            Open Browser
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(redirectModal);
        }
        
        function confirmExternalRedirect(url) {
            // Close the redirect modal
            document.querySelectorAll('.fixed').forEach(modal => {
                if (modal.className.includes('z-60')) {
                    modal.remove();
                }
            });
            
            // Use the existing external browser redirection function
            redirectToExternalBrowser(url);
            
            // Show success feedback
            setTimeout(() => {
                const notification = document.createElement('div');
                notification.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-lg shadow-lg z-50';
                notification.innerHTML = `
                    <div class="flex items-center space-x-2">
                        <span class="text-lg">‚úì</span>
                        <span>Redirected to external browser!</span>
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        notification.remove();
                    }
                }, 3000);
            }, 500);
        }

        // Enhanced mobile navigation functions
        function initializeMobileNavigation() {
            const tabNav = document.getElementById('tabNavigation');
            if (!tabNav) return;
            
            // Add smooth scrolling for tab navigation
            let isScrolling = false;
            
            tabNav.addEventListener('scroll', () => {
                if (!isScrolling) {
                    updateScrollIndicators();
                }
            });
            
            // Add touch swipe gestures for better mobile experience
            let startX = 0;
            let currentX = 0;
            let isDragging = false;
            
            tabNav.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                isDragging = true;
            }, { passive: true });
            
            tabNav.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                currentX = e.touches[0].clientX;
                const diffX = startX - currentX;
                
                // Add momentum scrolling
                if (Math.abs(diffX) > 10) {
                    isScrolling = true;
                    setTimeout(() => isScrolling = false, 100);
                }
            }, { passive: true });
            
            tabNav.addEventListener('touchend', () => {
                isDragging = false;
                updateScrollIndicators();
            });
        }
        
        function updateScrollIndicators() {
            const tabNav = document.getElementById('tabNavigation');
            const navHelper = document.querySelector('.nav-helper');
            
            if (!tabNav || !navHelper) return;
            
            const scrollLeft = tabNav.scrollLeft;
            const maxScroll = tabNav.scrollWidth - tabNav.clientWidth;
            const scrollPercentage = maxScroll > 0 ? scrollLeft / maxScroll : 0;
            
            // Update indicator dots based on scroll position
            const dots = navHelper.querySelectorAll('.bg-purple-300, .bg-purple-500');
            dots.forEach((dot, index) => {
                const position = index / (dots.length - 1);
                if (Math.abs(scrollPercentage - position) < 0.2) {
                    dot.className = dot.className.replace('bg-purple-300', 'bg-purple-500').replace('opacity-50', '');
                } else {
                    dot.className = dot.className.replace('bg-purple-500', 'bg-purple-300');
                    if (!dot.className.includes('opacity-50')) {
                        dot.className += ' opacity-50';
                    }
                }
            });
        }
        
        // Enhanced viewport and orientation change handling
        function handleViewportChanges() {
            let resizeTimeout;
            
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    updateScrollIndicators();
                    optimizeTabDisplay();
                }, 150);
            });
            
            // Handle orientation changes
            window.addEventListener('orientationchange', () => {
                setTimeout(() => {
                    updateScrollIndicators();
                    optimizeTabDisplay();
                }, 500);
            });
        }
        
        function optimizeTabDisplay() {
            const isMobile = window.innerWidth <= 768;
            const tabButtons = document.querySelectorAll('.tab-btn');
            
            tabButtons.forEach(btn => {
                if (isMobile) {
                    btn.classList.add('touch-feedback');
                } else {
                    btn.classList.remove('touch-feedback');
                }
            });
        }
        
        // Initialize responsive enhancements on DOM load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                initializeMobileNavigation();
                handleViewportChanges();
                optimizeTabDisplay();
                initializeAdsterra();
            }, 1000);
        });
        
        // Adsterra Ad Management System
        class AdsterraManager {
            constructor() {
                this.adConfig = {
                    headerBanner: 'YOUR_ADSTERRA_BANNER_KEY_HERE',
                    moviesBanner: 'YOUR_ADSTERRA_MOVIES_BANNER_KEY_HERE',
                    offersBanner: 'YOUR_ADSTERRA_OFFERS_BANNER_KEY_HERE',
                    nativeAd1: 'YOUR_ADSTERRA_NATIVE_KEY_HERE',
                    moviesNative: 'YOUR_ADSTERRA_MOVIES_NATIVE_KEY_HERE',
                    offersNative: 'YOUR_ADSTERRA_OFFERS_NATIVE_KEY_HERE',
                    sidebarLeft: 'YOUR_ADSTERRA_SIDEBAR_LEFT_KEY_HERE',
                    sidebarRight: 'YOUR_ADSTERRA_SIDEBAR_RIGHT_KEY_HERE',
                    mobileSticky: 'YOUR_ADSTERRA_MOBILE_STICKY_KEY_HERE',
                    bottomBanner: 'YOUR_ADSTERRA_BANNER_2_KEY_HERE'
                };
                this.adBlockDetected = false;
                this.revenue = {
                    dailyEarnings: 0,
                    totalEarnings: 0,
                    impressions: 0,
                    clicks: 0
                };
                this.init();
            }
            
            init() {
                this.detectAdBlock();
                this.setupAdTracking();
                this.loadResponsiveAds();
                this.setupAdOptimization();
            }
            
            detectAdBlock() {
                // Simple ad block detection
                const testAd = document.createElement('div');
                testAd.innerHTML = '&nbsp;';
                testAd.className = 'adsbox';
                testAd.style.position = 'absolute';
                testAd.style.left = '-9999px';
                document.body.appendChild(testAd);
                
                setTimeout(() => {
                    if (testAd.offsetHeight === 0) {
                        this.adBlockDetected = true;
                        this.showAdBlockMessage();
                    }
                    document.body.removeChild(testAd);
                }, 100);
            }
            
            showAdBlockMessage() {
                const message = document.createElement('div');
                message.className = 'ad-fallback';
                message.innerHTML = `
                    <h3>üí∞ Support Our Platform</h3>
                    <p>We noticed you're using an ad blocker. Ads help us keep this platform free and earn you more rewards!</p>
                    <p>Please consider disabling your ad blocker for the best experience.</p>
                    <button onclick="location.reload()" class="btn-mobile bg-gradient-to-r from-green-500 to-blue-500 text-white mt-4">
                        Refresh Page
                    </button>
                `;
                
                // Add message to various sections
                const containers = document.querySelectorAll('.adsterra-ad-container');
                containers.forEach((container, index) => {
                    if (index % 3 === 0) { // Show message in every 3rd ad slot
                        container.appendChild(message.cloneNode(true));
                    }
                });
            }
            
            setupAdTracking() {
                // Track ad performance
                window.adEventCallback = (event, data) => {
                    switch(event) {
                        case 'impression':
                            this.revenue.impressions++;
                            break;
                        case 'click':
                            this.revenue.clicks++;
                            this.revenue.dailyEarnings += 0.001; // Estimated earnings per click
                            break;
                    }
                    this.updateRevenueDisplay();
                };
            }
            
            loadResponsiveAds() {
                // Load different ad sizes based on screen size
                const isMobile = window.innerWidth <= 768;
                const isTablet = window.innerWidth > 768 && window.innerWidth <= 1024;
                
                if (isMobile) {
                    this.loadMobileAds();
                } else if (isTablet) {
                    this.loadTabletAds();
                } else {
                    this.loadDesktopAds();
                }
            }
            
            loadMobileAds() {
                // Configure mobile-specific ad sizes
                const mobileConfig = {
                    bannerWidth: 320,
                    bannerHeight: 50,
                    nativeWidth: 300,
                    nativeHeight: 250
                };
                
                this.updateAdSizes(mobileConfig);
            }
            
            loadTabletAds() {
                // Configure tablet-specific ad sizes
                const tabletConfig = {
                    bannerWidth: 728,
                    bannerHeight: 90,
                    nativeWidth: 400,
                    nativeHeight: 300
                };
                
                this.updateAdSizes(tabletConfig);
            }
            
            loadDesktopAds() {
                // Configure desktop-specific ad sizes
                const desktopConfig = {
                    bannerWidth: 728,
                    bannerHeight: 90,
                    nativeWidth: 500,
                    nativeHeight: 350
                };
                
                this.updateAdSizes(desktopConfig);
            }
            
            updateAdSizes(config) {
                // Update atOptions for responsive ads
                if (window.atOptions) {
                    window.atOptions.width = config.bannerWidth;
                    window.atOptions.height = config.bannerHeight;
                }
            }
            
            setupAdOptimization() {
                // A/B test different ad placements
                const testGroup = Math.random() < 0.5 ? 'A' : 'B';
                
                if (testGroup === 'A') {
                    // Show more native ads
                    this.showMoreNativeAds();
                } else {
                    // Show more banner ads
                    this.showMoreBannerAds();
                }
                
                // Track which test group performs better
                localStorage.setItem('adTestGroup', testGroup);
            }
            
            showMoreNativeAds() {
                const nativeAds = document.querySelectorAll('.adsterra-native');
                nativeAds.forEach(ad => {
                    ad.style.display = 'block';
                });
            }
            
            showMoreBannerAds() {
                const bannerAds = document.querySelectorAll('.adsterra-banner');
                bannerAds.forEach(ad => {
                    ad.style.display = 'block';
                });
            }
            
            updateRevenueDisplay() {
                // Update earnings display (can be added to admin panel)
                const earnings = this.revenue.dailyEarnings.toFixed(3);
                console.log(`Today's ad revenue: $${earnings}`);
            }
            
            refreshAds() {
                // Refresh ads for better performance
                const adContainers = document.querySelectorAll('.adsterra-ad-container');
                adContainers.forEach((container, index) => {
                    setTimeout(() => {
                        // Reload ad after delay
                        const scripts = container.querySelectorAll('script');
                        scripts.forEach(script => {
                            if (script.src && script.src.includes('invoke.js')) {
                                const newScript = document.createElement('script');
                                newScript.src = script.src;
                                script.parentNode.replaceChild(newScript, script);
                            }
                        });
                    }, index * 2000); // Stagger refreshes
                });
            }
        }
        
        // Adsterra helper functions
        function initializeAdsterra() {
            window.adsterraManager = new AdsterraManager();
            
            // Load saved configuration
            loadAdsterraConfig();
            
            // Refresh ads every 10 minutes for better revenue
            setInterval(() => {
                if (!document.hidden) {
                    window.adsterraManager.refreshAds();
                }
            }, 600000);
        }
        
        // Admin Panel Functions
        function authenticateAdmin() {
            const password = document.getElementById('adminPassword').value;
            const correctPassword = 'admin8101760547'; // Change this to your secure password
            
            if (password === correctPassword) {
                document.getElementById('adminAuth').style.display = 'none';
                document.getElementById('adminDashboard').classList.remove('hidden');
                loadAdsterraConfig();
                updateAdAnalytics();
            } else {
                alert('‚ùå Incorrect password!');
            }
        }
        
        function saveAdsterraConfig() {
            const config = {
                headerBanner: document.getElementById('headerBannerKey').value,
                moviesBanner: document.getElementById('moviesBannerKey').value,
                offersBanner: document.getElementById('offersBannerKey').value,
                bottomBanner: document.getElementById('bottomBannerKey').value,
                videosNative: document.getElementById('videosNativeKey').value,
                moviesNative: document.getElementById('moviesNativeKey').value,
                offersNative: document.getElementById('offersNativeKey').value,
                leftSidebar: document.getElementById('leftSidebarKey').value,
                rightSidebar: document.getElementById('rightSidebarKey').value,
                mobileSticky: document.getElementById('mobileStickyKey').value,
                enableMobileSticky: document.getElementById('enableMobileSticky').checked,
                adRefreshRate: document.getElementById('adRefreshRate').value,
                adDensity: document.getElementById('adDensity').value,
                enableAdBlock: document.getElementById('enableAdBlock').checked
            };
            
            // Save to localStorage
            localStorage.setItem('adsterraConfig', JSON.stringify(config));
            
            // Update live ads
            updateLiveAds(config);
            
            // Show success message
            showAdminMessage('‚úÖ Configuration saved successfully! Ads will be updated automatically.', 'success');
            
            // Log activity
            logAdActivity('Configuration updated', 'Admin saved new Adsterra configuration');
        }
        
        function loadAdsterraConfig() {
            const savedConfig = localStorage.getItem('adsterraConfig');
            if (savedConfig) {
                const config = JSON.parse(savedConfig);
                
                // Load values into form
                document.getElementById('headerBannerKey').value = config.headerBanner || '';
                document.getElementById('moviesBannerKey').value = config.moviesBanner || '';
                document.getElementById('offersBannerKey').value = config.offersBanner || '';
                document.getElementById('bottomBannerKey').value = config.bottomBanner || '';
                document.getElementById('videosNativeKey').value = config.videosNative || '';
                document.getElementById('moviesNativeKey').value = config.moviesNative || '';
                document.getElementById('offersNativeKey').value = config.offersNative || '';
                document.getElementById('leftSidebarKey').value = config.leftSidebar || '';
                document.getElementById('rightSidebarKey').value = config.rightSidebar || '';
                document.getElementById('mobileStickyKey').value = config.mobileSticky || '';
                document.getElementById('enableMobileSticky').checked = config.enableMobileSticky || false;
                document.getElementById('adRefreshRate').value = config.adRefreshRate || '10';
                document.getElementById('adDensity').value = config.adDensity || 'medium';
                document.getElementById('enableAdBlock').checked = config.enableAdBlock !== false;
            }
        }
        
        function updateLiveAds(config) {
            // Update all ad scripts with new zone IDs
            const adMappings = {
                'adsterra-header-banner': config.headerBanner,
                'adsterra-movies-banner': config.moviesBanner,
                'adsterra-offers-banner': config.offersBanner,
                'adsterra-bottom-banner': config.bottomBanner,
                'adsterra-native-1': config.videosNative,
                'adsterra-movies-native': config.moviesNative,
                'adsterra-offers-native': config.offersNative,
                'adsterra-sidebar-left': config.leftSidebar,
                'adsterra-sidebar-right': config.rightSidebar,
                'adsterra-mobile-sticky': config.mobileSticky
            };
            
            // Update each ad container
            Object.keys(adMappings).forEach(containerId => {
                const container = document.getElementById(containerId);
                const zoneId = adMappings[containerId];
                
                if (container && zoneId) {
                    // Clear existing content
                    container.innerHTML = '';
                    
                    // Create new script with updated zone ID
                    const script = document.createElement('script');
                    script.type = 'text/javascript';
                    script.innerHTML = `
                        atOptions = {
                            'key' : '${zoneId}',
                            'format' : 'iframe',
                            'height' : 90,
                            'width' : 728,
                            'params' : {}
                        };
                        document.write('<scr' + 'ipt type="text/javascript" src="//www.topcreativeformat.com/${zoneId}/invoke.js"></scr' + 'ipt>');
                    `;
                    
                    container.appendChild(script);
                }
            });
            
            // Update mobile sticky ad visibility
            const stickyAd = document.getElementById('adsterra-sticky-footer');
            if (stickyAd) {
                stickyAd.style.display = config.enableMobileSticky ? 'block' : 'none';
            }
            
            // Update refresh rate
            if (window.adRefreshInterval) {
                clearInterval(window.adRefreshInterval);
            }
            
            window.adRefreshInterval = setInterval(() => {
                if (!document.hidden && window.adsterraManager) {
                    window.adsterraManager.refreshAds();
                }
            }, config.adRefreshRate * 60000);
        }
        
        function testAdsterraAds() {
            const config = JSON.parse(localStorage.getItem('adsterraConfig') || '{}');
            
            if (!config.headerBanner) {
                showAdminMessage('‚ö†Ô∏è Please save configuration first!', 'warning');
                return;
            }
            
            showAdminMessage('üß™ Testing ads... Check if they display correctly.', 'info');
            
            // Force refresh all ads
            if (window.adsterraManager) {
                window.adsterraManager.refreshAds();
            }
            
            // Simulate test metrics
            setTimeout(() => {
                updateAdAnalytics({
                    impressions: Math.floor(Math.random() * 100) + 50,
                    clicks: Math.floor(Math.random() * 10) + 1,
                    revenue: (Math.random() * 2).toFixed(2)
                });
                
                logAdActivity('Test completed', 'Admin ran ad test');
            }, 2000);
        }
        
        function clearAdsterraConfig() {
            if (confirm('‚ö†Ô∏è Are you sure you want to clear all ad configuration?')) {
                localStorage.removeItem('adsterraConfig');
                
                // Clear form
                document.getElementById('adsterraConfigForm').reset();
                
                // Hide all ads
                document.querySelectorAll('.adsterra-ad-container').forEach(container => {
                    container.style.display = 'none';
                });
                
                showAdminMessage('üóëÔ∏è Configuration cleared!', 'info');
                logAdActivity('Configuration cleared', 'Admin cleared all ad settings');
            }
        }
        
        function updateAdAnalytics(testData = null) {
            const analytics = testData || {
                impressions: parseInt(localStorage.getItem('adImpressions') || '0'),
                clicks: parseInt(localStorage.getItem('adClicks') || '0'),
                revenue: parseFloat(localStorage.getItem('adRevenue') || '0')
            };
            
            const ctr = analytics.impressions > 0 ? ((analytics.clicks / analytics.impressions) * 100).toFixed(2) : '0';
            
            // Update display
            document.getElementById('dailyRevenue').textContent = `$${analytics.revenue}`;
            document.getElementById('impressionsCount').textContent = analytics.impressions;
            document.getElementById('totalImpressions').textContent = analytics.impressions;
            document.getElementById('totalClicks').textContent = analytics.clicks;
            document.getElementById('ctrRate').textContent = `${ctr}%`;
            document.getElementById('estimatedEarnings').textContent = `$${analytics.revenue}`;
        }
        
        function logAdActivity(action, description) {
            const activities = JSON.parse(localStorage.getItem('adActivities') || '[]');
            const newActivity = {
                timestamp: new Date().toLocaleString(),
                action: action,
                description: description
            };
            
            activities.unshift(newActivity);
            // Keep only last 10 activities
            activities.splice(10);
            
            localStorage.setItem('adActivities', JSON.stringify(activities));
            updateRecentActivity();
        }
        
        function updateRecentActivity() {
            const activities = JSON.parse(localStorage.getItem('adActivities') || '[]');
            const container = document.getElementById('recentActivity');
            
            if (activities.length === 0) {
                container.innerHTML = '<p>‚Ä¢ No recent activity</p>';
                return;
            }
            
            container.innerHTML = activities.map(activity => 
                `<p>‚Ä¢ ${activity.timestamp}: ${activity.action} - ${activity.description}</p>`
            ).join('');
        }
        
        function showAdminMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm ${
                type === 'success' ? 'bg-green-50 border border-green-200 text-green-800' :
                type === 'warning' ? 'bg-yellow-50 border border-yellow-200 text-yellow-800' :
                type === 'error' ? 'bg-red-50 border border-red-200 text-red-800' :
                'bg-blue-50 border border-blue-200 text-blue-800'
            }`;
            
            messageDiv.innerHTML = `
                <div class="flex items-center justify-between">
                    <p class="text-sm font-medium">${message}</p>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-gray-400 hover:text-gray-600">
                        √ó
                    </button>
                </div>
            `;
            
            document.body.appendChild(messageDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (messageDiv.parentElement) {
                    messageDiv.remove();
                }
            }, 5000);
        }
        
        function refreshAllAds() {
            if (window.adsterraManager) {
                window.adsterraManager.refreshAds();
                showAdminMessage('üîÑ All ads refreshed!', 'success');
                logAdActivity('Ads refreshed', 'Admin manually refreshed all ads');
            }
        }
        
        function exportAdData() {
            const data = {
                config: JSON.parse(localStorage.getItem('adsterraConfig') || '{}'),
                analytics: {
                    impressions: localStorage.getItem('adImpressions') || '0',
                    clicks: localStorage.getItem('adClicks') || '0',
                    revenue: localStorage.getItem('adRevenue') || '0'
                },
                activities: JSON.parse(localStorage.getItem('adActivities') || '[]')
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `adsterra-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showAdminMessage('üìÑ Data exported successfully!', 'success');
            logAdActivity('Data exported', 'Admin exported ad data');
        }
        
        function showAdsterraGuide() {
            const guideWindow = window.open('', '_blank', 'width=800,height=600,scrollbars=yes');
            guideWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Adsterra Setup Guide</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; line-height: 1.6; }
                        h1, h2 { color: #333; }
                        .step { background: #f5f5f5; padding: 15px; margin: 10px 0; border-radius: 8px; }
                        .highlight { background: #e3f2fd; padding: 10px; border-radius: 5px; margin: 10px 0; }
                        code { background: #f0f0f0; padding: 2px 5px; border-radius: 3px; }
                    </style>
                </head>
                <body>
                    <h1>üöÄ Adsterra Quick Setup Guide</h1>
                    
                    <div class="highlight">
                        <strong>üéØ Quick Start:</strong> Get your ads running in 3 simple steps!
                    </div>
                    
                    <div class="step">
                        <h2>Step 1: Create Adsterra Account</h2>
                        <p>1. Visit <strong>https://adsterra.com</strong></p>
                        <p>2. Click "Sign Up" and complete registration</p>
                        <p>3. Verify your email address</p>
                    </div>
                    
                    <div class="step">
                        <h2>Step 2: Create Ad Zones</h2>
                        <p>Create these 10 ad zones in your Adsterra dashboard:</p>
                        <ul>
                            <li><strong>Header Banner:</strong> 728x90 (Desktop) / 320x50 (Mobile)</li>
                            <li><strong>Movies Banner:</strong> 728x90 (Desktop) / 320x50 (Mobile)</li>
                            <li><strong>Offers Banner:</strong> 728x90 (Desktop) / 320x50 (Mobile)</li>
                            <li><strong>Bottom Banner:</strong> 300x250 Rectangle</li>
                            <li><strong>Videos Native:</strong> 300x250 Native</li>
                            <li><strong>Movies Native:</strong> 300x250 Native</li>
                            <li><strong>Offers Native:</strong> 300x250 Native</li>
                            <li><strong>Left Sidebar:</strong> 160x600 Skyscraper</li>
                            <li><strong>Right Sidebar:</strong> 160x600 Skyscraper</li>
                            <li><strong>Mobile Sticky:</strong> 320x50 Mobile Banner</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h2>Step 3: Add Zone IDs</h2>
                        <p>1. Copy each zone ID from Adsterra dashboard</p>
                        <p>2. Paste them into the admin form</p>
                        <p>3. Click "Save Configuration"</p>
                        <p>4. Test your ads!</p>
                    </div>
                    
                    <div class="highlight">
                        <strong>üí∞ Expected Revenue:</strong>
                        <ul>
                            <li>1,000 daily visitors: $2-8 per day</li>
                            <li>5,000 daily visitors: $10-40 per day</li>
                            <li>10,000+ daily visitors: $20-80+ per day</li>
                        </ul>
                    </div>
                    
                    <div class="step">
                        <h2>üìû Need Help?</h2>
                        <p>Contact Adsterra Support:</p>
                        <ul>
                            <li>Email: support@adsterra.com</li>
                            <li>Live Chat: Available 24/7</li>
                            <li>Minimum Payout: $5 (PayPal)</li>
                        </ul>
                    </div>
                </body>
                </html>
            `);
            
            logAdActivity('Guide viewed', 'Admin opened setup guide');
        }
        
        function closeStickyAd() {
            const stickyAd = document.getElementById('adsterra-sticky-footer');
            if (stickyAd) {
                stickyAd.style.display = 'none';
                
                // Show it again after 5 minutes
                setTimeout(() => {
                    stickyAd.style.display = 'block';
                }, 300000);
            }
        }
        
        // Adsterra revenue optimization
        function optimizeAdRevenue() {
            // Implement lazy loading for better performance
            const adContainers = document.querySelectorAll('.adsterra-ad-container');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        // Load ad when it comes into view
                        const scripts = entry.target.querySelectorAll('script[data-src]');
                        scripts.forEach(script => {
                            script.src = script.dataset.src;
                            script.removeAttribute('data-src');
                        });
                        observer.unobserve(entry.target);
                    }
                });
            });
            
            adContainers.forEach(container => {
                observer.observe(container);
            });
        }
        
        // Handle window resize for responsive ads
        window.addEventListener('resize', () => {
            if (window.adsterraManager) {
                clearTimeout(window.adResizeTimeout);
                window.adResizeTimeout = setTimeout(() => {
                    window.adsterraManager.loadResponsiveAds();
                }, 300);
            }
        });
        
        // Anti-adblock message
        function showAdsterraInfo() {
            const info = `
            üí∞ **Adsterra Integration Guide**
            
            1. Sign up at https://adsterra.com
            2. Create ad zones for:
               - Banner ads (728x90, 320x50)
               - Native ads (300x250)
               - Sidebar ads (160x600)
               - Mobile sticky (320x50)
            3. Replace placeholder keys with your actual Adsterra zone IDs
            4. Expected revenue: $1-5 per 1000 views
            5. Payment threshold: $5 minimum
            6. Payment methods: PayPal, Wire, Bitcoin, WebMoney
            
            üöÄ Optimization tips:
            - Place ads above the fold for better visibility
            - Use native ads for higher engagement
            - A/B test different ad placements
            - Monitor performance regularly
            `;
            
            console.log(info);
            return info;
        }

    </script>
</body>
</html>